<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>

  <title>DOM Rasterization test for Scenery</title>

  <script src="../../sherpa/lib/jquery-2.1.0.js"></script>
  <script src="../../sherpa/lib/lodash-4.17.4.min.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
    }
    canvas {
      margin-top: 130px;
    }
  </style>
</head>
<body>

<div id="div">
  <div style="display: block; position: absolute; left: 0px; top: 0px; pointer-events: none; transform-origin: left top 0px; z-index: 20; width: 100px; height: 100px; border-radius: 50px; transform: matrix(1, 0, 0, 1, 3, 3); background-color: blue;"><div style="display: block; position: absolute; left: -3px; top: -3px; pointer-events: none; border: 6px solid red; width: 94px; height: 94px; border-radius: 53px;"></div></div>
  <div style="display: block; position: absolute; pointer-events: none; left: 0px; top: 0px; transform-origin: left top 0px; z-index: 120; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 30px; line-height: normal; font-family: sans-serif; color: white; width: 69.990234375px; height: 33px; transform: matrix(1, 0, 0, 1, 18.0048828125, 36.5);" dir="ltr">DOM</div>
  <img style="display: block; position: absolute; left: 0px; top: 0px; z-index: 10; width: 106px; height: 106px;" src="data:image/png;base64,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">
  <svg xmlns='http://www.w3.org/2000/svg' width='64' height='64' style="opacity: 0.85; display: block; position: absolute; left: 0px; top: 0px; z-index: 100; width: 64px; height: 64px;"><linearGradient id='gradient'><stop offset='0%' stop-color='#F00'/><stop offset='100%' stop-color='#00F'/></linearGradient><rect fill='url(#gradient)' x='0' y='0' width='64' height='64'/></svg>
</div>

<script>
  var canvas = document.createElement( 'canvas' );
  var context = canvas.getContext( '2d' );
  document.body.appendChild( canvas );
  canvas.width = 106;
  canvas.height = 106;

  var doc = document.implementation.createHTMLDocument( "" );
  doc.documentElement.innerHTML = document.getElementById( 'div' ).innerHTML;
  doc.documentElement.setAttribute( 'xmlns', doc.documentElement.namespaceURI );
  var xhtml = (new XMLSerializer()).serializeToString( doc.documentElement );

  var data = '<svg xmlns="http://www.w3.org/2000/svg" width="106" height="106">' +
             '<foreignObject width="100%" height="100%">' +
             '<div xmlns="http://www.w3.org/1999/xhtml">' +
             xhtml +
             '</div>' +
             '</foreignObject>' +
             '</svg>';

  var img = new Image();

  /* Gets this to work in firefox, but causes security error in Chrome
  var DOMURL = window.URL || window.webkitURL || window;

  var svg = new Blob( [ data ], { type: 'image/svg+xml;charset=utf-8' } );
  var url = DOMURL.createObjectURL( svg );
  */

  img.onload = function () {
    context.drawImage( img, 0, 0 );
    // DOMURL.revokeObjectURL( url );

    console.log( canvas.toDataURL() );
  }

  img.src = 'data:image/svg+xml;base64,' + btoa( data );
</script>
</body>
</html>
