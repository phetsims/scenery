/* eslint-disable */
import util from './shared/util.js';
import transform from './shared/transform.js';
import bbox from './shared/bbox.js';
import drawtag from './shared/drawtag.js';
import clip from './shared/clip.js';
import config from './shared/config.js';
import pre from './shared/pre.js';

export default `${pre}${config}
${clip}
${drawtag}
${bbox}
${transform}
@group(0)@binding(0)var<uniform>j:aM;@group(0)@binding(1)var<storage>n:aS;@group(0)@binding(2)var<storage>aK:array<aL>;@group(0)@binding(3)var<storage>aP:array<c6>;@group(0)@binding(4)var<storage,read_write>dG:array<aL>;@group(0)@binding(5)var<storage,read_write>info:aS;@group(0)@binding(6)var<storage,read_write>cT:array<eq>;${util}
const k=256u;fn e6(c2:d,l:d)->aG{let ai=c2+l*6u;let e5=bitcast<c>(n[ai]);let e4=bitcast<c>(n[ai+1u]);let e3=bitcast<c>(n[ai+2u]);let e2=bitcast<c>(n[ai+3u]);let e1=bitcast<c>(n[ai+4u]);let e0=bitcast<c>(n[ai+5u]);let G=vec4(e5,e4,e3,e2);let a8=vec2(e1,e0);return aG(G,a8);}var<workgroup>aB:array<aL,k>;@compute @workgroup_size(256)fn main(@builtin(global_invocation_id)J:I,@builtin(local_invocation_id)f:I,@builtin(workgroup_id)al:I){let l=J.x;var agg=ir();if f.x<al.x{agg=aK[f.x];}aB[f.x]=agg;for(var e=0u;e<firstTrailingBit(k);e+=1u){workgroupBarrier();if f.x+(1u<<e)<k{let ao=aB[f.x+(1u<<e)];agg=en(agg,ao);}workgroupBarrier();aB[f.x]=agg;}workgroupBarrier();var bs=aB[0];workgroupBarrier();let H=gE(l);agg=g_(H);aB[f.x]=agg;for(var e=0u;e<firstTrailingBit(k);e+=1u){workgroupBarrier();if f.x>=1u<<e{let ao=aB[f.x-(1u<<e)];agg=en(agg,ao);}workgroupBarrier();aB[f.x]=agg;}workgroupBarrier();if f.x>0u{bs=en(bs,aB[f.x- 1u]);}if l<j.cJ{dG[l]=bs;}let A=j.fu+bs.bG;let V=bs.M;if H==fs||H==em||H==el||H==ek||H==dN{let h=aP[bs.W];let je=d(h.X>=0.);var U=aG();var X=h.X;if X>=0.||H==em||H==el||H==ek{U=e6(j.c2,h.bI);}if X>=0.{let G=U.G;X*=sqrt(abs(G.x*G.w-G.y*G.z));}switch H{case 66u:{info[V]=bitcast<d>(X);}case 266u:{info[V]=bitcast<d>(X);var o=bitcast<t>(vec2(n[A+1u],n[A+2u]));var q=bitcast<t>(vec2(n[A+3u],n[A+4u]));o=cY(U,o);q=cY(U,q);let e_=q-o;let a5=1./dot(e_,e_);let eZ=e_*a5;let dJ=-dot(o,eZ);info[V+1u]=bitcast<d>(eZ.x);info[V+2u]=bitcast<d>(eZ.y);info[V+3u]=bitcast<d>(dJ);}case 654u:{let eY=1./c(1<<12u);info[V]=bitcast<d>(X);var o=bitcast<t>(vec2(n[A+1u],n[A+2u]));var q=bitcast<t>(vec2(n[A+3u],n[A+4u]));var cP=bitcast<c>(n[A+5u]);var cA=bitcast<c>(n[A+6u]);let f4=fk(U);var b8=aG();var a2=0.;var aQ=0.;var bF=0u;var aA=0u;if abs(cP-cA)<=eY{bF=g5;let f3=cP/distance(o,q);b8=dH(f6(o,q),f4);aQ=f3*f3;}else{bF=iA;if all(o==q){bF=g6;o+=eY;}if cA==0.{aA|=g3;let hQ=o;o=q;q=hQ;let hP=cP;cP=cA;cA=hP;}a2=cP/(cP-cA);let f2=(1.-a2)*o+a2*q;aQ=cA/(distance(f2,q));let eX=dH(f6(f2,q),f4);var eW=eX;if abs(aQ- 1.)<=eY{bF=g4;let a5=.5*abs(1.-a2);eW=dH(aG(vec4(a5,0.,0.,a5),vec2(0.)),eX);}else{let a=aQ*aQ- 1.;let f1=abs(1.-a2)/a;let hO=aQ*f1;let hN=sqrt(abs(a))*f1;eW=dH(aG(vec4(hO,0.,0.,hN),vec2(0.)),eX);}b8=eW;}info[V+1u]=bitcast<d>(b8.G.x);info[V+2u]=bitcast<d>(b8.G.y);info[V+3u]=bitcast<d>(b8.G.z);info[V+4u]=bitcast<d>(b8.G.w);info[V+5u]=bitcast<d>(b8.a8.x);info[V+6u]=bitcast<d>(b8.a8.y);info[V+7u]=bitcast<d>(a2);info[V+8u]=bitcast<d>(aQ);info[V+9u]=bitcast<d>((aA<<3u)|bF);}case 580u:{info[V]=bitcast<d>(X);let b9=fk(U);info[V+1u]=bitcast<d>(b9.G.x);info[V+2u]=bitcast<d>(b9.G.y);info[V+3u]=bitcast<d>(b9.G.z);info[V+4u]=bitcast<d>(b9.G.w);info[V+5u]=bitcast<d>(b9.a8.x);info[V+6u]=bitcast<d>(b9.a8.y);info[V+7u]=n[A];info[V+8u]=n[A+1u];}default:{}}}if H==dN||H==ej{var W=~l;if H==dN{W=bs.W;}cT[bs.ch]=eq(l,i(W));}}fn f6(o:t,q:t)->aG{let hM=f5(o,q);let b9=fk(hM);let hL=f5(vec2(0.),vec2(1.,0.));return dH(hL,b9);}fn f5(o:t,q:t)->aG{return aG(vec4(q.y-o.y,o.x-q.x,q.x-o.x,q.y-o.y),vec2(o.x,o.y));}`
