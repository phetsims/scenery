/* eslint-disable */
import util from './shared/util.js';
import transform from './shared/transform.js';
import bbox from './shared/bbox.js';
import drawtag from './shared/drawtag.js';
import clip from './shared/clip.js';
import config from './shared/config.js';
import pre from './shared/pre.js';

export default `${pre}${config}
${clip}
${drawtag}
${bbox}
${transform}
@group(0)@binding(0)var<uniform>n:aR;@group(0)@binding(1)var<storage>u:aX;@group(0)@binding(2)var<storage>aN:array<aQ>;@group(0)@binding(3)var<storage>aU:array<c8>;@group(0)@binding(4)var<storage,read_write>dG:array<aQ>;@group(0)@binding(5)var<storage,read_write>info:aX;@group(0)@binding(6)var<storage,read_write>cW:array<eC>;${util}
const o=256u;var<workgroup>aF:array<aQ,o>;@compute @workgroup_size(256)fn main(@builtin(global_invocation_id)N:M,@builtin(local_invocation_id)k:M,@builtin(workgroup_id)ap:M){let p=N.x;var agg=iy();if k.x<ap.x{agg=aN[k.x];}aF[k.x]=agg;for(var i=e;i<firstTrailingBit(o);i+=f){workgroupBarrier();if k.x+(f<<i)<o{let au=aF[k.x+(f<<i)];agg=ey(agg,au);}workgroupBarrier();aF[k.x]=agg;}workgroupBarrier();var bw=aF[0];workgroupBarrier();let K=gI(p);agg=g5(K);aF[k.x]=agg;for(var i=e;i<firstTrailingBit(o);i+=f){workgroupBarrier();if k.x>=f<<i{let au=aF[k.x-(f<<i)];agg=ey(agg,au);}workgroupBarrier();aF[k.x]=agg;}workgroupBarrier();if k.x>e{bw=ey(bw,aF[k.x-f]);}if p<n.cN{dG[p]=bw;}let E=n.fv+bw.bH;let Y=bw.Q;if K==ft||K==ex||K==ew||K==ev||K==dN{let l=aU[bw.ac];let jm=j(l.ad>=c);var Z=aP();var ad=l.ad;if ad>=c||K==ex||K==ew||K==ev{Z=gJ(n.ez,l.bJ);}if ad>=c{let P=Z.P;ad*=sqrt(abs(P.x*P.w-P.y*P.z));}switch K{case ft:{info[Y]=bitcast<j>(ad);}case ex:{info[Y]=bitcast<j>(ad);var s=bitcast<B>(vec2(u[E+f],u[E+2u]));var v=bitcast<B>(vec2(u[E+3u],u[E+4u]));s=c0(Z,s);v=c0(Z,v);let e8=v-s;let bf=d/dot(e8,e8);let e7=e8*bf;let dJ=-dot(s,e7);info[Y+f]=bitcast<j>(e7.x);info[Y+2u]=bitcast<j>(e7.y);info[Y+3u]=bitcast<j>(dJ);}case ew:{let e6=d/h(1<<12u);info[Y]=bitcast<j>(ad);var s=bitcast<B>(vec2(u[E+f],u[E+2u]));var v=bitcast<B>(vec2(u[E+3u],u[E+4u]));var bC=bitcast<h>(u[E+5u]);var be=bitcast<h>(u[E+6u]);let f8=fm(Z);var dY=aP();var bc=c;var aV=c;var bG=e;var aE=e;if abs(bC-be)<=e6{bG=hb;let f7=bC/distance(s,v);dY=dH(gc(s,v),f8);aV=f7*f7;}else{bG=iH;if all(s==v){bG=hc;s+=e6;}if be==c{aE|=g9;let hY=s;s=v;v=hY;let hX=bC;bC=be;be=hX;}bc=bC/(bC-be);let f6=(d-bc)*s+bc*v;aV=be/(distance(f6,v));let e5=dH(gc(f6,v),f8);var e4=e5;if abs(aV-d)<=e6{bG=ha;let bf=.5*abs(d-bc);e4=dH(aP(vec4(bf,c,0.,bf),vec2(c)),e5);}else{let a=aV*aV- d;let f5=abs(d-bc)/a;let hW=aV*f5;let hV=sqrt(abs(a))*f5;e4=dH(aP(vec4(hW,c,0.,hV),vec2(c)),e5);}dY=e4;}let d0=bitcast<cn>(dY.P);let f4=bitcast<vec2u>(dY.b2);info[Y+f]=d0.x;info[Y+2u]=d0.y;info[Y+3u]=d0.z;info[Y+4u]=d0.w;info[Y+5u]=f4.x;info[Y+6u]=f4.y;info[Y+7u]=bitcast<j>(bc);info[Y+8u]=bitcast<j>(aV);info[Y+9u]=bitcast<j>((aE<<3u)|bG);}case ev:{info[Y]=bitcast<j>(ad);let d_=fm(Z);let dZ=bitcast<cn>(d_.P);let f3=bitcast<vec2u>(d_.b2);info[Y+f]=dZ.x;info[Y+2u]=dZ.y;info[Y+3u]=dZ.z;info[Y+4u]=dZ.w;info[Y+5u]=f3.x;info[Y+6u]=f3.y;info[Y+7u]=u[E];info[Y+8u]=u[E+f];info[Y+9u]=u[E+2u];}default:{}}}if K==dN||K==eu{var ac=~p;if K==dN{ac=bw.ac;}cW[bw.cl]=eC(p,m(ac));}}fn gc(s:B,v:B)->aP{let hU=f9(s,v);let d_=fm(hU);let hT=f9(vec2(c),vec2(d,c));return dH(hT,d_);}fn f9(s:B,v:B)->aP{return aP(vec4(v.y-s.y,s.x-v.x,v.x-s.x,v.y-s.y),vec2(s.x,s.y));}`
