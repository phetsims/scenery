/* eslint-disable */
import util from './shared/util.js';
import transform from './shared/transform.js';
import bbox from './shared/bbox.js';
import drawtag from './shared/drawtag.js';
import clip from './shared/clip.js';
import config from './shared/config.js';

export default `${config}
${clip}
${drawtag}
${bbox}
${transform}
@group(0)@binding(0)var<uniform>f:aF;@group(0)@binding(1)var<storage>k:array<u32>;@group(0)@binding(2)var<storage>aD:array<aE>;@group(0)@binding(3)var<storage>aI:array<cY>;@group(0)@binding(4)var<storage,read_write>dv:array<aE>;@group(0)@binding(5)var<storage,read_write>info:array<u32>;@group(0)@binding(6)var<storage,read_write>cK:array<ef>;${util}
const h=256u;fn eW(cU:u32,i:u32)->az{let Z=cU+i*6u;let eV=bitcast<f32>(k[Z]);let eU=bitcast<f32>(k[Z+1u]);let eT=bitcast<f32>(k[Z+2u]);let eS=bitcast<f32>(k[Z+3u]);let eR=bitcast<f32>(k[Z+4u]);let eQ=bitcast<f32>(k[Z+5u]);let C=vec4(eV,eU,eT,eS);let a0=vec2(eR,eQ);return az(C,a0);}var<workgroup>au:array<aE,h>;@compute @workgroup_size(256)fn main(@builtin(global_invocation_id)E:vec3u,@builtin(local_invocation_id)d:vec3u,@builtin(workgroup_id)ae:vec3u,){let i=E.x;var agg=ig();if d.x<ae.x{agg=aD[d.x];}au[d.x]=agg;for(var c=0u;c<firstTrailingBit(h);c+=1u){workgroupBarrier();if d.x+(1u<<c)<h{let ai=au[d.x+(1u<<c)];agg=ec(agg,ai);}workgroupBarrier();au[d.x]=agg;}workgroupBarrier();var bj=au[0];workgroupBarrier();let D=gt(i);agg=gP(D);au[d.x]=agg;for(var c=0u;c<firstTrailingBit(h);c+=1u){workgroupBarrier();if d.x>=1u<<c{let ai=au[d.x-(1u<<c)];agg=ec(agg,ai);}workgroupBarrier();au[d.x]=agg;}workgroupBarrier();if d.x>0u{bj=ec(bj,au[d.x- 1u]);}if i<f.cA{dv[i]=bj;}let s=f.fi+bj.by;let Q=bj.H;if D==fg||D==eb||D==ea||D==d9||D==dC{let e=aI[bj.R];let i3=u32(e.S>=0.);var P=az();var S=e.S;if S>=0.||D==eb||D==ea||D==d9{P=eW(f.cU,e.bA);}if S>=0.{let C=P.C;S*=sqrt(abs(C.x*C.w-C.y*C.z));}switch D{case 66u:{info[Q]=bitcast<u32>(S);}case 0x10au:{info[Q]=bitcast<u32>(S);var l=bitcast<vec2f>(vec2(k[s+1u],k[s+2u]));var n=bitcast<vec2f>(vec2(k[s+3u],k[s+4u]));l=cP(P,l);n=cP(P,n);let eP=n-l;let aY=1./dot(eP,eP);let eO=eP*aY;let dy=-dot(l,eO);info[Q+1u]=bitcast<u32>(eO.x);info[Q+2u]=bitcast<u32>(eO.y);info[Q+3u]=bitcast<u32>(dy);}case 0x28eu:{let eN=1./f32(1<<12u);info[Q]=bitcast<u32>(S);var l=bitcast<vec2f>(vec2(k[s+1u],k[s+2u]));var n=bitcast<vec2f>(vec2(k[s+3u],k[s+4u]));var cG=bitcast<f32>(k[s+5u]);var cr=bitcast<f32>(k[s+6u]);let fU=e9(P);var b_=az();var aV=0.;var aJ=0.;var bx=0u;var at=0u;if abs(cG-cr)<=eN{bx=gV;let fT=cG/distance(l,n);b_=dw(fW(l,n),fU);aJ=fT*fT;}else{bx=ip;if all(l==n){bx=gW;l+=eN;}if cr==0.{at|=gT;let hF=l;l=n;n=hF;let hE=cG;cG=cr;cr=hE;}aV=cG/(cG-cr);let fS=(1.-aV)*l+aV*n;aJ=cr/(distance(fS,n));let eM=dw(fW(fS,n),fU);var eL=eM;if abs(aJ- 1.)<=eN{bx=gU;let aY=.5*abs(1.-aV);eL=dw(az(vec4(aY,0.,0.,aY),vec2(0.)),eM);}else{let a=aJ*aJ- 1.;let fR=abs(1.-aV)/a;let hD=aJ*fR;let hC=sqrt(abs(a))*fR;eL=dw(az(vec4(hD,0.,0.,hC),vec2(0.)),eM);}b_=eL;}info[Q+1u]=bitcast<u32>(b_.C.x);info[Q+2u]=bitcast<u32>(b_.C.y);info[Q+3u]=bitcast<u32>(b_.C.z);info[Q+4u]=bitcast<u32>(b_.C.w);info[Q+5u]=bitcast<u32>(b_.a0.x);info[Q+6u]=bitcast<u32>(b_.a0.y);info[Q+7u]=bitcast<u32>(aV);info[Q+8u]=bitcast<u32>(aJ);info[Q+9u]=bitcast<u32>((at<<3u)|bx);}case 580u:{info[Q]=bitcast<u32>(S);let b0=e9(P);info[Q+1u]=bitcast<u32>(b0.C.x);info[Q+2u]=bitcast<u32>(b0.C.y);info[Q+3u]=bitcast<u32>(b0.C.z);info[Q+4u]=bitcast<u32>(b0.C.w);info[Q+5u]=bitcast<u32>(b0.a0.x);info[Q+6u]=bitcast<u32>(b0.a0.y);info[Q+7u]=k[s];info[Q+8u]=k[s+1u];}default:{}}}if D==dC||D==d8{var R=~i;if D==dC{R=bj.R;}cK[bj.b8]=ef(i,i32(R));}}fn fW(l:vec2f,n:vec2f)->az{let hB=fV(l,n);let b0=e9(hB);let hA=fV(vec2(0.),vec2(1.,0.));return dw(hA,b0);}fn fV(l:vec2f,n:vec2f)->az{return az(vec4(n.y-l.y,l.x-n.x,n.x-l.x,n.y-l.y),vec2(l.x,l.y));}`
