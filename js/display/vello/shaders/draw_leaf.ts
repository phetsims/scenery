/* eslint-disable */
import util from './shared/util.js';
import transform from './shared/transform.js';
import bbox from './shared/bbox.js';
import drawtag from './shared/drawtag.js';
import clip from './shared/clip.js';
import config from './shared/config.js';
import pre from './shared/pre.js';

export default `${pre}${config}
${clip}
${drawtag}
${bbox}
${transform}
@group(0)@binding(0)var<uniform>n:aT;@group(0)@binding(1)var<storage>u:aZ;@group(0)@binding(2)var<storage>aO:array<aS>;@group(0)@binding(3)var<storage>aW:array<da>;@group(0)@binding(4)var<storage,read_write>dJ:array<aS>;@group(0)@binding(5)var<storage,read_write>info:aZ;@group(0)@binding(6)var<storage,read_write>cY:array<eE>;${util}
const o=256u;var<workgroup>aG:array<aS,o>;@compute @workgroup_size(256)fn main(@builtin(global_invocation_id)N:M,@builtin(local_invocation_id)k:M,@builtin(workgroup_id)ap:M){let p=N.x;var agg=iy();if k.x<ap.x{agg=aO[k.x];}aG[k.x]=agg;for(var i=e;i<firstTrailingBit(o);i+=f){workgroupBarrier();if k.x+(f<<i)<o{let au=aG[k.x+(f<<i)];agg=eA(agg,au);}workgroupBarrier();aG[k.x]=agg;}workgroupBarrier();var bx=aG[0];workgroupBarrier();let K=gN(p);agg=ha(K);aG[k.x]=agg;for(var i=e;i<firstTrailingBit(o);i+=f){workgroupBarrier();if k.x>=f<<i{let au=aG[k.x-(f<<i)];agg=eA(agg,au);}workgroupBarrier();aG[k.x]=agg;}workgroupBarrier();if k.x>e{bx=eA(bx,aG[k.x-f]);}if p<n.cP{dJ[p]=bx;}let E=n.fz+bx.bJ;let Y=bx.Q;if K==fx||K==ez||K==ey||K==ex||K==dQ{let l=aW[bx.ac];let jl=j(l.ad>=c);var Z=aR();var ad=l.ad;if ad>=c||K==ez||K==ey||K==ex{Z=gO(n.eB,l.bL);}if ad>=c{let P=Z.P;ad*=sqrt(abs(P.x*P.w-P.y*P.z));}switch K{case fx:{info[Y]=bitcast<j>(ad);}case ez:{info[Y]=bitcast<j>(ad);var s=bitcast<B>(vec2(u[E+f],u[E+2u]));var v=bitcast<B>(vec2(u[E+3u],u[E+4u]));s=c2(Z,s);v=c2(Z,v);let fb=v-s;let bh=d/dot(fb,fb);let fa=fb*bh;let dM=-dot(s,fa);info[Y+f]=bitcast<j>(fa.x);info[Y+2u]=bitcast<j>(fa.y);info[Y+3u]=bitcast<j>(dM);}case ey:{let e9=d/h(1<<12u);info[Y]=bitcast<j>(ad);var s=bitcast<B>(vec2(u[E+f],u[E+2u]));var v=bitcast<B>(vec2(u[E+3u],u[E+4u]));var bE=bitcast<h>(u[E+5u]);var bf=bitcast<h>(u[E+6u]);let gf=fq(Z);var d2=aR();var bc=c;var aX=c;var bI=e;var aE=e;if abs(bE-bf)<=e9{bI=hg;let ge=bE/distance(s,v);d2=dK(gi(s,v),gf);aX=ge*ge;}else{bI=iH;if all(s==v){bI=hh;s+=e9;}if bf==c{aE|=he;let hY=s;s=v;v=hY;let hX=bE;bE=bf;bf=hX;}bc=bE/(bE-bf);let gd=(d-bc)*s+bc*v;aX=bf/(distance(gd,v));let e8=dK(gi(gd,v),gf);var e7=e8;if abs(aX-d)<=e9{bI=hf;let bh=.5*abs(d-bc);e7=dK(aR(vec4(bh,c,0.,bh),vec2(c)),e8);}else{let a=aX*aX- d;let gc=abs(d-bc)/a;let hW=aX*gc;let hV=sqrt(abs(a))*gc;e7=dK(aR(vec4(hW,c,0.,hV),vec2(c)),e8);}d2=e7;}let d5=bitcast<co>(d2.P);let f9=bitcast<vec2u>(d2.b4);info[Y+f]=d5.x;info[Y+2u]=d5.y;info[Y+3u]=d5.z;info[Y+4u]=d5.w;info[Y+5u]=f9.x;info[Y+6u]=f9.y;info[Y+7u]=bitcast<j>(bc);info[Y+8u]=bitcast<j>(aX);info[Y+9u]=bitcast<j>((aE<<3u)|bI);}case ex:{info[Y]=bitcast<j>(ad);let d4=fq(Z);let d3=bitcast<co>(d4.P);let f8=bitcast<vec2u>(d4.b4);info[Y+f]=d3.x;info[Y+2u]=d3.y;info[Y+3u]=d3.z;info[Y+4u]=d3.w;info[Y+5u]=f8.x;info[Y+6u]=f8.y;info[Y+7u]=u[E];info[Y+8u]=u[E+f];info[Y+9u]=u[E+2u];}default:{}}}if K==dQ||K==ew{var ac=~p;if K==dQ{ac=bx.ac;}cY[bx.cm]=eE(p,m(ac));}}fn gi(s:B,v:B)->aR{let hU=gh(s,v);let d4=fq(hU);let hT=gh(vec2(c),vec2(d,c));return dK(hT,d4);}fn gh(s:B,v:B)->aR{return aR(vec4(v.y-s.y,s.x-v.x,v.x-s.x,v.y-s.y),vec2(s.x,s.y));}`
