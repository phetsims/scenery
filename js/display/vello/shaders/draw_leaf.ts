/* eslint-disable */
import util from './shared/util.js';
import transform from './shared/transform.js';
import bbox from './shared/bbox.js';
import drawtag from './shared/drawtag.js';
import clip from './shared/clip.js';
import config from './shared/config.js';
import pre from './shared/pre.js';

export default `${pre}${config}
${clip}
${drawtag}
${bbox}
${transform}
@group(0)@binding(0)var<uniform>n:aV;@group(0)@binding(1)var<storage>u:a0;@group(0)@binding(2)var<storage>aQ:array<aU>;@group(0)@binding(3)var<storage>aY:array<db>;@group(0)@binding(4)var<storage,read_write>dK:array<aU>;@group(0)@binding(5)var<storage,read_write>info:a0;@group(0)@binding(6)var<storage,read_write>cZ:array<eF>;${util}
const o=256u;var<workgroup>aG:array<aU,o>;@compute @workgroup_size(256)fn main(@builtin(global_invocation_id)N:M,@builtin(local_invocation_id)k:M,@builtin(workgroup_id)ap:M){let p=N.x;var agg=iz();if k.x<ap.x{agg=aQ[k.x];}aG[k.x]=agg;for(var i=e;i<firstTrailingBit(o);i+=f){workgroupBarrier();if k.x+(f<<i)<o{let au=aG[k.x+(f<<i)];agg=eB(agg,au);}workgroupBarrier();aG[k.x]=agg;}workgroupBarrier();var by=aG[0];workgroupBarrier();let K=gP(p);agg=hc(K);aG[k.x]=agg;for(var i=e;i<firstTrailingBit(o);i+=f){workgroupBarrier();if k.x>=f<<i{let au=aG[k.x-(f<<i)];agg=eB(agg,au);}workgroupBarrier();aG[k.x]=agg;}workgroupBarrier();if k.x>e{by=eB(by,aG[k.x-f]);}if p<n.cQ{dK[p]=by;}let E=n.fB+by.bK;let W=by.P;if K==fz||K==eA||K==ez||K==ey||K==dR{let l=aY[by.ac];let jn=j(l.ad>=c);var Z=aT();var ad=l.ad;if ad>=c||K==eA||K==ez||K==ey{Z=gQ(n.eC,l.bM);}if ad>=c{let Q=Z.Q;ad*=sqrt(abs(Q.x*Q.w-Q.y*Q.z));}switch K{case fz:{info[W]=bitcast<j>(ad);}case eA:{info[W]=bitcast<j>(ad);var s=bitcast<B>(vec2(u[E+f],u[E+2u]));var v=bitcast<B>(vec2(u[E+3u],u[E+4u]));s=c3(Z,s);v=c3(Z,v);let fd=v-s;let bj=d/dot(fd,fd);let fc=fd*bj;let dN=-dot(s,fc);info[W+f]=bitcast<j>(fc.x);info[W+2u]=bitcast<j>(fc.y);info[W+3u]=bitcast<j>(dN);}case ez:{let fb=d/h(1<<12u);info[W]=bitcast<j>(ad);var s=bitcast<B>(vec2(u[E+f],u[E+2u]));var v=bitcast<B>(vec2(u[E+3u],u[E+4u]));var bF=bitcast<h>(u[E+5u]);var bi=bitcast<h>(u[E+6u]);let gi=fs(Z);var d3=aT();var be=c;var aZ=c;var bJ=e;var aF=e;if abs(bF-bi)<=fb{bJ=hi;let gh=bF/distance(s,v);d3=dL(gk(s,v),gi);aZ=gh*gh;}else{bJ=iJ;if all(s==v){bJ=hj;s+=fb;}if bi==c{aF|=hg;let hZ=s;s=v;v=hZ;let hY=bF;bF=bi;bi=hY;}be=bF/(bF-bi);let gf=(d-be)*s+be*v;aZ=bi/(distance(gf,v));let fa=dL(gk(gf,v),gi);var e9=fa;if abs(aZ-d)<=fb{bJ=hh;let bj=.5*abs(d-be);e9=dL(aT(vec4(bj,c,0.,bj),vec2(c)),fa);}else{let a=aZ*aZ- d;let ge=abs(d-be)/a;let hX=aZ*ge;let hW=sqrt(abs(a))*ge;e9=dL(aT(vec4(hX,c,0.,hW),vec2(c)),fa);}d3=e9;}let d6=bitcast<cp>(d3.Q);let gd=bitcast<vec2u>(d3.b5);info[W+f]=d6.x;info[W+2u]=d6.y;info[W+3u]=d6.z;info[W+4u]=d6.w;info[W+5u]=gd.x;info[W+6u]=gd.y;info[W+7u]=bitcast<j>(be);info[W+8u]=bitcast<j>(aZ);info[W+9u]=bitcast<j>((aF<<3u)|bJ);}case ey:{info[W]=bitcast<j>(ad);let d5=fs(Z);let d4=bitcast<cp>(d5.Q);let gc=bitcast<vec2u>(d5.b5);info[W+f]=d4.x;info[W+2u]=d4.y;info[W+3u]=d4.z;info[W+4u]=d4.w;info[W+5u]=gc.x;info[W+6u]=gc.y;info[W+7u]=u[E];info[W+8u]=u[E+f];info[W+9u]=u[E+2u];info[W+10u]=u[E+3u];}default:{}}}if K==dR||K==ex{var ac=~p;if K==dR{ac=by.ac;}cZ[by.cn]=eF(p,m(ac));}}fn gk(s:B,v:B)->aT{let hV=gj(s,v);let d5=fs(hV);let hU=gj(vec2(c),vec2(d,c));return dL(hU,d5);}fn gj(s:B,v:B)->aT{return aT(vec4(v.y-s.y,s.x-v.x,v.x-s.x,v.y-s.y),vec2(s.x,s.y));}`
