/* eslint-disable */
import util from './shared/util.js';
import transform from './shared/transform.js';
import bbox from './shared/bbox.js';
import drawtag from './shared/drawtag.js';
import clip from './shared/clip.js';
import config from './shared/config.js';
import pre from './shared/pre.js';

export default `${pre}${config}
${clip}
${drawtag}
${bbox}
${transform}
@group(0)@binding(0)var<uniform>n:aR;@group(0)@binding(1)var<storage>s:aX;@group(0)@binding(2)var<storage>aP:array<aQ>;@group(0)@binding(3)var<storage>aU:array<da>;@group(0)@binding(4)var<storage,read_write>dK:array<aQ>;@group(0)@binding(5)var<storage,read_write>info:aX;@group(0)@binding(6)var<storage,read_write>cX:array<eu>;${util}
const o=256u;fn fa(c6:i,p:i)->aL{let an=c6+p*6u;let e9=bitcast<h>(s[an]);let e8=bitcast<h>(s[an+f]);let e7=bitcast<h>(s[an+2u]);let e6=bitcast<h>(s[an+3u]);let e5=bitcast<h>(s[an+4u]);let e4=bitcast<h>(s[an+5u]);let K=vec4(e9,e8,e7,e6);let bh=vec2(e5,e4);return aL(K,bh);}var<workgroup>aG:array<aQ,o>;@compute @workgroup_size(256)fn main(@builtin(global_invocation_id)N:M,@builtin(local_invocation_id)k:M,@builtin(workgroup_id)at:M){let p=N.x;var agg=iv();if k.x<at.x{agg=aP[k.x];}aG[k.x]=agg;for(var j=e;j<firstTrailingBit(o);j+=f){workgroupBarrier();if k.x+(f<<j)<o{let aw=aG[k.x+(f<<j)];agg=er(agg,aw);}workgroupBarrier();aG[k.x]=agg;}workgroupBarrier();var bx=aG[0];workgroupBarrier();let L=gI(p);agg=g3(L);aG[k.x]=agg;for(var j=e;j<firstTrailingBit(o);j+=f){workgroupBarrier();if k.x>=f<<j{let aw=aG[k.x-(f<<j)];agg=er(agg,aw);}workgroupBarrier();aG[k.x]=agg;}workgroupBarrier();if k.x>e{bx=er(bx,aG[k.x-f]);}if p<n.cO{dK[p]=bx;}let E=n.fy+bx.bM;let Z=bx.Q;if L==fw||L==eq||L==ep||L==eo||L==dR{let l=aU[bx.ac];let ji=i(l.ad>=c);var Y=aL();var ad=l.ad;if ad>=c||L==eq||L==ep||L==eo{Y=fa(n.c6,l.bO);}if ad>=c{let K=Y.K;ad*=sqrt(abs(K.x*K.w-K.y*K.z));}switch L{case 66u:{info[Z]=bitcast<i>(ad);}case 266u:{info[Z]=bitcast<i>(ad);var t=bitcast<B>(vec2(s[E+f],s[E+2u]));var v=bitcast<B>(vec2(s[E+3u],s[E+4u]));t=c1(Y,t);v=c1(Y,v);let e3=v-t;let bd=d/dot(e3,e3);let e2=e3*bd;let dN=-dot(t,e2);info[Z+f]=bitcast<i>(e2.x);info[Z+2u]=bitcast<i>(e2.y);info[Z+3u]=bitcast<i>(dN);}case 654u:{let e1=d/h(1<<12u);info[Z]=bitcast<i>(ad);var t=bitcast<B>(vec2(s[E+f],s[E+2u]));var v=bitcast<B>(vec2(s[E+3u],s[E+4u]));var bD=bitcast<h>(s[E+5u]);var bc=bitcast<h>(s[E+6u]);let f8=fp(Y);var ce=aL();var a8=c;var aV=c;var bL=e;var aF=e;if abs(bD-bc)<=e1{bL=g9;let f7=bD/distance(t,v);ce=dL(gc(t,v),f8);aV=f7*f7;}else{bL=iE;if all(t==v){bL=ha;t+=e1;}if bc==c{aF|=g7;let hU=t;t=v;v=hU;let hT=bD;bD=bc;bc=hT;}a8=bD/(bD-bc);let f6=(d-a8)*t+a8*v;aV=bc/(distance(f6,v));let e0=dL(gc(f6,v),f8);var e_=e0;if abs(aV-d)<=e1{bL=g8;let bd=.5*abs(d-a8);e_=dL(aL(vec4(bd,c,0.,bd),vec2(c)),e0);}else{let a=aV*aV- d;let f5=abs(d-a8)/a;let hS=aV*f5;let hR=sqrt(abs(a))*f5;e_=dL(aL(vec4(hS,c,0.,hR),vec2(c)),e0);}ce=e_;}info[Z+f]=bitcast<i>(ce.K.x);info[Z+2u]=bitcast<i>(ce.K.y);info[Z+3u]=bitcast<i>(ce.K.z);info[Z+4u]=bitcast<i>(ce.K.w);info[Z+5u]=bitcast<i>(ce.bh.x);info[Z+6u]=bitcast<i>(ce.bh.y);info[Z+7u]=bitcast<i>(a8);info[Z+8u]=bitcast<i>(aV);info[Z+9u]=bitcast<i>((aF<<3u)|bL);}case 580u:{info[Z]=bitcast<i>(ad);let cf=fp(Y);info[Z+f]=bitcast<i>(cf.K.x);info[Z+2u]=bitcast<i>(cf.K.y);info[Z+3u]=bitcast<i>(cf.K.z);info[Z+4u]=bitcast<i>(cf.K.w);info[Z+5u]=bitcast<i>(cf.bh.x);info[Z+6u]=bitcast<i>(cf.bh.y);info[Z+7u]=s[E];info[Z+8u]=s[E+f];}default:{}}}if L==dR||L==en{var ac=~p;if L==dR{ac=bx.ac;}cX[bx.cn]=eu(p,m(ac));}}fn gc(t:B,v:B)->aL{let hQ=f9(t,v);let cf=fp(hQ);let hP=f9(vec2(c),vec2(d,c));return dL(hP,cf);}fn f9(t:B,v:B)->aL{return aL(vec4(v.y-t.y,t.x-v.x,v.x-t.x,v.y-t.y),vec2(t.x,t.y));}`
