/* eslint-disable */
import util from './shared/util.js';
import transform from './shared/transform.js';
import bbox from './shared/bbox.js';
import drawtag from './shared/drawtag.js';
import clip from './shared/clip.js';
import config from './shared/config.js';
import pre from './shared/pre.js';

export default `${pre}${config}
${clip}
${drawtag}
${bbox}
${transform}
@group(0)@binding(0)var<uniform>n:aR;@group(0)@binding(1)var<storage>u:aX;@group(0)@binding(2)var<storage>aN:array<aQ>;@group(0)@binding(3)var<storage>aU:array<c8>;@group(0)@binding(4)var<storage,read_write>dI:array<aQ>;@group(0)@binding(5)var<storage,read_write>info:aX;@group(0)@binding(6)var<storage,read_write>cW:array<eC>;${util}
const o=256u;var<workgroup>aF:array<aQ,o>;@compute @workgroup_size(256)fn main(@builtin(global_invocation_id)N:M,@builtin(local_invocation_id)k:M,@builtin(workgroup_id)ap:M){let p=N.x;var agg=iv();if k.x<ap.x{agg=aN[k.x];}aF[k.x]=agg;for(var i=e;i<firstTrailingBit(o);i+=f){workgroupBarrier();if k.x+(f<<i)<o{let au=aF[k.x+(f<<i)];agg=ey(agg,au);}workgroupBarrier();aF[k.x]=agg;}workgroupBarrier();var bv=aF[0];workgroupBarrier();let K=gH(p);agg=g3(K);aF[k.x]=agg;for(var i=e;i<firstTrailingBit(o);i+=f){workgroupBarrier();if k.x>=f<<i{let au=aF[k.x-(f<<i)];agg=ey(agg,au);}workgroupBarrier();aF[k.x]=agg;}workgroupBarrier();if k.x>e{bv=ey(bv,aF[k.x-f]);}if p<n.cN{dI[p]=bv;}let E=n.fv+bv.bG;let Z=bv.R;if K==ft||K==ex||K==ew||K==ev||K==dP{let l=aU[bv.ac];let ji=j(l.ad>=c);var Y=aP();var ad=l.ad;if ad>=c||K==ex||K==ew||K==ev{Y=gI(n.ez,l.bI);}if ad>=c{let P=Y.P;ad*=sqrt(abs(P.x*P.w-P.y*P.z));}switch K{case ft:{info[Z]=bitcast<j>(ad);}case ex:{info[Z]=bitcast<j>(ad);var s=bitcast<A>(vec2(u[E+f],u[E+2u]));var v=bitcast<A>(vec2(u[E+3u],u[E+4u]));s=c0(Y,s);v=c0(Y,v);let e7=v-s;let bd=d/dot(e7,e7);let e6=e7*bd;let dL=-dot(s,e6);info[Z+f]=bitcast<j>(e6.x);info[Z+2u]=bitcast<j>(e6.y);info[Z+3u]=bitcast<j>(dL);}case ew:{let e5=d/h(1<<12u);info[Z]=bitcast<j>(ad);var s=bitcast<A>(vec2(u[E+f],u[E+2u]));var v=bitcast<A>(vec2(u[E+3u],u[E+4u]));var bB=bitcast<h>(u[E+5u]);var bc=bitcast<h>(u[E+6u]);let f7=fl(Y);var d0=aP();var a8=c;var aV=c;var bF=e;var aE=e;if abs(bB-bc)<=e5{bF=g9;let f6=bB/distance(s,v);d0=dJ(f9(s,v),f7);aV=f6*f6;}else{bF=iE;if all(s==v){bF=ha;s+=e5;}if bc==c{aE|=g7;let hU=s;s=v;v=hU;let hT=bB;bB=bc;bc=hT;}a8=bB/(bB-bc);let f5=(d-a8)*s+a8*v;aV=bc/(distance(f5,v));let e4=dJ(f9(f5,v),f7);var e3=e4;if abs(aV-d)<=e5{bF=g8;let bd=.5*abs(d-a8);e3=dJ(aP(vec4(bd,c,0.,bd),vec2(c)),e4);}else{let a=aV*aV- d;let f4=abs(d-a8)/a;let hS=aV*f4;let hR=sqrt(abs(a))*f4;e3=dJ(aP(vec4(hS,c,0.,hR),vec2(c)),e4);}d0=e3;}let d3=bitcast<cn>(d0.P);let f3=bitcast<vec2u>(d0.b2);info[Z+f]=d3.x;info[Z+2u]=d3.y;info[Z+3u]=d3.z;info[Z+4u]=d3.w;info[Z+5u]=f3.x;info[Z+6u]=f3.y;info[Z+7u]=bitcast<j>(a8);info[Z+8u]=bitcast<j>(aV);info[Z+9u]=bitcast<j>((aE<<3u)|bF);}case ev:{info[Z]=bitcast<j>(ad);let d2=fl(Y);let d1=bitcast<cn>(d2.P);let f2=bitcast<vec2u>(d2.b2);info[Z+f]=d1.x;info[Z+2u]=d1.y;info[Z+3u]=d1.z;info[Z+4u]=d1.w;info[Z+5u]=f2.x;info[Z+6u]=f2.y;info[Z+7u]=u[E];info[Z+8u]=u[E+f];}default:{}}}if K==dP||K==eu{var ac=~p;if K==dP{ac=bv.ac;}cW[bv.cl]=eC(p,m(ac));}}fn f9(s:A,v:A)->aP{let hQ=f8(s,v);let d2=fl(hQ);let hP=f8(vec2(c),vec2(d,c));return dJ(hP,d2);}fn f8(s:A,v:A)->aP{return aP(vec4(v.y-s.y,s.x-v.x,v.x-s.x,v.y-s.y),vec2(s.x,s.y));}`
