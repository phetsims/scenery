/* eslint-disable */
import bump from './shared/bump.js';
import cubic from './shared/cubic.js';
import segment from './shared/segment.js';
import tile from './shared/tile.js';
import pathtag from './shared/pathtag.js';
import config from './shared/config.js';
import pre from './shared/pre.js';

export default `${pre}${config}
${pathtag}
${tile}
${segment}
${cubic}
${bump}
@group(0)@binding(0)var<uniform>n:aR;@group(0)@binding(1)var<storage>u:aX;@group(0)@binding(2)var<storage>b5:array<ak>;@group(0)@binding(3)var<storage>eG:array<fs>;@group(0)@binding(4)var<storage>bM:array<cJ>;struct eX{O:c9,aj:bS}@group(0)@binding(5)var<storage,read_write>ao:eC;@group(0)@binding(6)var<storage,read_write>X:array<eX>;@group(0)@binding(7)var<storage,read_write>aj:array<dI>;struct cA{ah:h,af:h,bx:h}const by=.67;fn cz(x:h)->h{return x*inverseSqrt(sqrt(d-by+(by*by*by*by+.25*x*x)));}const cx=.39;fn cy(x:h)->h{return x*sqrt(d-cx+(cx*cx+.5*x*x));}fn eW(s:B,v:B,H:B,db:h)->cA{let dr=v-s;let dq=H-v;let E=dr-dq;let cross=(H.x-s.x)*E.y-(H.y-s.y)*E.x;let dp=select(d/cross,1.e9,abs(cross)<1.e-9);let J=dot(dr,E)*dp;let cw=dot(dq,E)*dp;let bd=abs(cross/(length(E)*(cw-J)));let af=cz(J);let bx=cz(cw);var ah=c;if bd<1e9{let eT=abs(bx-af);let dn=sqrt(bd);if sign(J)==sign(cw){ah=dn;}else{let cE=db/dn;ah=db/cz(cE);}ah*=eT;}return cA(ah,af,bx);}fn eV(s:B,v:B,H:B,A:h)->B{let aA=d-A;return s*(aA*aA)+(v*(aA*2.)+H*A)*A;}fn bY(s:B,v:B,H:B,R:B,A:h)->B{let aA=d-A;return s*(aA*aA*aA)+(v*(aA*aA*3.)+(H*(aA*3.)+R*A)*A)*A;}fn eU()->j{var a5=atomicAdd(&ao.aj,f)+f;if a5+f>n.iy{a5=e;atomicOr(&ao.aq,hc);}return a5;}const dm=16u;@compute @workgroup_size(256)fn main(@builtin(global_invocation_id)N:M){if(atomicLoad(&ao.aq)&(eB|fw))!=e{return;}let p=N.x;let K=u[n.dO+(p>>2u)];let b7=(p&3u)*8u;var b6=(K>>b7)&255u;if(b6&fq)!=e{let bm=eG[N.x];let W=bM[bm.ac];let fK=(bm.aE&iw)!=e;let l=vec4i(W.l);let s=bm.s;let v=bm.v;let H=bm.H;let R=bm.R;let dl=3.*(H-v)+s-R;let eS=dot(dl,dl);let dk=.25;let cv=dk*.1;let dj=(dk-cv);let eR=432.*cv*cv;var bw=max(j(ceil(pow(eS*(d/eR),d/6.))),f);bw=min(bw,dm);var da:array<cA,dm>;var ah=c;var aZ=s;let step=d/h(bw);for(var i=e;i<bw;i+=f){let A=h(i+f)*step;let a_=bY(s,v,H,R,A);var aY=bY(s,v,H,R,A- .5*step);aY=2.*aY- .5*(aZ+a_);let az=eW(aZ,aY,a_,sqrt(dj));da[i]=az;ah+=az.ah;aZ=a_;}let bH=max(j(ceil(ah*(.5/sqrt(dj)))),f);var ae=s;aZ=s;let di=ah/h(bH);var bW=f;var cs=c;for(var i=e;i<bw;i+=f){let A=h(i+f)*step;let a_=bY(s,v,H,R,A);var aY=bY(s,v,H,R,A- .5*step);aY=2.*aY- .5*(aZ+a_);let az=da[i];let dh=cy(az.af);let eQ=cy(az.bx);let eP=d/(eQ-dh);var cr=h(bW)*di;while bW==bH||cr<cs+az.ah{var ay:B;if bW==bH{ay=R;}else{let eO=(cr-cs)/az.ah;let a=mix(az.af,az.bx,eO);let eN=cy(a);let A=(eN-dh)*eP;ay=eV(aZ,aY,a_,A);}let bX=min(ae,ay)-bm.a2;let dg=max(ae,ay)+bm.a2;let aI=ay-ae;let eM=d/aI.x;let cu=select(aI.x/aI.y,1.e9,abs(aI.y)<1.e-9);let aC=d/h(cQ);let bs=d/h(bu);let t=(bm.a2.x+abs(cu)*(.5*h(bu)+bm.a2.y))*aC;let b=cu;let a=(ae.x-(ae.y- .5*h(bu))*b)*aC;var J=m(floor(bX.x*aC));var T=m(floor(dg.x*aC)+d);var S=m(floor(bX.y*bs));var V=m(floor(dg.y*bs)+d);J=clamp(J,l.x,l.z);T=clamp(T,l.x,l.z);S=clamp(S,l.y,l.w);V=clamp(V,l.y,l.w);var cq=a+b*h(S);let dz=l.z-l.x;var aO=m(W.X)+(S-l.y)*dz-l.x;var a9=m(floor(ae.x*aC));var cp=m(floor(ay.x*aC));if aI.y<c{let eL=a9;a9=cp;cp=eL;}for(var y=S;y<V;y+=1){let eK=h(y)*h(bu);let df=max(a9+1,l.x);if!fK&&bX.y<eK&&df<l.z{let O=select(-1,1,aI.y<c);let aJ=aO+df;atomicAdd(&X[aJ].O,O);}var bV=cp;if y+1<V{let eJ=h(y+1)*h(bu);let eI=ae.x+(eJ-ae.y)*cu;bV=m(floor(eI*aC));}let de=min(a9,bV);let dd=max(a9,bV);var co=min(m(floor(cq-t)),de);var cn=max(m(ceil(cq+t)),dd+1);co=clamp(co,J,T);cn=clamp(cn,J,T);var ax:dI;for(var x=co;x<cn;x+=1){let ct=h(x)*h(cQ);let aJ=aO+x;let dc=eU();let eH=atomicExchange(&X[aJ].aj,dc);ax.cK=ae;ax.aD=aI;var a7=c;if!fK{a7=mix(ae.y,ay.y,(ct-ae.x)*eM);if bX.x<ct{let bN=vec2(ct,a7);if aI.x<c{ax.aD=bN-ae;}else{ax.cK=bN;ax.aD=ay-bN;}if ax.aD.x==c{ax.aD.x=sign(aI.x)*1e-9;}}if x<=de||dd<x{a7=1e9;}}ax.a7=a7;ax.em=eH;aj[dc]=ax;}cq+=b;aO+=dz;a9=bV;}bW+=f;cr+=di;ae=ay;}cs+=az.ah;aZ=a_;}}}`
