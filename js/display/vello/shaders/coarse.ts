/* eslint-disable */
import tile from './shared/tile.js';
import ptcl from './shared/ptcl.js';
import drawtag from './shared/drawtag.js';
import bump from './shared/bump.js';
import config from './shared/config.js';
import pre from './shared/pre.js';

export default `${pre}${config}
${bump}
${drawtag}
${ptcl}
${tile}
@group(0)@binding(0)var<uniform>n:aR;@group(0)@binding(1)var<storage>s:aX;@group(0)@binding(2)var<storage>b2:array<aQ>;struct fj{bp:j,ce:j}@group(0)@binding(3)var<storage>hV:array<fj>;@group(0)@binding(4)var<storage>dz:aX;@group(0)@binding(5)var<storage>bN:array<cJ>;@group(0)@binding(6)var<storage>W:array<bs>;@group(0)@binding(7)var<storage,read_write>ap:eE;@group(0)@binding(8)var<storage,read_write>q:aX;const o=256u;const cf=8u;var<workgroup>bD:array<array<bT,aN>,cf>;var<workgroup>bL:array<j,o>;var<workgroup>gf:array<j,o>;var<workgroup>dy:array<j,o>;var<workgroup>fb:array<j,o>;var<workgroup>ge:array<j,o>;var<workgroup>gd:array<j,o>;var<workgroup>be:array<j,o>;var<workgroup>fa:array<j,o>;var<private>D:j;var<private>e9:j;fn cV(size:j){if D+size>=e9{let h3=n.aM*n.cO*er;var d8=h3+atomicAdd(&ap.q,fq);if d8+fq>n.ix{d8=e;atomicOr(&ap.at,iF);}q[D]=gJ;q[D+f]=d8;D=d8;e9=D+(fq-gU);}}fn dD(F:bs,ad:h)->bool{cV(3u);if ad<c{let cU=ad<-d;if F.aj!=e{let cI=fs(F.aj,F.P);q[D]=gS;let h2=select(cI.F<<f,(cI.F<<f)|f,cU);q[D+f]=h2;q[D+2u]=j(cI.P);D+=3u;}else{if cU&&(abs(F.P)&1)==0{return false;}q[D]=gQ;D+=f;}}else{let a2=fr(F.aj,.5*ad);q[D]=gR;q[D+f]=a2.F;q[D+2u]=bitcast<j>(a2.c3);D+=3u;}return true;}fn h7(b1:et){cV(2u);q[D]=gP;q[D+f]=b1.c2;D+=2u;}fn gn(ty:j,aW:j,R:j){cV(3u);q[D]=ty;q[D+f]=aW;q[D+2u]=R;D+=3u;}fn h6(R:j){cV(2u);q[D]=gM;q[D+f]=R;D+=2u;}fn h5(){cV(f);q[D]=gL;D+=f;}fn h4(aC:es){let eh=bitcast<cn>(aC.ck);let eg=bitcast<cn>(aC.cj);let ef=bitcast<cn>(aC.ci);let ee=bitcast<cn>(aC.b3);let ed=bitcast<cn>(aC.ch);cV(23u);q[D]=gK;q[D+f]=aC.bi;q[D+2u]=eh.x;q[D+3u]=eh.y;q[D+4u]=eh.z;q[D+5u]=eh.w;q[D+6u]=eg.x;q[D+7u]=eg.y;q[D+8u]=eg.z;q[D+9u]=eg.w;q[D+10u]=ef.x;q[D+11u]=ef.y;q[D+12u]=ef.z;q[D+13u]=ef.w;q[D+14u]=ee.x;q[D+15u]=ee.y;q[D+16u]=ee.z;q[D+17u]=ee.w;q[D+18u]=ed.x;q[D+19u]=ed.y;q[D+20u]=ed.z;q[D+21u]=ed.w;q[D+22u]=select(e,f,aC.c1);D+=23u;}@compute @workgroup_size(256)fn main(@builtin(local_invocation_id)k:M,@builtin(workgroup_id)aq:M){if k.x==e{bL[0]=atomicLoad(&ap.at);}let at=workgroupUniformLoad(&bL[0]);if(at&(eD|fz|hb))!=e{return;}let cY=(n.aM+bh-f)/bh;let dI=cY*aq.y+aq.x;let ec=(n.cN+aN- f)/aN;let eb=bh*aq.x;let ea=cP*aq.y;let ff=k.x % bh;let fe=k.x/bh;let h1=(ea+fe)*n.aM+eb+ff;D=h1*er;e9=D+(er-gU);var d7=e;var bf=e;var cT=e;var cH=e;var cG=e;var fd=e;var cc=e;var fc=e;var d6=e;let gm=D;D+=f;while true{for(var i=e;i<cf;i+=f){atomicStore(&bD[i][k.x],e);}while true{if cc==cG&&cT<ec{fd=cc;var cb=e;if cT+k.x<ec{let h0=(cT+k.x)*aN+dI;let dH=hV[h0];cb=dH.bp;gf[k.x]=dH.ce;}for(var i=e;i<firstTrailingBit(o);i+=f){bL[k.x]=cb;workgroupBarrier();if k.x>=(f<<i){cb+=bL[k.x-(f<<i)];}workgroupBarrier();}bL[k.x]=fd+cb;cc=workgroupUniformLoad(&bL[o- f]);cT+=o;}var p=cH+k.x;if p>=cG&&p<cc{var dA=e;for(var i=e;i<firstTrailingBit(o);i+=f){let bE=dA+((aN/2u)>>i);if p>=bL[bE- f]{dA=bE;}}p-=select(fd,bL[dA- f],dA>e);let a5=n.g4+gf[dA];dy[k.x]=dz[a5+p];}cG=min(cH+aN,cc);if cG-cH>=aN||(cG>=cc&&cT>=ec){break;}}var a4=cM;var aH:j;if k.x+cH<cG{aH=dy[k.x];a4=s[n.c6+aH];}var ca=e;if a4!=cM{let ac=b2[aH].ac;let X=bN[ac];let dC=X.l.z-X.l.x;fb[k.x]=dC;let gl=m(X.l.x)-m(eb);let dB=m(X.l.y)-m(ea);let J=clamp(gl,0,m(bh));let S=clamp(dB,0,m(cP));let T=clamp(m(X.l.z)-m(eb),0,m(bh));let V=clamp(m(X.l.w)-m(ea),0,m(cP));ge[k.x]=j(T-J);gd[k.x]=j(J)|j(S<<16u);ca=j(T-J)*j(V-S);let am=X.W-j(dB*m(dC)+gl);fa[k.x]=am;}be[k.x]=ca;for(var i=e;i<firstTrailingBit(aN);i+=f){workgroupBarrier();if k.x>=(f<<i){ca+=be[k.x-(f<<i)];}workgroupBarrier();be[k.x]=ca;}workgroupBarrier();let d9=be[aN- f];for(var p=k.x;p<d9;p+=aN){var aw=e;for(var i=e;i<firstTrailingBit(aN);i+=f){let bE=aw+((aN/2u)>>i);if p>=be[bE- f]{aw=bE;}}aH=dy[aw];a4=s[n.c6+aH];let en=p-select(e,be[aw- f],aw>e);let cg=ge[aw];let gk=gd[aw];let x=(gk&65535u)+en % cg;let y=(gk>>16u)+en/cg;let aK=fa[aw]+fb[aw]*y+x;let F=W[aK];let gj=(a4&f)!=e;var gh=false;if gj{let h_=(128u<<8u)|3u;let bH=b2[aH].bH;let E=n.fw+bH;let bi=s[E];gh=bi!=h_;}let hZ=F.aj!=e||(F.P==0)==gj||gh;if hZ{let hY=aw/32u;let hX=f<<(aw&31u);atomicOr(&bD[hY][y*bh+x],hX);}}workgroupBarrier();var d5=e;var cF=atomicLoad(&bD[e][k.x]);while true{if cF==e{d5+=f;if d5==cf{break;}cF=atomicLoad(&bD[d5][k.x]);if cF==e{continue;}}let aw=d5*32u+firstTrailingBit(cF);aH=dy[aw];cF&=cF- f;let bn=s[n.c6+aH];let gi=b2[aH];let E=n.fw+gi.bH;let Z=gi.R;if d7==e{let aK=fa[aw]+fb[aw]*fe+ff;let F=W[aK];switch bn{case fu:{let ad=bitcast<h>(dz[Z]);if dD(F,ad){let c2=s[E];h7(et(c2));}}case ey:{let ad=bitcast<h>(dz[Z]);if dD(F,ad){let aW=s[E];let R=Z+f;gn(gO,aW,R);}}case ex:{let ad=bitcast<h>(dz[Z]);if dD(F,ad){let aW=s[E];let R=Z+f;gn(gN,aW,R);}}case ew:{let ad=bitcast<h>(dz[Z]);if dD(F,ad){h6(Z+f);}}case dQ:{if F.aj==e&&F.P==0{d7=bf+f;}else{h5();fc+=f;d6=max(d6,fc);}bf+=f;}case ev:{bf-=f;dD(F,-d);let bi=s[E];let ck=bitcast<L>(vec4(s[E+f],s[E+2u],s[E+3u],s[E+4u]));let cj=bitcast<L>(vec4(s[E+5u],s[E+6u],s[E+7u],s[E+8u]));let ci=bitcast<L>(vec4(s[E+9u],s[E+10u],s[E+11u],s[E+12u]));let b3=bitcast<L>(vec4(s[E+13u],s[E+14u],s[E+15u],s[E+16u]));let ch=bitcast<L>(vec4(s[E+17u],s[E+18u],s[E+19u],s[E+20u]));let c1=ck.a!=c||cj.a!=c||ci.a!=c||ch.a!=c;h4(es(bi,ck,cj,ci,b3,ch,c1));fc-=f;}default:{}}}else{switch bn{case dQ:{bf+=f;}case ev:{if bf==d7{d7=e;}bf-=f;}default:{}}}}cH+=aN;if cH>=cc&&cT>=ec{break;}workgroupBarrier();}if eb+ff<n.aM&&ea+fe<n.cO{q[D]=gT;if d6>eB{let hW=d6*cQ*bu;q[gm]=atomicAdd(&ap.bi,hW);}}}`
