/* eslint-disable */
import tile from './shared/tile.js';
import ptcl from './shared/ptcl.js';
import drawtag from './shared/drawtag.js';
import bump from './shared/bump.js';
import config from './shared/config.js';
import pre from './shared/pre.js';

export default `${pre}${config}
${bump}
${drawtag}
${ptcl}
${tile}
@group(0)@binding(0)var<uniform>n:aR;@group(0)@binding(1)var<storage>u:aX;@group(0)@binding(2)var<storage>b_:array<aQ>;struct fh{bq:j,cd:j}@group(0)@binding(3)var<storage>hW:array<fh>;@group(0)@binding(4)var<storage>dx:aX;@group(0)@binding(5)var<storage>bM:array<cJ>;@group(0)@binding(6)var<storage>X:array<bt>;@group(0)@binding(7)var<storage,read_write>ao:eD;@group(0)@binding(8)var<storage,read_write>q:aX;const o=256u;const ce=8u;var<workgroup>bD:array<array<bS,aL>,ce>;var<workgroup>bK:array<j,o>;var<workgroup>gf:array<j,o>;var<workgroup>dw:array<j,o>;var<workgroup>e9:array<j,o>;var<workgroup>ge:array<j,o>;var<workgroup>gd:array<j,o>;var<workgroup>be:array<j,o>;var<workgroup>e8:array<j,o>;var<private>D:j;var<private>e7:j;fn cV(size:j){if D+size>=e7{let h4=n.aK*n.cO*ep;var d6=h4+atomicAdd(&ao.q,fp);if d6+fp>n.iy{d6=e;atomicOr(&ao.aq,iG);}q[D]=gK;q[D+f]=d6;D=d6;e7=D+(fp-gV);}}fn dB(F:bt,ad:h)->bool{cV(3u);if ad<c{let cU=ad<-d;if F.aj!=e{let cI=fr(F.aj,F.O);q[D]=gT;let h3=select(cI.F<<f,(cI.F<<f)|f,cU);q[D+f]=h3;q[D+2u]=j(cI.O);D+=3u;}else{if cU&&(abs(F.O)&1)==0{return false;}q[D]=gR;D+=f;}}else{let a2=fq(F.aj,.5*ad);q[D]=gS;q[D+f]=a2.F;q[D+2u]=bitcast<j>(a2.c3);D+=3u;}return true;}fn h8(bZ:er){cV(2u);q[D]=gQ;q[D+f]=bZ.c2;D+=2u;}fn gn(ty:j,aW:j,Q:j){cV(3u);q[D]=ty;q[D+f]=aW;q[D+2u]=Q;D+=3u;}fn h7(Q:j){cV(2u);q[D]=gN;q[D+f]=Q;D+=2u;}fn h6(){cV(f);q[D]=gM;D+=f;}fn h5(aB:eq){let ef=bitcast<cn>(aB.ci);let ee=bitcast<cn>(aB.ch);let ed=bitcast<cn>(aB.cg);let ec=bitcast<cn>(aB.b2);let eb=bitcast<cn>(aB.cf);cV(23u);q[D]=gL;q[D+f]=aB.bj;q[D+2u]=ef.x;q[D+3u]=ef.y;q[D+4u]=ef.z;q[D+5u]=ef.w;q[D+6u]=ee.x;q[D+7u]=ee.y;q[D+8u]=ee.z;q[D+9u]=ee.w;q[D+10u]=ed.x;q[D+11u]=ed.y;q[D+12u]=ed.z;q[D+13u]=ed.w;q[D+14u]=ec.x;q[D+15u]=ec.y;q[D+16u]=ec.z;q[D+17u]=ec.w;q[D+18u]=eb.x;q[D+19u]=eb.y;q[D+20u]=eb.z;q[D+21u]=eb.w;q[D+22u]=select(e,f,aB.c1);D+=23u;}@compute @workgroup_size(256)fn main(@builtin(local_invocation_id)k:M,@builtin(workgroup_id)ap:M){if k.x==e{bK[0]=atomicLoad(&ao.aq);}let aq=workgroupUniformLoad(&bK[0]);if(aq&(eC|fy|hd))!=e{return;}let cY=(n.aK+bi-f)/bi;let dG=cY*ap.y+ap.x;let ea=(n.cN+aL- f)/aL;let d9=bi*ap.x;let d8=cP*ap.y;let fd=k.x % bi;let fc=k.x/bi;let h2=(d8+fc)*n.aK+d9+fd;D=h2*ep;e7=D+(ep-gV);var d5=e;var bf=e;var cT=e;var cH=e;var cG=e;var fb=e;var cb=e;var fa=e;var d4=e;let gm=D;D+=f;while true{for(var i=e;i<ce;i+=f){atomicStore(&bD[i][k.x],e);}while true{if cb==cG&&cT<ea{fb=cb;var ca=e;if cT+k.x<ea{let h1=(cT+k.x)*aL+dG;let dF=hW[h1];ca=dF.bq;gf[k.x]=dF.cd;}for(var i=e;i<firstTrailingBit(o);i+=f){bK[k.x]=ca;workgroupBarrier();if k.x>=(f<<i){ca+=bK[k.x-(f<<i)];}workgroupBarrier();}bK[k.x]=fb+ca;cb=workgroupUniformLoad(&bK[o- f]);cT+=o;}var p=cH+k.x;if p>=cG&&p<cb{var dy=e;for(var i=e;i<firstTrailingBit(o);i+=f){let bE=dy+((aL/2u)>>i);if p>=bK[bE- f]{dy=bE;}}p-=select(fb,bK[dy- f],dy>e);let a5=n.g6+gf[dy];dw[k.x]=dx[a5+p];}cG=min(cH+aL,cb);if cG-cH>=aL||(cG>=cb&&cT>=ea){break;}}var a4=cM;var aG:j;if k.x+cH<cG{aG=dw[k.x];a4=u[n.c5+aG];}var b9=e;if a4!=cM{let ac=b_[aG].ac;let W=bM[ac];let dA=W.l.z-W.l.x;e9[k.x]=dA;let gl=m(W.l.x)-m(d9);let dz=m(W.l.y)-m(d8);let J=clamp(gl,0,m(bi));let S=clamp(dz,0,m(cP));let T=clamp(m(W.l.z)-m(d9),0,m(bi));let V=clamp(m(W.l.w)-m(d8),0,m(cP));ge[k.x]=j(T-J);gd[k.x]=j(J)|j(S<<16u);b9=j(T-J)*j(V-S);let aO=W.X-j(dz*m(dA)+gl);e8[k.x]=aO;}be[k.x]=b9;for(var i=e;i<firstTrailingBit(aL);i+=f){workgroupBarrier();if k.x>=(f<<i){b9+=be[k.x-(f<<i)];}workgroupBarrier();be[k.x]=b9;}workgroupBarrier();let d7=be[aL- f];for(var p=k.x;p<d7;p+=aL){var av=e;for(var i=e;i<firstTrailingBit(aL);i+=f){let bE=av+((aL/2u)>>i);if p>=be[bE- f]{av=bE;}}aG=dw[av];a4=u[n.c5+aG];let el=p-select(e,be[av- f],av>e);let b0=ge[av];let gk=gd[av];let x=(gk&65535u)+el % b0;let y=(gk>>16u)+el/b0;let aJ=e8[av]+e9[av]*y+x;let F=X[aJ];let gj=(a4&f)!=e;var gh=false;if gj{let h0=(128u<<8u)|3u;let bG=b_[aG].bG;let E=n.fv+bG;let bj=u[E];gh=bj!=h0;}let h_=F.aj!=e||(F.O==0)==gj||gh;if h_{let hZ=av/32u;let hY=f<<(av&31u);atomicOr(&bD[hZ][y*bi+x],hY);}}workgroupBarrier();var d3=e;var cF=atomicLoad(&bD[e][k.x]);while true{if cF==e{d3+=f;if d3==ce{break;}cF=atomicLoad(&bD[d3][k.x]);if cF==e{continue;}}let av=d3*32u+firstTrailingBit(cF);aG=dw[av];cF&=cF- f;let bo=u[n.c5+aG];let gi=b_[aG];let E=n.fv+gi.bG;let Y=gi.Q;if d5==e{let aJ=e8[av]+e9[av]*fc+fd;let F=X[aJ];switch bo{case ft:{let ad=bitcast<h>(dx[Y]);if dB(F,ad){let c2=u[E];h8(er(c2));}}case ew:{let ad=bitcast<h>(dx[Y]);if dB(F,ad){let aW=u[E];let Q=Y+f;gn(gP,aW,Q);}}case ev:{let ad=bitcast<h>(dx[Y]);if dB(F,ad){let aW=u[E];let Q=Y+f;gn(gO,aW,Q);}}case eu:{let ad=bitcast<h>(dx[Y]);if dB(F,ad){h7(Y+f);}}case dO:{if F.aj==e&&F.O==0{d5=bf+f;}else{h6();fa+=f;d4=max(d4,fa);}bf+=f;}case et:{bf-=f;dB(F,-d);let bj=u[E];let ci=bitcast<L>(vec4(u[E+f],u[E+2u],u[E+3u],u[E+4u]));let ch=bitcast<L>(vec4(u[E+5u],u[E+6u],u[E+7u],u[E+8u]));let cg=bitcast<L>(vec4(u[E+9u],u[E+10u],u[E+11u],u[E+12u]));let b2=bitcast<L>(vec4(u[E+13u],u[E+14u],u[E+15u],u[E+16u]));let cf=bitcast<L>(vec4(u[E+17u],u[E+18u],u[E+19u],u[E+20u]));let c1=ci.a!=c||ch.a!=c||cg.a!=c||cf.a!=c;h5(eq(bj,ci,ch,cg,b2,cf,c1));fa-=f;}default:{}}}else{switch bo{case dO:{bf+=f;}case et:{if bf==d5{d5=e;}bf-=f;}default:{}}}}cH+=aL;if cH>=cb&&cT>=ea{break;}workgroupBarrier();}if d9+fd<n.aK&&d8+fc<n.cO{q[D]=gU;if d4>eA{let hX=d4*cQ*bu;q[gm]=atomicAdd(&ao.bj,hX);}}}`
