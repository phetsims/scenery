/* eslint-disable */
import tile from './shared/tile.js';
import ptcl from './shared/ptcl.js';
import drawtag from './shared/drawtag.js';
import bump from './shared/bump.js';
import config from './shared/config.js';
import pre from './shared/pre.js';

export default `${pre}${config}
${bump}
${drawtag}
${ptcl}
${tile}
@group(0)@binding(0)var<uniform>n:aV;@group(0)@binding(1)var<storage>u:a0;@group(0)@binding(2)var<storage>b3:array<aU>;struct fo{bt:j,ce:j}@group(0)@binding(3)var<storage>hZ:array<fo>;@group(0)@binding(4)var<storage>dz:a0;@group(0)@binding(5)var<storage>bP:array<cK>;@group(0)@binding(6)var<storage>X:array<bv>;@group(0)@binding(7)var<storage,read_write>ao:eG;@group(0)@binding(8)var<storage,read_write>q:a0;const o=256u;const cf=8u;var<workgroup>bG:array<array<bW,aN>,cf>;var<workgroup>bN:array<j,o>;var<workgroup>gm:array<j,o>;var<workgroup>dy:array<j,o>;var<workgroup>ff:array<j,o>;var<workgroup>gl:array<j,o>;var<workgroup>gk:array<j,o>;var<workgroup>bj:array<j,o>;var<workgroup>fe:array<j,o>;var<private>D:j;var<private>fd:j;fn cX(size:j){if D+size>=fd{let h7=n.aM*n.cQ*es;var d9=h7+atomicAdd(&ao.q,ft);if d9+ft>n.iA{d9=e;atomicOr(&ao.aq,iJ);}q[D]=gR;q[D+f]=d9;D=d9;fd=D+(ft-g1);}}fn dD(F:bv,ad:h)->bool{cX(3u);if ad<c{let cW=ad<-d;if F.ak!=e{let cJ=fv(F.ak,F.O);q[D]=g_;let h6=select(cJ.F<<f,(cJ.F<<f)|f,cW);q[D+f]=h6;q[D+2u]=j(cJ.O);D+=3u;}else{if cW&&(abs(F.O)&1)==0{return false;}q[D]=gY;D+=f;}}else{let a6=fu(F.ak,.5*ad);q[D]=gZ;q[D+f]=a6.F;q[D+2u]=bitcast<j>(a6.c5);D+=3u;}return true;}fn ib(b2:eu){cX(2u);q[D]=gX;q[D+f]=b2.c4;D+=2u;}fn gu(ty:j,a_:j,Q:j){cX(3u);q[D]=ty;q[D+f]=a_;q[D+2u]=Q;D+=3u;}fn ia(Q:j){cX(2u);q[D]=gU;q[D+f]=Q;D+=2u;}fn h9(){cX(f);q[D]=gT;D+=f;}fn h8(aB:et){let ei=bitcast<co>(aB.cj);let eh=bitcast<co>(aB.ci);let eg=bitcast<co>(aB.ch);let ef=bitcast<co>(aB.b5);let ee=bitcast<co>(aB.cg);cX(23u);q[D]=gS;q[D+f]=aB.bm;q[D+2u]=ei.x;q[D+3u]=ei.y;q[D+4u]=ei.z;q[D+5u]=ei.w;q[D+6u]=eh.x;q[D+7u]=eh.y;q[D+8u]=eh.z;q[D+9u]=eh.w;q[D+10u]=eg.x;q[D+11u]=eg.y;q[D+12u]=eg.z;q[D+13u]=eg.w;q[D+14u]=ef.x;q[D+15u]=ef.y;q[D+16u]=ef.z;q[D+17u]=ef.w;q[D+18u]=ee.x;q[D+19u]=ee.y;q[D+20u]=ee.z;q[D+21u]=ee.w;q[D+22u]=select(e,f,aB.c3);D+=23u;}@compute @workgroup_size(256)fn main(@builtin(local_invocation_id)k:M,@builtin(workgroup_id)ap:M){if k.x==e{bN[0]=atomicLoad(&ao.aq);}let aq=workgroupUniformLoad(&bN[0]);if(aq&(eF|fD|hj))!=e{return;}let c_=(n.aM+bl-f)/bl;let dI=c_*ap.y+ap.x;let ed=(n.cP+aN- f)/aN;let ec=bl*ap.x;let eb=cR*ap.y;let fj=k.x % bl;let fi=k.x/bl;let h5=(eb+fi)*n.aM+ec+fj;D=h5*es;fd=D+(es-g1);var d8=e;var bk=e;var cV=e;var cI=e;var cH=e;var fh=e;var cc=e;var fg=e;var d7=e;let gt=D;D+=f;while true{for(var i=e;i<cf;i+=f){atomicStore(&bG[i][k.x],e);}while true{if cc==cH&&cV<ed{fh=cc;var cb=e;if cV+k.x<ed{let h4=(cV+k.x)*aN+dI;let dH=hZ[h4];cb=dH.bt;gm[k.x]=dH.ce;}for(var i=e;i<firstTrailingBit(o);i+=f){bN[k.x]=cb;workgroupBarrier();if k.x>=(f<<i){cb+=bN[k.x-(f<<i)];}workgroupBarrier();}bN[k.x]=fh+cb;cc=workgroupUniformLoad(&bN[o- f]);cV+=o;}var p=cI+k.x;if p>=cH&&p<cc{var dA=e;for(var i=e;i<firstTrailingBit(o);i+=f){let bH=dA+((aN/2u)>>i);if p>=bN[bH- f]{dA=bH;}}p-=select(fh,bN[dA- f],dA>e);let a5=n.hc+gm[dA];dy[k.x]=dz[a5+p];}cH=min(cI+aN,cc);if cH-cI>=aN||(cH>=cc&&cV>=ed){break;}}var a8=cO;var aH:j;if k.x+cI<cH{aH=dy[k.x];a8=u[n.c7+aH];}var ca=e;if a8!=cO{let ac=b3[aH].ac;let W=bP[ac];let dC=W.l.z-W.l.x;ff[k.x]=dC;let gs=m(W.l.x)-m(ec);let dB=m(W.l.y)-m(eb);let J=clamp(gs,0,m(bl));let S=clamp(dB,0,m(cR));let T=clamp(m(W.l.z)-m(ec),0,m(bl));let V=clamp(m(W.l.w)-m(eb),0,m(cR));gl[k.x]=j(T-J);gk[k.x]=j(J)|j(S<<16u);ca=j(T-J)*j(V-S);let aS=W.X-j(dB*m(dC)+gs);fe[k.x]=aS;}bj[k.x]=ca;for(var i=e;i<firstTrailingBit(aN);i+=f){workgroupBarrier();if k.x>=(f<<i){ca+=bj[k.x-(f<<i)];}workgroupBarrier();bj[k.x]=ca;}workgroupBarrier();let ea=bj[aN- f];for(var p=k.x;p<ea;p+=aN){var av=e;for(var i=e;i<firstTrailingBit(aN);i+=f){let bH=av+((aN/2u)>>i);if p>=bj[bH- f]{av=bH;}}aH=dy[av];a8=u[n.c7+aH];let eo=p-select(e,bj[av- f],av>e);let aR=gl[av];let gq=gk[av];let x=(gq&65535u)+eo % aR;let y=(gq>>16u)+eo/aR;let aK=fe[av]+ff[av]*y+x;let F=X[aK];let gp=(a8&f)!=e;var gn=false;if gp{let h3=(128u<<8u)|3u;let bJ=b3[aH].bJ;let E=n.fA+bJ;let bm=u[E];gn=bm!=h3;}let h2=F.ak!=e||(F.O==0)==gp||gn;if h2{let h1=av/32u;let h0=f<<(av&31u);atomicOr(&bG[h1][y*bl+x],h0);}}workgroupBarrier();var d6=e;var cG=atomicLoad(&bG[e][k.x]);while true{if cG==e{d6+=f;if d6==cf{break;}cG=atomicLoad(&bG[d6][k.x]);if cG==e{continue;}}let av=d6*32u+firstTrailingBit(cG);aH=dy[av];cG&=cG- f;let bq=u[n.c7+aH];let go=b3[aH];let E=n.fA+go.bJ;let Y=go.Q;if d8==e{let aK=fe[av]+ff[av]*fi+fj;let F=X[aK];switch bq{case fy:{let ad=bitcast<h>(dz[Y]);if dD(F,ad){let c4=u[E];ib(eu(c4));}}case ez:{let ad=bitcast<h>(dz[Y]);if dD(F,ad){let a_=u[E];let Q=Y+f;gu(gW,a_,Q);}}case ey:{let ad=bitcast<h>(dz[Y]);if dD(F,ad){let a_=u[E];let Q=Y+f;gu(gV,a_,Q);}}case ex:{let ad=bitcast<h>(dz[Y]);if dD(F,ad){ia(Y+f);}}case dQ:{if F.ak==e&&F.O==0{d8=bk+f;}else{h9();fg+=f;d7=max(d7,fg);}bk+=f;}case ew:{bk-=f;dD(F,-d);let bm=u[E];let cj=bitcast<L>(vec4(u[E+f],u[E+2u],u[E+3u],u[E+4u]));let ci=bitcast<L>(vec4(u[E+5u],u[E+6u],u[E+7u],u[E+8u]));let ch=bitcast<L>(vec4(u[E+9u],u[E+10u],u[E+11u],u[E+12u]));let b5=bitcast<L>(vec4(u[E+13u],u[E+14u],u[E+15u],u[E+16u]));let cg=bitcast<L>(vec4(u[E+17u],u[E+18u],u[E+19u],u[E+20u]));let c3=cj.a!=c||ci.a!=c||ch.a!=c||cg.a!=c;h8(et(bm,cj,ci,ch,b5,cg,c3));fg-=f;}default:{}}}else{switch bq{case dQ:{bk+=f;}case ew:{if bk==d8{d8=e;}bk-=f;}default:{}}}}cI+=aN;if cI>=cc&&cV>=ed{break;}workgroupBarrier();}if ec+fj<n.aM&&eb+fi<n.cQ{q[D]=g0;if d7>eD{let h_=d7*cS*bw;q[gt]=atomicAdd(&ao.bm,h_);}}}`
