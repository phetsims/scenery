/* eslint-disable */
import tile from './shared/tile.js';
import ptcl from './shared/ptcl.js';
import drawtag from './shared/drawtag.js';
import bump from './shared/bump.js';
import config from './shared/config.js';
import pre from './shared/pre.js';

export default `${pre}${config}
${bump}
${drawtag}
${ptcl}
${tile}
@group(0)@binding(0)var<uniform>n:aR;@group(0)@binding(1)var<storage>u:aX;@group(0)@binding(2)var<storage>b_:array<aQ>;struct fg{bq:j,cc:j}@group(0)@binding(3)var<storage>hV:array<fg>;@group(0)@binding(4)var<storage>dw:aX;@group(0)@binding(5)var<storage>bM:array<cJ>;@group(0)@binding(6)var<storage>X:array<bt>;@group(0)@binding(7)var<storage,read_write>ao:eC;@group(0)@binding(8)var<storage,read_write>q:aX;const o=256u;const cd=8u;var<workgroup>bD:array<array<bS,aL>,cd>;var<workgroup>bK:array<j,o>;var<workgroup>gd:array<j,o>;var<workgroup>dv:array<j,o>;var<workgroup>e8:array<j,o>;var<workgroup>gc:array<j,o>;var<workgroup>f9:array<j,o>;var<workgroup>be:array<j,o>;var<workgroup>e7:array<j,o>;var<private>D:j;var<private>e6:j;fn cV(size:j){if D+size>=e6{let h3=n.aK*n.cO*eo;var d5=h3+atomicAdd(&ao.q,fm);if d5+fm>n.ix{d5=e;atomicOr(&ao.aq,iF);}q[D]=gJ;q[D+f]=d5;D=d5;e6=D+(fm-gU);}}fn dA(F:bt,ad:h)->bool{cV(3u);if ad<c{let cU=ad<-d;if F.aj!=e{let cI=fp(F.aj,F.O);q[D]=gS;let h2=select(cI.F<<f,(cI.F<<f)|f,cU);q[D+f]=h2;q[D+2u]=j(cI.O);D+=3u;}else{if cU&&(abs(F.O)&1)==0{return false;}q[D]=gQ;D+=f;}}else{let a2=fo(F.aj,.5*ad);q[D]=gR;q[D+f]=a2.F;q[D+2u]=bitcast<j>(a2.c3);D+=3u;}return true;}fn h7(bZ:eq){cV(2u);q[D]=gP;q[D+f]=bZ.c2;D+=2u;}fn gl(ty:j,aW:j,Q:j){cV(3u);q[D]=ty;q[D+f]=aW;q[D+2u]=Q;D+=3u;}fn h6(Q:j){cV(2u);q[D]=gM;q[D+f]=Q;D+=2u;}fn h5(){cV(f);q[D]=gL;D+=f;}fn h4(aB:ep){let ee=bitcast<cm>(aB.ch);let ed=bitcast<cm>(aB.cg);let ec=bitcast<cm>(aB.cf);let eb=bitcast<cm>(aB.b2);let ea=bitcast<cm>(aB.ce);cV(23u);q[D]=gK;q[D+f]=aB.bj;q[D+2u]=ee.x;q[D+3u]=ee.y;q[D+4u]=ee.z;q[D+5u]=ee.w;q[D+6u]=ed.x;q[D+7u]=ed.y;q[D+8u]=ed.z;q[D+9u]=ed.w;q[D+10u]=ec.x;q[D+11u]=ec.y;q[D+12u]=ec.z;q[D+13u]=ec.w;q[D+14u]=eb.x;q[D+15u]=eb.y;q[D+16u]=eb.z;q[D+17u]=eb.w;q[D+18u]=ea.x;q[D+19u]=ea.y;q[D+20u]=ea.z;q[D+21u]=ea.w;q[D+22u]=select(e,f,aB.c1);D+=23u;}@compute @workgroup_size(256)fn main(@builtin(local_invocation_id)k:M,@builtin(workgroup_id)ap:M){if k.x==e{bK[0]=atomicLoad(&ao.aq);}let aq=workgroupUniformLoad(&bK[0]);if(aq&(eB|fw|hc))!=e{return;}let cY=(n.aK+bi-f)/bi;let dF=cY*ap.y+ap.x;let d9=(n.cN+aL- f)/aL;let d8=bi*ap.x;let d7=cP*ap.y;let fc=k.x % bi;let fb=k.x/bi;let h1=(d7+fb)*n.aK+d8+fc;D=h1*eo;e6=D+(eo-gU);var d4=e;var bf=e;var cT=e;var cH=e;var cG=e;var fa=e;var ca=e;var e9=e;var d3=e;let gk=D;D+=f;while true{for(var i=e;i<cd;i+=f){atomicStore(&bD[i][k.x],e);}while true{if ca==cG&&cT<d9{fa=ca;var b9=e;if cT+k.x<d9{let h0=(cT+k.x)*aL+dF;let dE=hV[h0];b9=dE.bq;gd[k.x]=dE.cc;}for(var i=e;i<firstTrailingBit(o);i+=f){bK[k.x]=b9;workgroupBarrier();if k.x>=(f<<i){b9+=bK[k.x-(f<<i)];}workgroupBarrier();}bK[k.x]=fa+b9;ca=workgroupUniformLoad(&bK[o- f]);cT+=o;}var p=cH+k.x;if p>=cG&&p<ca{var dx=e;for(var i=e;i<firstTrailingBit(o);i+=f){let bE=dx+((aL/2u)>>i);if p>=bK[bE- f]{dx=bE;}}p-=select(fa,bK[dx- f],dx>e);let a5=n.g5+gd[dx];dv[k.x]=dw[a5+p];}cG=min(cH+aL,ca);if cG-cH>=aL||(cG>=ca&&cT>=d9){break;}}var a4=cM;var aG:j;if k.x+cH<cG{aG=dv[k.x];a4=u[n.c5+aG];}var b8=e;if a4!=cM{let ac=b_[aG].ac;let W=bM[ac];let dz=W.l.z-W.l.x;e8[k.x]=dz;let gj=m(W.l.x)-m(d8);let dy=m(W.l.y)-m(d7);let J=clamp(gj,0,m(bi));let S=clamp(dy,0,m(cP));let T=clamp(m(W.l.z)-m(d8),0,m(bi));let V=clamp(m(W.l.w)-m(d7),0,m(cP));gc[k.x]=j(T-J);f9[k.x]=j(J)|j(S<<16u);b8=j(T-J)*j(V-S);let aO=W.X-j(dy*m(dz)+gj);e7[k.x]=aO;}be[k.x]=b8;for(var i=e;i<firstTrailingBit(aL);i+=f){workgroupBarrier();if k.x>=(f<<i){b8+=be[k.x-(f<<i)];}workgroupBarrier();be[k.x]=b8;}workgroupBarrier();let d6=be[aL- f];for(var p=k.x;p<d6;p+=aL){var av=e;for(var i=e;i<firstTrailingBit(aL);i+=f){let bE=av+((aL/2u)>>i);if p>=be[bE- f]{av=bE;}}aG=dv[av];a4=u[n.c5+aG];let ek=p-select(e,be[av- f],av>e);let b0=gc[av];let gi=f9[av];let x=(gi&65535u)+ek % b0;let y=(gi>>16u)+ek/b0;let aJ=e7[av]+e8[av]*y+x;let F=X[aJ];let gh=(a4&f)!=e;var ge=false;if gh{let h_=(128u<<8u)|3u;let bG=b_[aG].bG;let E=n.ft+bG;let bj=u[E];ge=bj!=h_;}let hZ=F.aj!=e||(F.O==0)==gh||ge;if hZ{let hY=av/32u;let hX=f<<(av&31u);atomicOr(&bD[hY][y*bi+x],hX);}}workgroupBarrier();var d2=e;var cF=atomicLoad(&bD[e][k.x]);while true{if cF==e{d2+=f;if d2==cd{break;}cF=atomicLoad(&bD[d2][k.x]);if cF==e{continue;}}let av=d2*32u+firstTrailingBit(cF);aG=dv[av];cF&=cF- f;let bo=u[n.c5+aG];let gf=b_[aG];let E=n.ft+gf.bG;let Y=gf.Q;if d4==e{let aJ=e7[av]+e8[av]*fb+fc;let F=X[aJ];switch bo{case fr:{let ad=bitcast<h>(dw[Y]);if dA(F,ad){let c2=u[E];h7(eq(c2));}}case ev:{let ad=bitcast<h>(dw[Y]);if dA(F,ad){let aW=u[E];let Q=Y+f;gl(gO,aW,Q);}}case eu:{let ad=bitcast<h>(dw[Y]);if dA(F,ad){let aW=u[E];let Q=Y+f;gl(gN,aW,Q);}}case et:{let ad=bitcast<h>(dw[Y]);if dA(F,ad){h6(Y+f);}}case dN:{if F.aj==e&&F.O==0{d4=bf+f;}else{h5();e9+=f;d3=max(d3,e9);}bf+=f;}case es:{bf-=f;dA(F,-d);let bj=u[E];let ch=bitcast<L>(vec4(u[E+f],u[E+2u],u[E+3u],u[E+4u]));let cg=bitcast<L>(vec4(u[E+5u],u[E+6u],u[E+7u],u[E+8u]));let cf=bitcast<L>(vec4(u[E+9u],u[E+10u],u[E+11u],u[E+12u]));let b2=bitcast<L>(vec4(u[E+13u],u[E+14u],u[E+15u],u[E+16u]));let ce=bitcast<L>(vec4(u[E+17u],u[E+18u],u[E+19u],u[E+20u]));let c1=ch.a!=c||cg.a!=c||cf.a!=c||ce.a!=c;h4(ep(bj,ch,cg,cf,b2,ce,c1));e9-=f;}default:{}}}else{switch bo{case dN:{bf+=f;}case es:{if bf==d4{d4=e;}bf-=f;}default:{}}}}cH+=aL;if cH>=ca&&cT>=d9{break;}workgroupBarrier();}if d8+fc<n.aK&&d7+fb<n.cO{q[D]=gT;if d3>ez{let hW=d3*cQ*bu;q[gk]=atomicAdd(&ao.bj,hW);}}}`
