/* eslint-disable */
import tile from './shared/tile.js';
import ptcl from './shared/ptcl.js';
import drawtag from './shared/drawtag.js';
import bump from './shared/bump.js';
import config from './shared/config.js';
import pre from './shared/pre.js';

export default `${pre}${config}
${bump}
${drawtag}
${ptcl}
${tile}
@group(0)@binding(0)var<uniform>n:aR;@group(0)@binding(1)var<storage>s:aX;@group(0)@binding(2)var<storage>b7:array<aQ>;struct fl{bq:i,ck:i}@group(0)@binding(3)var<storage>hV:array<fl>;@group(0)@binding(4)var<storage>dA:aX;@group(0)@binding(5)var<storage>bS:array<cK>;@group(0)@binding(6)var<storage>W:array<bt>;@group(0)@binding(7)var<storage,read_write>aq:ew;@group(0)@binding(8)var<storage,read_write>q:aX;const o=256u;const cl=8u;var<workgroup>bF:array<array<bY,aN>,cl>;var<workgroup>bQ:array<i,o>;var<workgroup>gf:array<i,o>;var<workgroup>dz:array<i,o>;var<workgroup>fd:array<i,o>;var<workgroup>ge:array<i,o>;var<workgroup>gd:array<i,o>;var<workgroup>be:array<i,o>;var<workgroup>fc:array<i,o>;var<private>D:i;var<private>fb:i;fn cW(size:i){if D+size>=fb{let h3=n.aM*n.cP*ej;var d5=h3+atomicAdd(&aq.q,fs);if d5+fs>n.ix{d5=e;atomicOr(&aq.au,iF);}q[D]=gJ;q[D+f]=d5;D=d5;fb=D+(fs-gU);}}fn dE(F:bt,ad:h)->bool{cW(3u);if ad<c{let cV=ad<-d;if F.ak!=e{let cJ=fu(F.ak,F.O);q[D]=gS;let h2=select(cJ.F<<f,(cJ.F<<f)|f,cV);q[D+f]=h2;q[D+2u]=i(cJ.O);D+=3u;}else{if cV&&(abs(F.O)&1)==0{return false;}q[D]=gQ;D+=f;}}else{let a2=ft(F.ak,.5*ad);q[D]=gR;q[D+f]=a2.F;q[D+2u]=bitcast<i>(a2.c4);D+=3u;}return true;}fn h7(b6:el){cW(2u);q[D]=gP;q[D+f]=b6.c3;D+=2u;}fn gn(ty:i,aW:i,Q:i){cW(3u);q[D]=ty;q[D+f]=aW;q[D+2u]=Q;D+=3u;}fn h6(Q:i){cW(2u);q[D]=gM;q[D+f]=Q;D+=2u;}fn h5(){cW(f);q[D]=gL;D+=f;}fn h4(S:ek){cW(23u);q[D]=gK;q[D+f]=S.bj;q[D+2u]=bitcast<i>(S.bK.x);q[D+3u]=bitcast<i>(S.bK.y);q[D+4u]=bitcast<i>(S.bK.z);q[D+5u]=bitcast<i>(S.bK.w);q[D+6u]=bitcast<i>(S.bJ.x);q[D+7u]=bitcast<i>(S.bJ.y);q[D+8u]=bitcast<i>(S.bJ.z);q[D+9u]=bitcast<i>(S.bJ.w);q[D+10u]=bitcast<i>(S.bI.x);q[D+11u]=bitcast<i>(S.bI.y);q[D+12u]=bitcast<i>(S.bI.z);q[D+13u]=bitcast<i>(S.bI.w);q[D+14u]=bitcast<i>(S.bu.x);q[D+15u]=bitcast<i>(S.bu.y);q[D+16u]=bitcast<i>(S.bu.z);q[D+17u]=bitcast<i>(S.bu.w);q[D+18u]=bitcast<i>(S.bH.x);q[D+19u]=bitcast<i>(S.bH.y);q[D+20u]=bitcast<i>(S.bH.z);q[D+21u]=bitcast<i>(S.bH.w);q[D+22u]=select(e,f,S.c2);D+=23u;}@compute @workgroup_size(256)fn main(@builtin(local_invocation_id)k:M,@builtin(workgroup_id)at:M){if k.x==e{bQ[0]=atomicLoad(&aq.au);}let au=workgroupUniformLoad(&bQ[0]);if(au&(ev|fB|hb))!=e{return;}let cZ=(n.aM+bi-f)/bi;let dJ=cZ*at.y+at.x;let d9=(n.cO+aN- f)/aN;let d8=bi*at.x;let d7=cQ*at.y;let fh=k.x % bi;let fg=k.x/bi;let h1=(d7+fg)*n.aM+d8+fh;D=h1*ej;fb=D+(ej-gU);var d4=e;var bf=e;var cU=e;var cI=e;var cH=e;var ff=e;var ci=e;var fe=e;var d3=e;let gm=D;D+=f;while true{for(var j=e;j<cl;j+=f){atomicStore(&bF[j][k.x],e);}while true{if ci==cH&&cU<d9{ff=ci;var ch=e;if cU+k.x<d9{let h0=(cU+k.x)*aN+dJ;let dI=hV[h0];ch=dI.bq;gf[k.x]=dI.ck;}for(var j=e;j<firstTrailingBit(o);j+=f){bQ[k.x]=ch;workgroupBarrier();if k.x>=(f<<j){ch+=bQ[k.x-(f<<j)];}workgroupBarrier();}bQ[k.x]=ff+ch;ci=workgroupUniformLoad(&bQ[o- f]);cU+=o;}var p=cI+k.x;if p>=cH&&p<ci{var dB=e;for(var j=e;j<firstTrailingBit(o);j+=f){let bG=dB+((aN/2u)>>j);if p>=bQ[bG- f]{dB=bG;}}p-=select(ff,bQ[dB- f],dB>e);let a5=n.g4+gf[dB];dz[k.x]=dA[a5+p];}cH=min(cI+aN,ci);if cH-cI>=aN||(cH>=ci&&cU>=d9){break;}}var a4=cN;var aH:i;if k.x+cI<cH{aH=dz[k.x];a4=s[n.c7+aH];}var cg=e;if a4!=cN{let ac=b7[aH].ac;let X=bS[ac];let dD=X.l.z-X.l.x;fd[k.x]=dD;let gl=m(X.l.x)-m(d8);let dC=m(X.l.y)-m(d7);let J=clamp(gl,0,m(bi));let R=clamp(dC,0,m(cQ));let T=clamp(m(X.l.z)-m(d8),0,m(bi));let V=clamp(m(X.l.w)-m(d7),0,m(cQ));ge[k.x]=i(T-J);gd[k.x]=i(J)|i(R<<16u);cg=i(T-J)*i(V-R);let an=X.W-i(dC*m(dD)+gl);fc[k.x]=an;}be[k.x]=cg;for(var j=e;j<firstTrailingBit(aN);j+=f){workgroupBarrier();if k.x>=(f<<j){cg+=be[k.x-(f<<j)];}workgroupBarrier();be[k.x]=cg;}workgroupBarrier();let d6=be[aN- f];for(var p=k.x;p<d6;p+=aN){var ax=e;for(var j=e;j<firstTrailingBit(aN);j+=f){let bG=ax+((aN/2u)>>j);if p>=be[bG- f]{ax=bG;}}aH=dz[ax];a4=s[n.c7+aH];let ef=p-select(e,be[ax- f],ax>e);let cm=ge[ax];let gk=gd[ax];let x=(gk&65535u)+ef % cm;let y=(gk>>16u)+ef/cm;let aK=fc[ax]+fd[ax]*y+x;let F=W[aK];let gj=(a4&f)!=e;var gh=false;if gj{let h_=(128u<<8u)|3u;let bM=b7[aH].bM;let E=n.fy+bM;let bj=s[E];gh=bj!=h_;}let hZ=F.ak!=e||(F.O==0)==gj||gh;if hZ{let hY=ax/32u;let hX=f<<(ax&31u);atomicOr(&bF[hY][y*bi+x],hX);}}workgroupBarrier();var d2=e;var cG=atomicLoad(&bF[e][k.x]);while true{if cG==e{d2+=f;if d2==cl{break;}cG=atomicLoad(&bF[d2][k.x]);if cG==e{continue;}}let ax=d2*32u+firstTrailingBit(cG);aH=dz[ax];cG&=cG- f;let bo=s[n.c7+aH];let gi=b7[aH];let E=n.fy+gi.bM;let Z=gi.Q;if d4==e{let aK=fc[ax]+fd[ax]*fg+fh;let F=W[aK];switch bo{case fw:{let ad=bitcast<h>(dA[Z]);if dE(F,ad){let c3=s[E];h7(el(c3));}}case eq:{let ad=bitcast<h>(dA[Z]);if dE(F,ad){let aW=s[E];let Q=Z+f;gn(gO,aW,Q);}}case ep:{let ad=bitcast<h>(dA[Z]);if dE(F,ad){let aW=s[E];let Q=Z+f;gn(gN,aW,Q);}}case eo:{let ad=bitcast<h>(dA[Z]);if dE(F,ad){h6(Z+f);}}case dR:{if F.ak==e&&F.O==0{d4=bf+f;}else{h5();fe+=f;d3=max(d3,fe);}bf+=f;}case en:{bf-=f;dE(F,-d);let bj=s[E];let bK=vec4(bitcast<h>(s[E+f]),bitcast<h>(s[E+2u]),bitcast<h>(s[E+3u]),bitcast<h>(s[E+4u]));let bJ=vec4(bitcast<h>(s[E+5u]),bitcast<h>(s[E+6u]),bitcast<h>(s[E+7u]),bitcast<h>(s[E+8u]));let bI=vec4(bitcast<h>(s[E+9u]),bitcast<h>(s[E+10u]),bitcast<h>(s[E+11u]),bitcast<h>(s[E+12u]));let bu=vec4(bitcast<h>(s[E+13u]),bitcast<h>(s[E+14u]),bitcast<h>(s[E+15u]),bitcast<h>(s[E+16u]));let bH=vec4(bitcast<h>(s[E+17u]),bitcast<h>(s[E+18u]),bitcast<h>(s[E+19u]),bitcast<h>(s[E+20u]));let c2=bK.a!=c||bJ.a!=c||bI.a!=c||bH.a!=c;h4(ek(bj,bK,bJ,bI,bu,bH,c2));fe-=f;}default:{}}}else{switch bo{case dR:{bf+=f;}case en:{if bf==d4{d4=e;}bf-=f;}default:{}}}}cI+=aN;if cI>=ci&&cU>=d9{break;}workgroupBarrier();}if d8+fh<n.aM&&d7+fg<n.cP{q[D]=gT;if d3>et{let hW=d3*cR*bw;q[gm]=atomicAdd(&aq.bj,hW);}}}`
