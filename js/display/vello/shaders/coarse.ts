/* eslint-disable */
import tile from './shared/tile.js';
import ptcl from './shared/ptcl.js';
import drawtag from './shared/drawtag.js';
import bump from './shared/bump.js';
import config from './shared/config.js';
import pre from './shared/pre.js';

export default `${pre}${config}
${bump}
${drawtag}
${ptcl}
${tile}
@group(0)@binding(0)var<uniform>n:aR;@group(0)@binding(1)var<storage>u:aX;@group(0)@binding(2)var<storage>b_:array<aQ>;struct fh{bp:j,cc:j}@group(0)@binding(3)var<storage>hV:array<fh>;@group(0)@binding(4)var<storage>dx:aX;@group(0)@binding(5)var<storage>bL:array<cJ>;@group(0)@binding(6)var<storage>X:array<bs>;@group(0)@binding(7)var<storage,read_write>ao:eD;@group(0)@binding(8)var<storage,read_write>q:aX;const o=256u;const cd=8u;var<workgroup>bC:array<array<bS,aL>,cd>;var<workgroup>bJ:array<j,o>;var<workgroup>gd:array<j,o>;var<workgroup>dw:array<j,o>;var<workgroup>e9:array<j,o>;var<workgroup>gc:array<j,o>;var<workgroup>f9:array<j,o>;var<workgroup>be:array<j,o>;var<workgroup>e8:array<j,o>;var<private>D:j;var<private>e7:j;fn cV(size:j){if D+size>=e7{let h3=n.aK*n.cO*ep;var d6=h3+atomicAdd(&ao.q,fo);if d6+fo>n.ix{d6=e;atomicOr(&ao.aq,iF);}q[D]=gI;q[D+f]=d6;D=d6;e7=D+(fo-gT);}}fn dB(F:bs,ad:h)->bool{cV(3u);if ad<c{let cU=ad<-d;if F.aj!=e{let cI=fq(F.aj,F.O);q[D]=gR;let h2=select(cI.F<<f,(cI.F<<f)|f,cU);q[D+f]=h2;q[D+2u]=j(cI.O);D+=3u;}else{if cU&&(abs(F.O)&1)==0{return false;}q[D]=gP;D+=f;}}else{let a2=fp(F.aj,.5*ad);q[D]=gQ;q[D+f]=a2.F;q[D+2u]=bitcast<j>(a2.c3);D+=3u;}return true;}fn h7(bZ:er){cV(2u);q[D]=gO;q[D+f]=bZ.c2;D+=2u;}fn gl(ty:j,aW:j,R:j){cV(3u);q[D]=ty;q[D+f]=aW;q[D+2u]=R;D+=3u;}fn h6(R:j){cV(2u);q[D]=gL;q[D+f]=R;D+=2u;}fn h5(){cV(f);q[D]=gK;D+=f;}fn h4(aB:eq){let ef=bitcast<cn>(aB.ci);let ee=bitcast<cn>(aB.ch);let ed=bitcast<cn>(aB.cg);let ec=bitcast<cn>(aB.b1);let eb=bitcast<cn>(aB.cf);cV(23u);q[D]=gJ;q[D+f]=aB.bi;q[D+2u]=ef.x;q[D+3u]=ef.y;q[D+4u]=ef.z;q[D+5u]=ef.w;q[D+6u]=ee.x;q[D+7u]=ee.y;q[D+8u]=ee.z;q[D+9u]=ee.w;q[D+10u]=ed.x;q[D+11u]=ed.y;q[D+12u]=ed.z;q[D+13u]=ed.w;q[D+14u]=ec.x;q[D+15u]=ec.y;q[D+16u]=ec.z;q[D+17u]=ec.w;q[D+18u]=eb.x;q[D+19u]=eb.y;q[D+20u]=eb.z;q[D+21u]=eb.w;q[D+22u]=select(e,f,aB.c1);D+=23u;}@compute @workgroup_size(256)fn main(@builtin(local_invocation_id)k:M,@builtin(workgroup_id)ap:M){if k.x==e{bJ[0]=atomicLoad(&ao.aq);}let aq=workgroupUniformLoad(&bJ[0]);if(aq&(eC|fx|hb))!=e{return;}let cY=(n.aK+bh-f)/bh;let dG=cY*ap.y+ap.x;let ea=(n.cN+aL- f)/aL;let d9=bh*ap.x;let d8=cP*ap.y;let fd=k.x % bh;let fc=k.x/bh;let h1=(d8+fc)*n.aK+d9+fd;D=h1*ep;e7=D+(ep-gT);var d5=e;var bf=e;var cT=e;var cH=e;var cG=e;var fb=e;var ca=e;var fa=e;var d4=e;let gk=D;D+=f;while true{for(var i=e;i<cd;i+=f){atomicStore(&bC[i][k.x],e);}while true{if ca==cG&&cT<ea{fb=ca;var b9=e;if cT+k.x<ea{let h0=(cT+k.x)*aL+dG;let dF=hV[h0];b9=dF.bp;gd[k.x]=dF.cc;}for(var i=e;i<firstTrailingBit(o);i+=f){bJ[k.x]=b9;workgroupBarrier();if k.x>=(f<<i){b9+=bJ[k.x-(f<<i)];}workgroupBarrier();}bJ[k.x]=fb+b9;ca=workgroupUniformLoad(&bJ[o- f]);cT+=o;}var p=cH+k.x;if p>=cG&&p<ca{var dy=e;for(var i=e;i<firstTrailingBit(o);i+=f){let bD=dy+((aL/2u)>>i);if p>=bJ[bD- f]{dy=bD;}}p-=select(fb,bJ[dy- f],dy>e);let a5=n.g4+gd[dy];dw[k.x]=dx[a5+p];}cG=min(cH+aL,ca);if cG-cH>=aL||(cG>=ca&&cT>=ea){break;}}var a4=cM;var aG:j;if k.x+cH<cG{aG=dw[k.x];a4=u[n.c5+aG];}var b8=e;if a4!=cM{let ac=b_[aG].ac;let W=bL[ac];let dA=W.l.z-W.l.x;e9[k.x]=dA;let gj=m(W.l.x)-m(d9);let dz=m(W.l.y)-m(d8);let J=clamp(gj,0,m(bh));let S=clamp(dz,0,m(cP));let T=clamp(m(W.l.z)-m(d9),0,m(bh));let V=clamp(m(W.l.w)-m(d8),0,m(cP));gc[k.x]=j(T-J);f9[k.x]=j(J)|j(S<<16u);b8=j(T-J)*j(V-S);let aO=W.X-j(dz*m(dA)+gj);e8[k.x]=aO;}be[k.x]=b8;for(var i=e;i<firstTrailingBit(aL);i+=f){workgroupBarrier();if k.x>=(f<<i){b8+=be[k.x-(f<<i)];}workgroupBarrier();be[k.x]=b8;}workgroupBarrier();let d7=be[aL- f];for(var p=k.x;p<d7;p+=aL){var av=e;for(var i=e;i<firstTrailingBit(aL);i+=f){let bD=av+((aL/2u)>>i);if p>=be[bD- f]{av=bD;}}aG=dw[av];a4=u[n.c5+aG];let el=p-select(e,be[av- f],av>e);let ce=gc[av];let gi=f9[av];let x=(gi&65535u)+el % ce;let y=(gi>>16u)+el/ce;let aJ=e8[av]+e9[av]*y+x;let F=X[aJ];let gh=(a4&f)!=e;var ge=false;if gh{let h_=(128u<<8u)|3u;let bF=b_[aG].bF;let E=n.fu+bF;let bi=u[E];ge=bi!=h_;}let hZ=F.aj!=e||(F.O==0)==gh||ge;if hZ{let hY=av/32u;let hX=f<<(av&31u);atomicOr(&bC[hY][y*bh+x],hX);}}workgroupBarrier();var d3=e;var cF=atomicLoad(&bC[e][k.x]);while true{if cF==e{d3+=f;if d3==cd{break;}cF=atomicLoad(&bC[d3][k.x]);if cF==e{continue;}}let av=d3*32u+firstTrailingBit(cF);aG=dw[av];cF&=cF- f;let bn=u[n.c5+aG];let gf=b_[aG];let E=n.fu+gf.bF;let Z=gf.R;if d5==e{let aJ=e8[av]+e9[av]*fc+fd;let F=X[aJ];switch bn{case fs:{let ad=bitcast<h>(dx[Z]);if dB(F,ad){let c2=u[E];h7(er(c2));}}case ew:{let ad=bitcast<h>(dx[Z]);if dB(F,ad){let aW=u[E];let R=Z+f;gl(gN,aW,R);}}case ev:{let ad=bitcast<h>(dx[Z]);if dB(F,ad){let aW=u[E];let R=Z+f;gl(gM,aW,R);}}case eu:{let ad=bitcast<h>(dx[Z]);if dB(F,ad){h6(Z+f);}}case dO:{if F.aj==e&&F.O==0{d5=bf+f;}else{h5();fa+=f;d4=max(d4,fa);}bf+=f;}case et:{bf-=f;dB(F,-d);let bi=u[E];let ci=bitcast<L>(vec4(u[E+f],u[E+2u],u[E+3u],u[E+4u]));let ch=bitcast<L>(vec4(u[E+5u],u[E+6u],u[E+7u],u[E+8u]));let cg=bitcast<L>(vec4(u[E+9u],u[E+10u],u[E+11u],u[E+12u]));let b1=bitcast<L>(vec4(u[E+13u],u[E+14u],u[E+15u],u[E+16u]));let cf=bitcast<L>(vec4(u[E+17u],u[E+18u],u[E+19u],u[E+20u]));let c1=ci.a!=c||ch.a!=c||cg.a!=c||cf.a!=c;h4(eq(bi,ci,ch,cg,b1,cf,c1));fa-=f;}default:{}}}else{switch bn{case dO:{bf+=f;}case et:{if bf==d5{d5=e;}bf-=f;}default:{}}}}cH+=aL;if cH>=ca&&cT>=ea{break;}workgroupBarrier();}if d9+fd<n.aK&&d8+fc<n.cO{q[D]=gS;if d4>eA{let hW=d4*cQ*bt;q[gk]=atomicAdd(&ao.bi,hW);}}}`
