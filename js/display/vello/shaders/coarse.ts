/* eslint-disable */
import tile from './shared/tile.js';
import ptcl from './shared/ptcl.js';
import drawtag from './shared/drawtag.js';
import bump from './shared/bump.js';
import config from './shared/config.js';
import pre from './shared/pre.js';

export default `${pre}${config}
${bump}
${drawtag}
${ptcl}
${tile}
@group(0)@binding(0)var<uniform>j:aM;@group(0)@binding(1)var<storage>n:aS;@group(0)@binding(2)var<storage>b0:array<aL>;struct fh{bl:d,ce:d}@group(0)@binding(3)var<storage>hR:array<fh>;@group(0)@binding(4)var<storage>dw:aS;@group(0)@binding(5)var<storage>bM:array<cF>;@group(0)@binding(6)var<storage>S:array<bn>;@group(0)@binding(7)var<storage,read_write>ak:es;@group(0)@binding(8)var<storage,read_write>m:aS;const k=256u;const cf=8u;var<workgroup>bA:array<array<bS,aI>,cf>;var<workgroup>bK:array<d,k>;var<workgroup>f9:array<d,k>;var<workgroup>dv:array<d,k>;var<workgroup>e9:array<d,k>;var<workgroup>f8:array<d,k>;var<workgroup>f7:array<d,k>;var<workgroup>a6:array<d,k>;var<workgroup>e8:array<d,k>;var<private>v:d;var<private>e7:d;fn cS(size:d){if v+size>=e7{let h_=j.aH*j.cK*ef;var d1=h_+atomicAdd(&ak.m,fo);if d1+fo>j.it{d1=0u;atomicOr(&ak.am,iB);}m[v]=gF;m[v+1u]=d1;v=d1;e7=v+(fo-gQ);}}fn dA(B:bn,X:c)->bool{cS(3u);if X<0.{let cR=X<-1.;if B.ae!=0u{let cE=fq(B.ae,B.K);m[v]=gO;let hZ=select(cE.B<<1u,(cE.B<<1u)|1u,cR);m[v+1u]=hZ;m[v+2u]=d(cE.K);v+=3u;}else{if cR&&(abs(B.K)&1)==0{return false;}m[v]=gM;v+=1u;}}else{let aW=fp(B.ae,.5*X);m[v]=gN;m[v+1u]=aW.B;m[v+2u]=bitcast<d>(aW.c0);v+=3u;}return true;}fn h3(b7:eh){cS(2u);m[v]=gL;m[v+1u]=b7.c_;v+=2u;}fn gj(ty:d,aR:d,M:d){cS(3u);m[v]=ty;m[v+1u]=aR;m[v+2u]=M;v+=3u;}fn h2(M:d){cS(2u);m[v]=gI;m[v+1u]=M;v+=2u;}fn h1(){cS(1u);m[v]=gH;v+=1u;}fn h0(Q:eg){cS(23u);m[v]=gG;m[v+1u]=Q.bc;m[v+2u]=bitcast<d>(Q.bE.x);m[v+3u]=bitcast<d>(Q.bE.y);m[v+4u]=bitcast<d>(Q.bE.z);m[v+5u]=bitcast<d>(Q.bE.w);m[v+6u]=bitcast<d>(Q.bD.x);m[v+7u]=bitcast<d>(Q.bD.y);m[v+8u]=bitcast<d>(Q.bD.z);m[v+9u]=bitcast<d>(Q.bD.w);m[v+10u]=bitcast<d>(Q.bC.x);m[v+11u]=bitcast<d>(Q.bC.y);m[v+12u]=bitcast<d>(Q.bC.z);m[v+13u]=bitcast<d>(Q.bC.w);m[v+14u]=bitcast<d>(Q.a1.x);m[v+15u]=bitcast<d>(Q.a1.y);m[v+16u]=bitcast<d>(Q.a1.z);m[v+17u]=bitcast<d>(Q.a1.w);m[v+18u]=bitcast<d>(Q.bo.x);m[v+19u]=bitcast<d>(Q.bo.y);m[v+20u]=bitcast<d>(Q.bo.z);m[v+21u]=bitcast<d>(Q.bo.w);m[v+22u]=select(0u,1u,Q.cZ);v+=23u;}@compute @workgroup_size(256)fn main(@builtin(local_invocation_id)f:I,@builtin(workgroup_id)al:I){if f.x==0u{bK[0]=atomicLoad(&ak.am);}let am=workgroupUniformLoad(&bK[0]);if(am&(er|fx|g7))!=0u{return;}let cV=(j.aH+a9- 1u)/a9;let dF=cV*al.y+al.x;let d5=(j.cJ+aI- 1u)/aI;let d4=a9*al.x;let d3=cL*al.y;let fd=f.x % a9;let fc=f.x/a9;let hY=(d3+fc)*j.aH+d4+fd;v=hY*ef;e7=v+(ef-gQ);var d0=0u;var a7=0u;var cQ=0u;var cD=0u;var cC=0u;var fb=0u;var cc=0u;var fa=0u;var d_=0u;let gi=v;v+=1u;while true{for(var e=0u;e<cf;e+=1u){atomicStore(&bA[e][f.x],0u);}while true{if cc==cC&&cQ<d5{fb=cc;var cb=0u;if cQ+f.x<d5{let hX=(cQ+f.x)*aI+dF;let dE=hR[hX];cb=dE.bl;f9[f.x]=dE.ce;}for(var e=0u;e<firstTrailingBit(k);e+=1u){bK[f.x]=cb;workgroupBarrier();if f.x>=(1u<<e){cb+=bK[f.x-(1u<<e)];}workgroupBarrier();}bK[f.x]=fb+cb;cc=workgroupUniformLoad(&bK[k- 1u]);cQ+=k;}var l=cD+f.x;if l>=cC&&l<cc{var dx=0u;for(var e=0u;e<firstTrailingBit(k);e+=1u){let bB=dx+((aI/2u)>>e);if l>=bK[bB- 1u]{dx=bB;}}l-=select(fb,bK[dx- 1u],dx>0u);let aZ=j.g0+f9[dx];dv[f.x]=dw[aZ+l];}cC=min(cD+aI,cc);if cC-cD>=aI||(cC>=cc&&cQ>=d5){break;}}var aY=cI;var aC:d;if f.x+cD<cC{aC=dv[f.x];aY=n[j.c3+aC];}var ca=0u;if aY!=cI{let W=b0[aC].W;let T=bM[W];let dz=T.h.z-T.h.x;e9[f.x]=dz;let gh=i(T.h.x)-i(d4);let dy=i(T.h.y)-i(d3);let F=clamp(gh,0,i(a9));let N=clamp(dy,0,i(cL));let O=clamp(i(T.h.z)-i(d4),0,i(a9));let R=clamp(i(T.h.w)-i(d3),0,i(cL));f8[f.x]=d(O-F);f7[f.x]=d(F)|d(N<<16u);ca=d(O-F)*d(R-N);let ai=T.S-d(dy*i(dz)+gh);e8[f.x]=ai;}a6[f.x]=ca;for(var e=0u;e<firstTrailingBit(aI);e+=1u){workgroupBarrier();if f.x>=(1u<<e){ca+=a6[f.x-(1u<<e)];}workgroupBarrier();a6[f.x]=ca;}workgroupBarrier();let d2=a6[aI- 1u];for(var l=f.x;l<d2;l+=aI){var ap=0u;for(var e=0u;e<firstTrailingBit(aI);e+=1u){let bB=ap+((aI/2u)>>e);if l>=a6[bB- 1u]{ap=bB;}}aC=dv[ap];aY=n[j.c3+aC];let eb=l-select(0u,a6[ap- 1u],ap>0u);let cg=f8[ap];let gf=f7[ap];let x=(gf&65535u)+eb % cg;let y=(gf>>16u)+eb/cg;let aF=e8[ap]+e9[ap]*y+x;let B=S[aF];let ge=(aY&1u)!=0u;var gc=false;if ge{let hW=(128u<<8u)|3u;let bG=b0[aC].bG;let A=j.fu+bG;let bc=n[A];gc=bc!=hW;}let hV=B.ae!=0u||(B.K==0)==ge||gc;if hV{let hU=ap/32u;let hT=1u<<(ap&31u);atomicOr(&bA[hU][y*a9+x],hT);}}workgroupBarrier();var dZ=0u;var cB=atomicLoad(&bA[0u][f.x]);while true{if cB==0u{dZ+=1u;if dZ==cf{break;}cB=atomicLoad(&bA[dZ][f.x]);if cB==0u{continue;}}let ap=dZ*32u+firstTrailingBit(cB);aC=dv[ap];cB&=cB- 1u;let bj=n[j.c3+aC];let gd=b0[aC];let A=j.fu+gd.bG;let V=gd.M;if d0==0u{let aF=e8[ap]+e9[ap]*fc+fd;let B=S[aF];switch bj{case 66u:{let X=bitcast<c>(dw[V]);if dA(B,X){let c_=n[A];h3(eh(c_));}}case 266u:{let X=bitcast<c>(dw[V]);if dA(B,X){let aR=n[A];let M=V+1u;gj(gK,aR,M);}}case 654u:{let X=bitcast<c>(dw[V]);if dA(B,X){let aR=n[A];let M=V+1u;gj(gJ,aR,M);}}case 580u:{let X=bitcast<c>(dw[V]);if dA(B,X){h2(V+1u);}}case 43u:{if B.ae==0u&&B.K==0{d0=a7+1u;}else{h1();fa+=1u;d_=max(d_,fa);}a7+=1u;}case 1025u:{a7-=1u;dA(B,-1.);let bc=n[A];let bE=vec4(bitcast<c>(n[A+1u]),bitcast<c>(n[A+2u]),bitcast<c>(n[A+3u]),bitcast<c>(n[A+4u]));let bD=vec4(bitcast<c>(n[A+5u]),bitcast<c>(n[A+6u]),bitcast<c>(n[A+7u]),bitcast<c>(n[A+8u]));let bC=vec4(bitcast<c>(n[A+9u]),bitcast<c>(n[A+10u]),bitcast<c>(n[A+11u]),bitcast<c>(n[A+12u]));let a1=vec4(bitcast<c>(n[A+13u]),bitcast<c>(n[A+14u]),bitcast<c>(n[A+15u]),bitcast<c>(n[A+16u]));let bo=vec4(bitcast<c>(n[A+17u]),bitcast<c>(n[A+18u]),bitcast<c>(n[A+19u]),bitcast<c>(n[A+20u]));let cZ=bE.a!=0.||bD.a!=0.||bC.a!=0.||a1.r!=0.||a1.g!=0.||a1.b!=0.||a1.a!=1.||bo.a!=0.;h0(eg(bc,bE,bD,bC,a1,bo,cZ));fa-=1u;}default:{}}}else{switch bj{case 43u:{a7+=1u;}case 1025u:{if a7==d0{d0=0u;}a7-=1u;}default:{}}}}cD+=aI;if cD>=cc&&cQ>=d5{break;}workgroupBarrier();}if d4+fd<j.aH&&d3+fc<j.cK{m[v]=gP;if d_>ep{let hS=d_*cM*bq;m[gi]=atomicAdd(&ak.bc,hS);}}}`
