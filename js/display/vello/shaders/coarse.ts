/* eslint-disable */
import tile from './shared/tile.js';
import ptcl from './shared/ptcl.js';
import drawtag from './shared/drawtag.js';
import bump from './shared/bump.js';
import config from './shared/config.js';
import pre from './shared/pre.js';

export default `${pre}${config}
${bump}
${drawtag}
${ptcl}
${tile}
@group(0)@binding(0)var<uniform>n:aV;@group(0)@binding(1)var<storage>u:a0;@group(0)@binding(2)var<storage>b4:array<aU>;struct fp{bu:j,cf:j}@group(0)@binding(3)var<storage>h_:array<fp>;@group(0)@binding(4)var<storage>dA:a0;@group(0)@binding(5)var<storage>bQ:array<cL>;@group(0)@binding(6)var<storage>Y:array<bw>;@group(0)@binding(7)var<storage,read_write>ao:eH;@group(0)@binding(8)var<storage,read_write>q:a0;const o=256u;const cg=8u;var<workgroup>bH:array<array<bX,aN>,cg>;var<workgroup>bO:array<j,o>;var<workgroup>gn:array<j,o>;var<workgroup>dz:array<j,o>;var<workgroup>fg:array<j,o>;var<workgroup>gm:array<j,o>;var<workgroup>gl:array<j,o>;var<workgroup>bk:array<j,o>;var<workgroup>ff:array<j,o>;var<private>D:j;var<private>fe:j;fn cY(size:j){if D+size>=fe{let h8=n.aM*n.cR*et;var ea=h8+atomicAdd(&ao.q,fu);if ea+fu>n.iB{ea=e;atomicOr(&ao.aq,iK);}q[D]=gS;q[D+f]=ea;D=ea;fe=D+(fu-g2);}}fn dE(F:bw,ad:h)->bool{cY(3u);if ad<c{let cX=ad<-d;if F.ak!=e{let cK=fw(F.ak,F.O);q[D]=g0;let h7=select(cK.F<<f,(cK.F<<f)|f,cX);q[D+f]=h7;q[D+2u]=j(cK.O);D+=3u;}else{if cX&&(abs(F.O)&1)==0{return false;}q[D]=gZ;D+=f;}}else{let a6=fv(F.ak,.5*ad);q[D]=g_;q[D+f]=a6.F;q[D+2u]=bitcast<j>(a6.c6);D+=3u;}return true;}fn ic(b3:ev){cY(2u);q[D]=gY;q[D+f]=b3.c5;D+=2u;}fn gv(ty:j,a_:j,P:j){cY(3u);q[D]=ty;q[D+f]=a_;q[D+2u]=P;D+=3u;}fn ib(P:j){cY(2u);q[D]=gV;q[D+f]=P;D+=2u;}fn ia(){cY(f);q[D]=gU;D+=f;}fn h9(aB:eu){let ej=bitcast<cp>(aB.ck);let ei=bitcast<cp>(aB.cj);let eh=bitcast<cp>(aB.ci);let eg=bitcast<cp>(aB.b6);let ef=bitcast<cp>(aB.ch);cY(23u);q[D]=gT;q[D+f]=aB.bn;q[D+2u]=ej.x;q[D+3u]=ej.y;q[D+4u]=ej.z;q[D+5u]=ej.w;q[D+6u]=ei.x;q[D+7u]=ei.y;q[D+8u]=ei.z;q[D+9u]=ei.w;q[D+10u]=eh.x;q[D+11u]=eh.y;q[D+12u]=eh.z;q[D+13u]=eh.w;q[D+14u]=eg.x;q[D+15u]=eg.y;q[D+16u]=eg.z;q[D+17u]=eg.w;q[D+18u]=ef.x;q[D+19u]=ef.y;q[D+20u]=ef.z;q[D+21u]=ef.w;q[D+22u]=select(e,f,aB.c4);D+=23u;}@compute @workgroup_size(256)fn main(@builtin(local_invocation_id)k:M,@builtin(workgroup_id)ap:M){if k.x==e{bO[0]=atomicLoad(&ao.aq);}let aq=workgroupUniformLoad(&bO[0]);if(aq&(eG|fE|hk))!=e{return;}let c0=(n.aM+bm-f)/bm;let dJ=c0*ap.y+ap.x;let ee=(n.cQ+aN- f)/aN;let ed=bm*ap.x;let ec=cS*ap.y;let fk=k.x % bm;let fj=k.x/bm;let h6=(ec+fj)*n.aM+ed+fk;D=h6*et;fe=D+(et-g2);var d9=e;var bl=e;var cW=e;var cJ=e;var cI=e;var fi=e;var cd=e;var fh=e;var d8=e;let gu=D;D+=f;while true{for(var i=e;i<cg;i+=f){atomicStore(&bH[i][k.x],e);}while true{if cd==cI&&cW<ee{fi=cd;var cc=e;if cW+k.x<ee{let h5=(cW+k.x)*aN+dJ;let dI=h_[h5];cc=dI.bu;gn[k.x]=dI.cf;}for(var i=e;i<firstTrailingBit(o);i+=f){bO[k.x]=cc;workgroupBarrier();if k.x>=(f<<i){cc+=bO[k.x-(f<<i)];}workgroupBarrier();}bO[k.x]=fi+cc;cd=workgroupUniformLoad(&bO[o- f]);cW+=o;}var p=cJ+k.x;if p>=cI&&p<cd{var dB=e;for(var i=e;i<firstTrailingBit(o);i+=f){let bI=dB+((aN/2u)>>i);if p>=bO[bI- f]{dB=bI;}}p-=select(fi,bO[dB- f],dB>e);let a5=n.hd+gn[dB];dz[k.x]=dA[a5+p];}cI=min(cJ+aN,cd);if cI-cJ>=aN||(cI>=cd&&cW>=ee){break;}}var a8=cP;var aH:j;if k.x+cJ<cI{aH=dz[k.x];a8=u[n.c8+aH];}var cb=e;if a8!=cP{let ac=b4[aH].ac;let X=bQ[ac];let dD=X.l.z-X.l.x;fg[k.x]=dD;let gt=m(X.l.x)-m(ed);let dC=m(X.l.y)-m(ec);let J=clamp(gt,0,m(bm));let S=clamp(dC,0,m(cS));let T=clamp(m(X.l.z)-m(ed),0,m(bm));let V=clamp(m(X.l.w)-m(ec),0,m(cS));gm[k.x]=j(T-J);gl[k.x]=j(J)|j(S<<16u);cb=j(T-J)*j(V-S);let aS=X.Y-j(dC*m(dD)+gt);ff[k.x]=aS;}bk[k.x]=cb;for(var i=e;i<firstTrailingBit(aN);i+=f){workgroupBarrier();if k.x>=(f<<i){cb+=bk[k.x-(f<<i)];}workgroupBarrier();bk[k.x]=cb;}workgroupBarrier();let eb=bk[aN- f];for(var p=k.x;p<eb;p+=aN){var av=e;for(var i=e;i<firstTrailingBit(aN);i+=f){let bI=av+((aN/2u)>>i);if p>=bk[bI- f]{av=bI;}}aH=dz[av];a8=u[n.c8+aH];let ep=p-select(e,bk[av- f],av>e);let aR=gm[av];let gs=gl[av];let x=(gs&65535u)+ep % aR;let y=(gs>>16u)+ep/aR;let aK=ff[av]+fg[av]*y+x;let F=Y[aK];let gq=(a8&f)!=e;var go=false;if gq{let h4=(128u<<8u)|3u;let bK=b4[aH].bK;let E=n.fB+bK;let bn=u[E];go=bn!=h4;}let h3=F.ak!=e||(F.O==0)==gq||go;if h3{let h2=av/32u;let h1=f<<(av&31u);atomicOr(&bH[h2][y*bm+x],h1);}}workgroupBarrier();var d7=e;var cH=atomicLoad(&bH[e][k.x]);while true{if cH==e{d7+=f;if d7==cg{break;}cH=atomicLoad(&bH[d7][k.x]);if cH==e{continue;}}let av=d7*32u+firstTrailingBit(cH);aH=dz[av];cH&=cH- f;let bs=u[n.c8+aH];let gp=b4[aH];let E=n.fB+gp.bK;let W=gp.P;if d9==e{let aK=ff[av]+fg[av]*fj+fk;let F=Y[aK];switch bs{case fz:{let ad=bitcast<h>(dA[W]);if dE(F,ad){let c5=u[E];ic(ev(c5));}}case eA:{let ad=bitcast<h>(dA[W]);if dE(F,ad){let a_=u[E];let P=W+f;gv(gX,a_,P);}}case ez:{let ad=bitcast<h>(dA[W]);if dE(F,ad){let a_=u[E];let P=W+f;gv(gW,a_,P);}}case ey:{let ad=bitcast<h>(dA[W]);if dE(F,ad){ib(W+f);}}case dR:{if F.ak==e&&F.O==0{d9=bl+f;}else{ia();fh+=f;d8=max(d8,fh);}bl+=f;}case ex:{bl-=f;dE(F,-d);let bn=u[E];let ck=bitcast<L>(vec4(u[E+f],u[E+2u],u[E+3u],u[E+4u]));let cj=bitcast<L>(vec4(u[E+5u],u[E+6u],u[E+7u],u[E+8u]));let ci=bitcast<L>(vec4(u[E+9u],u[E+10u],u[E+11u],u[E+12u]));let b6=bitcast<L>(vec4(u[E+13u],u[E+14u],u[E+15u],u[E+16u]));let ch=bitcast<L>(vec4(u[E+17u],u[E+18u],u[E+19u],u[E+20u]));let c4=ck.a!=c||cj.a!=c||ci.a!=c||ch.a!=c;h9(eu(bn,ck,cj,ci,b6,ch,c4));fh-=f;}default:{}}}else{switch bs{case dR:{bl+=f;}case ex:{if bl==d9{d9=e;}bl-=f;}default:{}}}}cJ+=aN;if cJ>=cd&&cW>=ee{break;}workgroupBarrier();}if ed+fk<n.aM&&ec+fj<n.cR{q[D]=g1;if d8>eE{let h0=d8*cT*bx;q[gu]=atomicAdd(&ao.bn,h0);}}}`
