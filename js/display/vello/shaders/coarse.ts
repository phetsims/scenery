/* eslint-disable */
import tile from './shared/tile.js';
import ptcl from './shared/ptcl.js';
import drawtag from './shared/drawtag.js';
import bump from './shared/bump.js';
import config from './shared/config.js';
import pre from './shared/pre.js';

export default `${pre}${config}
${bump}
${drawtag}
${ptcl}
${tile}
@group(0)@binding(0)var<uniform>n:aQ;@group(0)@binding(1)var<storage>s:aW;@group(0)@binding(2)var<storage>b4:array<aP>;struct fl{bp:i,ci:i}@group(0)@binding(3)var<storage>hV:array<fl>;@group(0)@binding(4)var<storage>dA:aW;@group(0)@binding(5)var<storage>bQ:array<cJ>;@group(0)@binding(6)var<storage>W:array<bs>;@group(0)@binding(7)var<storage,read_write>ao:ew;@group(0)@binding(8)var<storage,read_write>q:aW;const o=256u;const cj=8u;var<workgroup>bE:array<array<bW,aM>,cj>;var<workgroup>bO:array<i,o>;var<workgroup>gf:array<i,o>;var<workgroup>dz:array<i,o>;var<workgroup>fd:array<i,o>;var<workgroup>ge:array<i,o>;var<workgroup>gd:array<i,o>;var<workgroup>bc:array<i,o>;var<workgroup>fc:array<i,o>;var<private>D:i;var<private>fb:i;fn cW(size:i){if D+size>=fb{let h3=n.aL*n.cO*ej;var d5=h3+atomicAdd(&ao.q,fs);if d5+fs>n.ix{d5=e;atomicOr(&ao.aq,iF);}q[D]=gJ;q[D+f]=d5;D=d5;fb=D+(fs-gU);}}fn dE(F:bs,ad:h)->bool{cW(3u);if ad<c{let cV=ad<-d;if F.aj!=e{let cI=fu(F.aj,F.O);q[D]=gS;let h2=select(cI.F<<f,(cI.F<<f)|f,cV);q[D+f]=h2;q[D+2u]=i(cI.O);D+=3u;}else{if cV&&(abs(F.O)&1)==0{return false;}q[D]=gQ;D+=f;}}else{let a_=ft(F.aj,.5*ad);q[D]=gR;q[D+f]=a_.F;q[D+2u]=bitcast<i>(a_.c4);D+=3u;}return true;}fn h7(cb:el){cW(2u);q[D]=gP;q[D+f]=cb.c3;D+=2u;}fn gn(ty:i,aV:i,Q:i){cW(3u);q[D]=ty;q[D+f]=aV;q[D+2u]=Q;D+=3u;}fn h6(Q:i){cW(2u);q[D]=gM;q[D+f]=Q;D+=2u;}fn h5(){cW(f);q[D]=gL;D+=f;}fn h4(U:ek){cW(23u);q[D]=gK;q[D+f]=U.bh;q[D+2u]=bitcast<i>(U.bI.x);q[D+3u]=bitcast<i>(U.bI.y);q[D+4u]=bitcast<i>(U.bI.z);q[D+5u]=bitcast<i>(U.bI.w);q[D+6u]=bitcast<i>(U.bH.x);q[D+7u]=bitcast<i>(U.bH.y);q[D+8u]=bitcast<i>(U.bH.z);q[D+9u]=bitcast<i>(U.bH.w);q[D+10u]=bitcast<i>(U.bG.x);q[D+11u]=bitcast<i>(U.bG.y);q[D+12u]=bitcast<i>(U.bG.z);q[D+13u]=bitcast<i>(U.bG.w);q[D+14u]=bitcast<i>(U.a5.x);q[D+15u]=bitcast<i>(U.a5.y);q[D+16u]=bitcast<i>(U.a5.z);q[D+17u]=bitcast<i>(U.a5.w);q[D+18u]=bitcast<i>(U.bt.x);q[D+19u]=bitcast<i>(U.bt.y);q[D+20u]=bitcast<i>(U.bt.z);q[D+21u]=bitcast<i>(U.bt.w);q[D+22u]=select(e,f,U.c2);D+=23u;}@compute @workgroup_size(256)fn main(@builtin(local_invocation_id)k:M,@builtin(workgroup_id)ap:M){if k.x==e{bO[0]=atomicLoad(&ao.aq);}let aq=workgroupUniformLoad(&bO[0]);if(aq&(ev|fB|hb))!=e{return;}let cZ=(n.aL+bf- f)/bf;let dJ=cZ*ap.y+ap.x;let d9=(n.cN+aM- f)/aM;let d8=bf*ap.x;let d7=cP*ap.y;let fh=k.x % bf;let fg=k.x/bf;let h1=(d7+fg)*n.aL+d8+fh;D=h1*ej;fb=D+(ej-gU);var d4=e;var bd=e;var cU=e;var cH=e;var cG=e;var ff=e;var cg=e;var fe=e;var d3=e;let gm=D;D+=f;while true{for(var j=e;j<cj;j+=f){atomicStore(&bE[j][k.x],e);}while true{if cg==cG&&cU<d9{ff=cg;var cf=e;if cU+k.x<d9{let h0=(cU+k.x)*aM+dJ;let dI=hV[h0];cf=dI.bp;gf[k.x]=dI.ci;}for(var j=e;j<firstTrailingBit(o);j+=f){bO[k.x]=cf;workgroupBarrier();if k.x>=(f<<j){cf+=bO[k.x-(f<<j)];}workgroupBarrier();}bO[k.x]=ff+cf;cg=workgroupUniformLoad(&bO[o- f]);cU+=o;}var p=cH+k.x;if p>=cG&&p<cg{var dB=e;for(var j=e;j<firstTrailingBit(o);j+=f){let bF=dB+((aM/2u)>>j);if p>=bO[bF- f]{dB=bF;}}p-=select(ff,bO[dB- f],dB>e);let a2=n.g4+gf[dB];dz[k.x]=dA[a2+p];}cG=min(cH+aM,cg);if cG-cH>=aM||(cG>=cg&&cU>=d9){break;}}var a1=cM;var aG:i;if k.x+cH<cG{aG=dz[k.x];a1=s[n.c7+aG];}var ce=e;if a1!=cM{let ac=b4[aG].ac;let X=bQ[ac];let dD=X.l.z-X.l.x;fd[k.x]=dD;let gl=m(X.l.x)-m(d8);let dC=m(X.l.y)-m(d7);let J=clamp(gl,0,m(bf));let R=clamp(dC,0,m(cP));let S=clamp(m(X.l.z)-m(d8),0,m(bf));let V=clamp(m(X.l.w)-m(d7),0,m(cP));ge[k.x]=i(S-J);gd[k.x]=i(J)|i(R<<16u);ce=i(S-J)*i(V-R);let am=X.W-i(dC*m(dD)+gl);fc[k.x]=am;}bc[k.x]=ce;for(var j=e;j<firstTrailingBit(aM);j+=f){workgroupBarrier();if k.x>=(f<<j){ce+=bc[k.x-(f<<j)];}workgroupBarrier();bc[k.x]=ce;}workgroupBarrier();let d6=bc[aM- f];for(var p=k.x;p<d6;p+=aM){var av=e;for(var j=e;j<firstTrailingBit(aM);j+=f){let bF=av+((aM/2u)>>j);if p>=bc[bF- f]{av=bF;}}aG=dz[av];a1=s[n.c7+aG];let ef=p-select(e,bc[av- f],av>e);let ck=ge[av];let gk=gd[av];let x=(gk&65535u)+ef % ck;let y=(gk>>16u)+ef/ck;let aJ=fc[av]+fd[av]*y+x;let F=W[aJ];let gj=(a1&f)!=e;var gh=false;if gj{let h_=(128u<<8u)|3u;let bK=b4[aG].bK;let E=n.fy+bK;let bh=s[E];gh=bh!=h_;}let hZ=F.aj!=e||(F.O==0)==gj||gh;if hZ{let hY=av/32u;let hX=f<<(av&31u);atomicOr(&bE[hY][y*bf+x],hX);}}workgroupBarrier();var d2=e;var cF=atomicLoad(&bE[e][k.x]);while true{if cF==e{d2+=f;if d2==cj{break;}cF=atomicLoad(&bE[d2][k.x]);if cF==e{continue;}}let av=d2*32u+firstTrailingBit(cF);aG=dz[av];cF&=cF- f;let bn=s[n.c7+aG];let gi=b4[aG];let E=n.fy+gi.bK;let Z=gi.Q;if d4==e{let aJ=fc[av]+fd[av]*fg+fh;let F=W[aJ];switch bn{case 66u:{let ad=bitcast<h>(dA[Z]);if dE(F,ad){let c3=s[E];h7(el(c3));}}case 266u:{let ad=bitcast<h>(dA[Z]);if dE(F,ad){let aV=s[E];let Q=Z+f;gn(gO,aV,Q);}}case 654u:{let ad=bitcast<h>(dA[Z]);if dE(F,ad){let aV=s[E];let Q=Z+f;gn(gN,aV,Q);}}case 580u:{let ad=bitcast<h>(dA[Z]);if dE(F,ad){h6(Z+f);}}case 43u:{if F.aj==e&&F.O==0{d4=bd+f;}else{h5();fe+=f;d3=max(d3,fe);}bd+=f;}case 1025u:{bd-=f;dE(F,-d);let bh=s[E];let bI=vec4(bitcast<h>(s[E+f]),bitcast<h>(s[E+2u]),bitcast<h>(s[E+3u]),bitcast<h>(s[E+4u]));let bH=vec4(bitcast<h>(s[E+5u]),bitcast<h>(s[E+6u]),bitcast<h>(s[E+7u]),bitcast<h>(s[E+8u]));let bG=vec4(bitcast<h>(s[E+9u]),bitcast<h>(s[E+10u]),bitcast<h>(s[E+11u]),bitcast<h>(s[E+12u]));let a5=vec4(bitcast<h>(s[E+13u]),bitcast<h>(s[E+14u]),bitcast<h>(s[E+15u]),bitcast<h>(s[E+16u]));let bt=vec4(bitcast<h>(s[E+17u]),bitcast<h>(s[E+18u]),bitcast<h>(s[E+19u]),bitcast<h>(s[E+20u]));let c2=bI.a!=c||bH.a!=c||bG.a!=c||a5.r!=c||a5.g!=c||a5.b!=c||a5.a!=d||bt.a!=c;h4(ek(bh,bI,bH,bG,a5,bt,c2));fe-=f;}default:{}}}else{switch bn{case 43u:{bd+=f;}case 1025u:{if bd==d4{d4=e;}bd-=f;}default:{}}}}cH+=aM;if cH>=cg&&cU>=d9{break;}workgroupBarrier();}if d8+fh<n.aL&&d7+fg<n.cO{q[D]=gT;if d3>et{let hW=d3*cQ*bv;q[gm]=atomicAdd(&ao.bh,hW);}}}`
