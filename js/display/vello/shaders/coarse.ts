/* eslint-disable */
import tile from './shared/tile.js';
import ptcl from './shared/ptcl.js';
import drawtag from './shared/drawtag.js';
import bump from './shared/bump.js';
import config from './shared/config.js';
import pre from './shared/pre.js';

export default `${pre}${config}
${bump}
${drawtag}
${ptcl}
${tile}
@group(0)@binding(0)var<uniform>n:aR;@group(0)@binding(1)var<storage>u:aX;@group(0)@binding(2)var<storage>b1:array<aQ>;struct fi{bp:j,ce:j}@group(0)@binding(3)var<storage>hV:array<fi>;@group(0)@binding(4)var<storage>dy:aX;@group(0)@binding(5)var<storage>bM:array<cJ>;@group(0)@binding(6)var<storage>W:array<bs>;@group(0)@binding(7)var<storage,read_write>ao:eE;@group(0)@binding(8)var<storage,read_write>q:aX;const o=256u;const cf=8u;var<workgroup>bD:array<array<bS,aL>,cf>;var<workgroup>bK:array<j,o>;var<workgroup>ge:array<j,o>;var<workgroup>dx:array<j,o>;var<workgroup>fa:array<j,o>;var<workgroup>gd:array<j,o>;var<workgroup>gc:array<j,o>;var<workgroup>be:array<j,o>;var<workgroup>e9:array<j,o>;var<private>D:j;var<private>e8:j;fn cV(size:j){if D+size>=e8{let h3=n.aK*n.cO*eq;var d7=h3+atomicAdd(&ao.q,fp);if d7+fp>n.ix{d7=e;atomicOr(&ao.aq,iF);}q[D]=gJ;q[D+f]=d7;D=d7;e8=D+(fp-gU);}}fn dC(F:bs,ad:h)->bool{cV(3u);if ad<c{let cU=ad<-d;if F.aj!=e{let cI=fr(F.aj,F.O);q[D]=gS;let h2=select(cI.F<<f,(cI.F<<f)|f,cU);q[D+f]=h2;q[D+2u]=j(cI.O);D+=3u;}else{if cU&&(abs(F.O)&1)==0{return false;}q[D]=gQ;D+=f;}}else{let a2=fq(F.aj,.5*ad);q[D]=gR;q[D+f]=a2.F;q[D+2u]=bitcast<j>(a2.c3);D+=3u;}return true;}fn h7(b0:es){cV(2u);q[D]=gP;q[D+f]=b0.c2;D+=2u;}fn gm(ty:j,aW:j,R:j){cV(3u);q[D]=ty;q[D+f]=aW;q[D+2u]=R;D+=3u;}fn h6(R:j){cV(2u);q[D]=gM;q[D+f]=R;D+=2u;}fn h5(){cV(f);q[D]=gL;D+=f;}fn h4(aB:er){let eg=bitcast<cn>(aB.ck);let ef=bitcast<cn>(aB.cj);let ee=bitcast<cn>(aB.ci);let ed=bitcast<cn>(aB.b3);let ec=bitcast<cn>(aB.ch);cV(23u);q[D]=gK;q[D+f]=aB.bi;q[D+2u]=eg.x;q[D+3u]=eg.y;q[D+4u]=eg.z;q[D+5u]=eg.w;q[D+6u]=ef.x;q[D+7u]=ef.y;q[D+8u]=ef.z;q[D+9u]=ef.w;q[D+10u]=ee.x;q[D+11u]=ee.y;q[D+12u]=ee.z;q[D+13u]=ee.w;q[D+14u]=ed.x;q[D+15u]=ed.y;q[D+16u]=ed.z;q[D+17u]=ed.w;q[D+18u]=ec.x;q[D+19u]=ec.y;q[D+20u]=ec.z;q[D+21u]=ec.w;q[D+22u]=select(e,f,aB.c1);D+=23u;}@compute @workgroup_size(256)fn main(@builtin(local_invocation_id)k:M,@builtin(workgroup_id)ap:M){if k.x==e{bK[0]=atomicLoad(&ao.aq);}let aq=workgroupUniformLoad(&bK[0]);if(aq&(eD|fy|hb))!=e{return;}let cY=(n.aK+bh-f)/bh;let dH=cY*ap.y+ap.x;let eb=(n.cN+aL- f)/aL;let ea=bh*ap.x;let d9=cP*ap.y;let fe=k.x % bh;let fd=k.x/bh;let h1=(d9+fd)*n.aK+ea+fe;D=h1*eq;e8=D+(eq-gU);var d6=e;var bf=e;var cT=e;var cH=e;var cG=e;var fc=e;var cc=e;var fb=e;var d5=e;let gl=D;D+=f;while true{for(var i=e;i<cf;i+=f){atomicStore(&bD[i][k.x],e);}while true{if cc==cG&&cT<eb{fc=cc;var cb=e;if cT+k.x<eb{let h0=(cT+k.x)*aL+dH;let dG=hV[h0];cb=dG.bp;ge[k.x]=dG.ce;}for(var i=e;i<firstTrailingBit(o);i+=f){bK[k.x]=cb;workgroupBarrier();if k.x>=(f<<i){cb+=bK[k.x-(f<<i)];}workgroupBarrier();}bK[k.x]=fc+cb;cc=workgroupUniformLoad(&bK[o- f]);cT+=o;}var p=cH+k.x;if p>=cG&&p<cc{var dz=e;for(var i=e;i<firstTrailingBit(o);i+=f){let bE=dz+((aL/2u)>>i);if p>=bK[bE- f]{dz=bE;}}p-=select(fc,bK[dz- f],dz>e);let a5=n.g4+ge[dz];dx[k.x]=dy[a5+p];}cG=min(cH+aL,cc);if cG-cH>=aL||(cG>=cc&&cT>=eb){break;}}var a4=cM;var aG:j;if k.x+cH<cG{aG=dx[k.x];a4=u[n.c5+aG];}var ca=e;if a4!=cM{let ac=b1[aG].ac;let X=bM[ac];let dB=X.l.z-X.l.x;fa[k.x]=dB;let gk=m(X.l.x)-m(ea);let dA=m(X.l.y)-m(d9);let J=clamp(gk,0,m(bh));let S=clamp(dA,0,m(cP));let T=clamp(m(X.l.z)-m(ea),0,m(bh));let V=clamp(m(X.l.w)-m(d9),0,m(cP));gd[k.x]=j(T-J);gc[k.x]=j(J)|j(S<<16u);ca=j(T-J)*j(V-S);let aO=X.W-j(dA*m(dB)+gk);e9[k.x]=aO;}be[k.x]=ca;for(var i=e;i<firstTrailingBit(aL);i+=f){workgroupBarrier();if k.x>=(f<<i){ca+=be[k.x-(f<<i)];}workgroupBarrier();be[k.x]=ca;}workgroupBarrier();let d8=be[aL- f];for(var p=k.x;p<d8;p+=aL){var av=e;for(var i=e;i<firstTrailingBit(aL);i+=f){let bE=av+((aL/2u)>>i);if p>=be[bE- f]{av=bE;}}aG=dx[av];a4=u[n.c5+aG];let em=p-select(e,be[av- f],av>e);let cg=gd[av];let gj=gc[av];let x=(gj&65535u)+em % cg;let y=(gj>>16u)+em/cg;let aJ=e9[av]+fa[av]*y+x;let F=W[aJ];let gi=(a4&f)!=e;var gf=false;if gi{let h_=(128u<<8u)|3u;let bG=b1[aG].bG;let E=n.fv+bG;let bi=u[E];gf=bi!=h_;}let hZ=F.aj!=e||(F.O==0)==gi||gf;if hZ{let hY=av/32u;let hX=f<<(av&31u);atomicOr(&bD[hY][y*bh+x],hX);}}workgroupBarrier();var d4=e;var cF=atomicLoad(&bD[e][k.x]);while true{if cF==e{d4+=f;if d4==cf{break;}cF=atomicLoad(&bD[d4][k.x]);if cF==e{continue;}}let av=d4*32u+firstTrailingBit(cF);aG=dx[av];cF&=cF- f;let bn=u[n.c5+aG];let gh=b1[aG];let E=n.fv+gh.bG;let Z=gh.R;if d6==e{let aJ=e9[av]+fa[av]*fd+fe;let F=W[aJ];switch bn{case ft:{let ad=bitcast<h>(dy[Z]);if dC(F,ad){let c2=u[E];h7(es(c2));}}case ex:{let ad=bitcast<h>(dy[Z]);if dC(F,ad){let aW=u[E];let R=Z+f;gm(gO,aW,R);}}case ew:{let ad=bitcast<h>(dy[Z]);if dC(F,ad){let aW=u[E];let R=Z+f;gm(gN,aW,R);}}case ev:{let ad=bitcast<h>(dy[Z]);if dC(F,ad){h6(Z+f);}}case dP:{if F.aj==e&&F.O==0{d6=bf+f;}else{h5();fb+=f;d5=max(d5,fb);}bf+=f;}case eu:{bf-=f;dC(F,-d);let bi=u[E];let ck=bitcast<L>(vec4(u[E+f],u[E+2u],u[E+3u],u[E+4u]));let cj=bitcast<L>(vec4(u[E+5u],u[E+6u],u[E+7u],u[E+8u]));let ci=bitcast<L>(vec4(u[E+9u],u[E+10u],u[E+11u],u[E+12u]));let b3=bitcast<L>(vec4(u[E+13u],u[E+14u],u[E+15u],u[E+16u]));let ch=bitcast<L>(vec4(u[E+17u],u[E+18u],u[E+19u],u[E+20u]));let c1=ck.a!=c||cj.a!=c||ci.a!=c||ch.a!=c;h4(er(bi,ck,cj,ci,b3,ch,c1));fb-=f;}default:{}}}else{switch bn{case dP:{bf+=f;}case eu:{if bf==d6{d6=e;}bf-=f;}default:{}}}}cH+=aL;if cH>=cc&&cT>=eb{break;}workgroupBarrier();}if ea+fe<n.aK&&d9+fd<n.cO{q[D]=gT;if d5>eB{let hW=d5*cQ*bu;q[gl]=atomicAdd(&ao.bi,hW);}}}`
