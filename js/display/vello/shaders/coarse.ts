/* eslint-disable */
import tile from './shared/tile.js';
import ptcl from './shared/ptcl.js';
import drawtag from './shared/drawtag.js';
import bump from './shared/bump.js';
import config from './shared/config.js';
import pre from './shared/pre.js';

export default `${pre}${config}
${bump}
${drawtag}
${ptcl}
${tile}
@group(0)@binding(0)var<uniform>n:aT;@group(0)@binding(1)var<storage>u:aZ;@group(0)@binding(2)var<storage>b3:array<aS>;struct fm{bt:j,ce:j}@group(0)@binding(3)var<storage>hZ:array<fm>;@group(0)@binding(4)var<storage>dz:aZ;@group(0)@binding(5)var<storage>bP:array<cK>;@group(0)@binding(6)var<storage>X:array<bv>;@group(0)@binding(7)var<storage,read_write>ao:eG;@group(0)@binding(8)var<storage,read_write>q:aZ;const o=256u;const cf=8u;var<workgroup>bG:array<array<bW,aM>,cf>;var<workgroup>bN:array<j,o>;var<workgroup>gl:array<j,o>;var<workgroup>dy:array<j,o>;var<workgroup>fe:array<j,o>;var<workgroup>gk:array<j,o>;var<workgroup>gj:array<j,o>;var<workgroup>bi:array<j,o>;var<workgroup>fd:array<j,o>;var<private>D:j;var<private>fc:j;fn cX(size:j){if D+size>=fc{let h7=n.aL*n.cQ*es;var d9=h7+atomicAdd(&ao.q,fs);if d9+fs>n.iA{d9=e;atomicOr(&ao.aq,iI);}q[D]=gQ;q[D+f]=d9;D=d9;fc=D+(fs-g0);}}fn dD(F:bv,ad:h)->bool{cX(3u);if ad<c{let cW=ad<-d;if F.aj!=e{let cJ=fu(F.aj,F.O);q[D]=gZ;let h6=select(cJ.F<<f,(cJ.F<<f)|f,cW);q[D+f]=h6;q[D+2u]=j(cJ.O);D+=3u;}else{if cW&&(abs(F.O)&1)==0{return false;}q[D]=gX;D+=f;}}else{let a5=ft(F.aj,.5*ad);q[D]=gY;q[D+f]=a5.F;q[D+2u]=bitcast<j>(a5.c5);D+=3u;}return true;}fn ib(b2:eu){cX(2u);q[D]=gW;q[D+f]=b2.c4;D+=2u;}fn gt(ty:j,aY:j,Q:j){cX(3u);q[D]=ty;q[D+f]=aY;q[D+2u]=Q;D+=3u;}fn ia(Q:j){cX(2u);q[D]=gT;q[D+f]=Q;D+=2u;}fn h9(){cX(f);q[D]=gS;D+=f;}fn h8(aB:et){let ei=bitcast<co>(aB.cj);let eh=bitcast<co>(aB.ci);let eg=bitcast<co>(aB.ch);let ef=bitcast<co>(aB.b5);let ee=bitcast<co>(aB.cg);cX(23u);q[D]=gR;q[D+f]=aB.bl;q[D+2u]=ei.x;q[D+3u]=ei.y;q[D+4u]=ei.z;q[D+5u]=ei.w;q[D+6u]=eh.x;q[D+7u]=eh.y;q[D+8u]=eh.z;q[D+9u]=eh.w;q[D+10u]=eg.x;q[D+11u]=eg.y;q[D+12u]=eg.z;q[D+13u]=eg.w;q[D+14u]=ef.x;q[D+15u]=ef.y;q[D+16u]=ef.z;q[D+17u]=ef.w;q[D+18u]=ee.x;q[D+19u]=ee.y;q[D+20u]=ee.z;q[D+21u]=ee.w;q[D+22u]=select(e,f,aB.c3);D+=23u;}@compute @workgroup_size(256)fn main(@builtin(local_invocation_id)k:M,@builtin(workgroup_id)ap:M){if k.x==e{bN[0]=atomicLoad(&ao.aq);}let aq=workgroupUniformLoad(&bN[0]);if(aq&(eF|fC|hi))!=e{return;}let c_=(n.aL+bk-f)/bk;let dI=c_*ap.y+ap.x;let ed=(n.cP+aM- f)/aM;let ec=bk*ap.x;let eb=cR*ap.y;let fi=k.x % bk;let fh=k.x/bk;let h5=(eb+fh)*n.aL+ec+fi;D=h5*es;fc=D+(es-g0);var d8=e;var bj=e;var cV=e;var cI=e;var cH=e;var fg=e;var cc=e;var ff=e;var d7=e;let gs=D;D+=f;while true{for(var i=e;i<cf;i+=f){atomicStore(&bG[i][k.x],e);}while true{if cc==cH&&cV<ed{fg=cc;var cb=e;if cV+k.x<ed{let h4=(cV+k.x)*aM+dI;let dH=hZ[h4];cb=dH.bt;gl[k.x]=dH.ce;}for(var i=e;i<firstTrailingBit(o);i+=f){bN[k.x]=cb;workgroupBarrier();if k.x>=(f<<i){cb+=bN[k.x-(f<<i)];}workgroupBarrier();}bN[k.x]=fg+cb;cc=workgroupUniformLoad(&bN[o- f]);cV+=o;}var p=cI+k.x;if p>=cH&&p<cc{var dA=e;for(var i=e;i<firstTrailingBit(o);i+=f){let bH=dA+((aM/2u)>>i);if p>=bN[bH- f]{dA=bH;}}p-=select(fg,bN[dA- f],dA>e);let a4=n.hb+gl[dA];dy[k.x]=dz[a4+p];}cH=min(cI+aM,cc);if cH-cI>=aM||(cH>=cc&&cV>=ed){break;}}var a7=cO;var aH:j;if k.x+cI<cH{aH=dy[k.x];a7=u[n.c7+aH];}var ca=e;if a7!=cO{let ac=b3[aH].ac;let W=bP[ac];let dC=W.l.z-W.l.x;fe[k.x]=dC;let gq=m(W.l.x)-m(ec);let dB=m(W.l.y)-m(eb);let J=clamp(gq,0,m(bk));let S=clamp(dB,0,m(cR));let T=clamp(m(W.l.z)-m(ec),0,m(bk));let V=clamp(m(W.l.w)-m(eb),0,m(cR));gk[k.x]=j(T-J);gj[k.x]=j(J)|j(S<<16u);ca=j(T-J)*j(V-S);let aQ=W.X-j(dB*m(dC)+gq);fd[k.x]=aQ;}bi[k.x]=ca;for(var i=e;i<firstTrailingBit(aM);i+=f){workgroupBarrier();if k.x>=(f<<i){ca+=bi[k.x-(f<<i)];}workgroupBarrier();bi[k.x]=ca;}workgroupBarrier();let ea=bi[aM- f];for(var p=k.x;p<ea;p+=aM){var av=e;for(var i=e;i<firstTrailingBit(aM);i+=f){let bH=av+((aM/2u)>>i);if p>=bi[bH- f]{av=bH;}}aH=dy[av];a7=u[n.c7+aH];let eo=p-select(e,bi[av- f],av>e);let aP=gk[av];let gp=gj[av];let x=(gp&65535u)+eo % aP;let y=(gp>>16u)+eo/aP;let aK=fd[av]+fe[av]*y+x;let F=X[aK];let go=(a7&f)!=e;var gm=false;if go{let h3=(128u<<8u)|3u;let bJ=b3[aH].bJ;let E=n.fz+bJ;let bl=u[E];gm=bl!=h3;}let h2=F.aj!=e||(F.O==0)==go||gm;if h2{let h1=av/32u;let h0=f<<(av&31u);atomicOr(&bG[h1][y*bk+x],h0);}}workgroupBarrier();var d6=e;var cG=atomicLoad(&bG[e][k.x]);while true{if cG==e{d6+=f;if d6==cf{break;}cG=atomicLoad(&bG[d6][k.x]);if cG==e{continue;}}let av=d6*32u+firstTrailingBit(cG);aH=dy[av];cG&=cG- f;let bq=u[n.c7+aH];let gn=b3[aH];let E=n.fz+gn.bJ;let Y=gn.Q;if d8==e{let aK=fd[av]+fe[av]*fh+fi;let F=X[aK];switch bq{case fx:{let ad=bitcast<h>(dz[Y]);if dD(F,ad){let c4=u[E];ib(eu(c4));}}case ez:{let ad=bitcast<h>(dz[Y]);if dD(F,ad){let aY=u[E];let Q=Y+f;gt(gV,aY,Q);}}case ey:{let ad=bitcast<h>(dz[Y]);if dD(F,ad){let aY=u[E];let Q=Y+f;gt(gU,aY,Q);}}case ex:{let ad=bitcast<h>(dz[Y]);if dD(F,ad){ia(Y+f);}}case dQ:{if F.aj==e&&F.O==0{d8=bj+f;}else{h9();ff+=f;d7=max(d7,ff);}bj+=f;}case ew:{bj-=f;dD(F,-d);let bl=u[E];let cj=bitcast<L>(vec4(u[E+f],u[E+2u],u[E+3u],u[E+4u]));let ci=bitcast<L>(vec4(u[E+5u],u[E+6u],u[E+7u],u[E+8u]));let ch=bitcast<L>(vec4(u[E+9u],u[E+10u],u[E+11u],u[E+12u]));let b5=bitcast<L>(vec4(u[E+13u],u[E+14u],u[E+15u],u[E+16u]));let cg=bitcast<L>(vec4(u[E+17u],u[E+18u],u[E+19u],u[E+20u]));let c3=cj.a!=c||ci.a!=c||ch.a!=c||cg.a!=c;h8(et(bl,cj,ci,ch,b5,cg,c3));ff-=f;}default:{}}}else{switch bq{case dQ:{bj+=f;}case ew:{if bj==d8{d8=e;}bj-=f;}default:{}}}}cI+=aM;if cI>=cc&&cV>=ed{break;}workgroupBarrier();}if ec+fi<n.aL&&eb+fh<n.cQ{q[D]=g_;if d7>eD{let h_=d7*cS*bw;q[gs]=atomicAdd(&ao.bl,h_);}}}`
