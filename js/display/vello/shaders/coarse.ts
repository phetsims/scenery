/* eslint-disable */
import tile from './shared/tile.js';
import ptcl from './shared/ptcl.js';
import drawtag from './shared/drawtag.js';
import bump from './shared/bump.js';
import config from './shared/config.js';
import pre from './shared/pre.js';

export default `${pre}${config}
${bump}
${drawtag}
${ptcl}
${tile}
@group(0)@binding(0)var<uniform>n:aR;@group(0)@binding(1)var<storage>u:aX;@group(0)@binding(2)var<storage>b0:array<aQ>;struct fj{bs:j,cd:j}@group(0)@binding(3)var<storage>hZ:array<fj>;@group(0)@binding(4)var<storage>dw:aX;@group(0)@binding(5)var<storage>bN:array<cJ>;@group(0)@binding(6)var<storage>X:array<bu>;@group(0)@binding(7)var<storage,read_write>ao:eE;@group(0)@binding(8)var<storage,read_write>q:aX;const o=256u;const ce=8u;var<workgroup>bE:array<array<bT,aL>,ce>;var<workgroup>bL:array<j,o>;var<workgroup>gf:array<j,o>;var<workgroup>dv:array<j,o>;var<workgroup>fb:array<j,o>;var<workgroup>ge:array<j,o>;var<workgroup>gd:array<j,o>;var<workgroup>bh:array<j,o>;var<workgroup>fa:array<j,o>;var<private>D:j;var<private>e9:j;fn cV(size:j){if D+size>=e9{let h7=n.aK*n.cO*eq;var d4=h7+atomicAdd(&ao.q,fp);if d4+fp>n.iA{d4=e;atomicOr(&ao.aq,iI);}q[D]=gK;q[D+f]=d4;D=d4;e9=D+(fp-gV);}}fn dA(F:bu,ad:h)->bool{cV(3u);if ad<c{let cU=ad<-d;if F.aj!=e{let cI=fr(F.aj,F.O);q[D]=gT;let h6=select(cI.F<<f,(cI.F<<f)|f,cU);q[D+f]=h6;q[D+2u]=j(cI.O);D+=3u;}else{if cU&&(abs(F.O)&1)==0{return false;}q[D]=gR;D+=f;}}else{let a3=fq(F.aj,.5*ad);q[D]=gS;q[D+f]=a3.F;q[D+2u]=bitcast<j>(a3.c3);D+=3u;}return true;}fn ib(b_:es){cV(2u);q[D]=gQ;q[D+f]=b_.c2;D+=2u;}fn gn(ty:j,aW:j,Q:j){cV(3u);q[D]=ty;q[D+f]=aW;q[D+2u]=Q;D+=3u;}fn ia(Q:j){cV(2u);q[D]=gN;q[D+f]=Q;D+=2u;}fn h9(){cV(f);q[D]=gM;D+=f;}fn h8(aB:er){let ed=bitcast<cn>(aB.ci);let ec=bitcast<cn>(aB.ch);let eb=bitcast<cn>(aB.cg);let ea=bitcast<cn>(aB.b3);let d9=bitcast<cn>(aB.cf);cV(23u);q[D]=gL;q[D+f]=aB.bk;q[D+2u]=ed.x;q[D+3u]=ed.y;q[D+4u]=ed.z;q[D+5u]=ed.w;q[D+6u]=ec.x;q[D+7u]=ec.y;q[D+8u]=ec.z;q[D+9u]=ec.w;q[D+10u]=eb.x;q[D+11u]=eb.y;q[D+12u]=eb.z;q[D+13u]=eb.w;q[D+14u]=ea.x;q[D+15u]=ea.y;q[D+16u]=ea.z;q[D+17u]=ea.w;q[D+18u]=d9.x;q[D+19u]=d9.y;q[D+20u]=d9.z;q[D+21u]=d9.w;q[D+22u]=select(e,f,aB.c1);D+=23u;}@compute @workgroup_size(256)fn main(@builtin(local_invocation_id)k:M,@builtin(workgroup_id)ap:M){if k.x==e{bL[0]=atomicLoad(&ao.aq);}let aq=workgroupUniformLoad(&bL[0]);if(aq&(eD|fy|hd))!=e{return;}let cY=(n.aK+bj-f)/bj;let dF=cY*ap.y+ap.x;let d8=(n.cN+aL- f)/aL;let d7=bj*ap.x;let d6=cP*ap.y;let ff=k.x % bj;let fe=k.x/bj;let h5=(d6+fe)*n.aK+d7+ff;D=h5*eq;e9=D+(eq-gV);var d3=e;var bi=e;var cT=e;var cH=e;var cG=e;var fd=e;var cb=e;var fc=e;var d2=e;let gm=D;D+=f;while true{for(var i=e;i<ce;i+=f){atomicStore(&bE[i][k.x],e);}while true{if cb==cG&&cT<d8{fd=cb;var ca=e;if cT+k.x<d8{let h4=(cT+k.x)*aL+dF;let dE=hZ[h4];ca=dE.bs;gf[k.x]=dE.cd;}for(var i=e;i<firstTrailingBit(o);i+=f){bL[k.x]=ca;workgroupBarrier();if k.x>=(f<<i){ca+=bL[k.x-(f<<i)];}workgroupBarrier();}bL[k.x]=fd+ca;cb=workgroupUniformLoad(&bL[o- f]);cT+=o;}var p=cH+k.x;if p>=cG&&p<cb{var dx=e;for(var i=e;i<firstTrailingBit(o);i+=f){let bF=dx+((aL/2u)>>i);if p>=bL[bF- f]{dx=bF;}}p-=select(fd,bL[dx- f],dx>e);let a7=n.g6+gf[dx];dv[k.x]=dw[a7+p];}cG=min(cH+aL,cb);if cG-cH>=aL||(cG>=cb&&cT>=d8){break;}}var a6=cM;var aG:j;if k.x+cH<cG{aG=dv[k.x];a6=u[n.c5+aG];}var b9=e;if a6!=cM{let ac=b0[aG].ac;let W=bN[ac];let dz=W.l.z-W.l.x;fb[k.x]=dz;let gl=m(W.l.x)-m(d7);let dy=m(W.l.y)-m(d6);let J=clamp(gl,0,m(bj));let S=clamp(dy,0,m(cP));let T=clamp(m(W.l.z)-m(d7),0,m(bj));let V=clamp(m(W.l.w)-m(d6),0,m(cP));ge[k.x]=j(T-J);gd[k.x]=j(J)|j(S<<16u);b9=j(T-J)*j(V-S);let aO=W.X-j(dy*m(dz)+gl);fa[k.x]=aO;}bh[k.x]=b9;for(var i=e;i<firstTrailingBit(aL);i+=f){workgroupBarrier();if k.x>=(f<<i){b9+=bh[k.x-(f<<i)];}workgroupBarrier();bh[k.x]=b9;}workgroupBarrier();let d5=bh[aL- f];for(var p=k.x;p<d5;p+=aL){var av=e;for(var i=e;i<firstTrailingBit(aL);i+=f){let bF=av+((aL/2u)>>i);if p>=bh[bF- f]{av=bF;}}aG=dv[av];a6=u[n.c5+aG];let ej=p-select(e,bh[av- f],av>e);let b1=ge[av];let gk=gd[av];let x=(gk&65535u)+ej % b1;let y=(gk>>16u)+ej/b1;let aJ=fa[av]+fb[av]*y+x;let F=X[aJ];let gj=(a6&f)!=e;var gh=false;if gj{let h3=(128u<<8u)|3u;let bH=b0[aG].bH;let E=n.fv+bH;let bk=u[E];gh=bk!=h3;}let h2=F.aj!=e||(F.O==0)==gj||gh;if h2{let h1=av/32u;let h0=f<<(av&31u);atomicOr(&bE[h1][y*bj+x],h0);}}workgroupBarrier();var d1=e;var cF=atomicLoad(&bE[e][k.x]);while true{if cF==e{d1+=f;if d1==ce{break;}cF=atomicLoad(&bE[d1][k.x]);if cF==e{continue;}}let av=d1*32u+firstTrailingBit(cF);aG=dv[av];cF&=cF- f;let bp=u[n.c5+aG];let gi=b0[aG];let E=n.fv+gi.bH;let Y=gi.Q;if d3==e{let aJ=fa[av]+fb[av]*fe+ff;let F=X[aJ];switch bp{case ft:{let ad=bitcast<h>(dw[Y]);if dA(F,ad){let c2=u[E];ib(es(c2));}}case ex:{let ad=bitcast<h>(dw[Y]);if dA(F,ad){let aW=u[E];let Q=Y+f;gn(gP,aW,Q);}}case ew:{let ad=bitcast<h>(dw[Y]);if dA(F,ad){let aW=u[E];let Q=Y+f;gn(gO,aW,Q);}}case ev:{let ad=bitcast<h>(dw[Y]);if dA(F,ad){ia(Y+f);}}case dN:{if F.aj==e&&F.O==0{d3=bi+f;}else{h9();fc+=f;d2=max(d2,fc);}bi+=f;}case eu:{bi-=f;dA(F,-d);let bk=u[E];let ci=bitcast<L>(vec4(u[E+f],u[E+2u],u[E+3u],u[E+4u]));let ch=bitcast<L>(vec4(u[E+5u],u[E+6u],u[E+7u],u[E+8u]));let cg=bitcast<L>(vec4(u[E+9u],u[E+10u],u[E+11u],u[E+12u]));let b3=bitcast<L>(vec4(u[E+13u],u[E+14u],u[E+15u],u[E+16u]));let cf=bitcast<L>(vec4(u[E+17u],u[E+18u],u[E+19u],u[E+20u]));let c1=ci.a!=c||ch.a!=c||cg.a!=c||cf.a!=c;h8(er(bk,ci,ch,cg,b3,cf,c1));fc-=f;}default:{}}}else{switch bp{case dN:{bi+=f;}case eu:{if bi==d3{d3=e;}bi-=f;}default:{}}}}cH+=aL;if cH>=cb&&cT>=d8{break;}workgroupBarrier();}if d7+ff<n.aK&&d6+fe<n.cO{q[D]=gU;if d2>eB{let h_=d2*cQ*bv;q[gm]=atomicAdd(&ao.bk,h_);}}}`
