/* eslint-disable */
import ptcl from './shared/ptcl.js';
import blend from './shared/blend.js';
import config from './shared/config.js';
import segment from './shared/segment.js';
import pre from './shared/pre.js';

export default `${pre}struct bu{O:m,aj:j}${segment}
${config}
@group(0)@binding(0)var<uniform>n:aR;@group(0)@binding(1)var<storage>X:array<bu>;@group(0)@binding(2)var<storage>aj:array<dI>;${blend}
${ptcl}
const f1=512;@group(0)@binding(3)var a0:texture_storage_2d<rgba8unorm,write>;@group(0)@binding(4)var<storage>q:aX;@group(0)@binding(5)var e_:texture_2d<h>;@group(0)@binding(6)var<storage>info:aX;@group(0)@binding(7)var dU:texture_2d<h>;fn hS(C:j)->fr{let F=q[C+f];let O=m(q[C+2u]);return fr(F,O);}fn hR(C:j)->fq{let F=q[C+f];let c3=bitcast<h>(q[C+2u]);return fq(F,c3);}fn hQ(C:j)->es{let c2=q[C+f];return es(c2);}fn hP(C:j)->gY{let du=q[C+f];let aW=du>>2u;let a2=du&3u;let Q=q[C+2u];let ep=bitcast<h>(info[Q]);let fo=bitcast<h>(info[Q+f]);let dJ=bitcast<h>(info[Q+2u]);return gY(aW,a2,ep,fo,dJ);}fn hO(C:j)->gX{let du=q[C+f];let aW=du>>2u;let a2=du&3u;let Q=q[C+2u];let P=bitcast<L>(vec4(info[Q],info[Q+f],info[Q+2u],info[Q+3u]));let cL=bitcast<B>(vec2(info[Q+4u],info[Q+5u]));let bc=bitcast<h>(info[Q+6u]);let aV=bitcast<h>(info[Q+7u]);let f0=info[Q+8u];let aE=f0>>3u;let bG=f0&7u;return gX(aW,a2,P,cL,bc,aV,bG,aE);}fn hN(C:j)->gW{let Q=q[C+f];let P=bitcast<L>(vec4(info[Q],info[Q+f],info[Q+2u],info[Q+3u]));let cL=bitcast<B>(vec2(info[Q+4u],info[Q+5u]));let xy=info[Q+6u];let f_=info[Q+7u];let a2=info[Q+8u];let x=h(xy>>16u);let y=h(xy&65535u);let b1=h(f_>>16u);let fZ=h(f_&65535u);let em=vec2(a2>>2u,a2&0x3);return gW(P,cL,vec2(x,y),vec2(b1,fZ),em);}fn hM(C:j)->er{let bk=q[C+f];let ci=bitcast<L>(vec4(q[C+2u],q[C+3u],q[C+4u],q[C+5u]));let ch=bitcast<L>(vec4(q[C+6u],q[C+7u],q[C+8u],q[C+9u]));let cg=bitcast<L>(vec4(q[C+10u],q[C+11u],q[C+12u],q[C+13u]));let b3=bitcast<L>(vec4(q[C+14u],q[C+15u],q[C+16u],q[C+17u]));let cf=bitcast<L>(vec4(q[C+18u],q[C+19u],q[C+20u],q[C+21u]));let c1=q[C+22u]==f;return er(bk,ci,ch,cg,b3,cf,c1);}const hK=e;const hJ=f;const hI=2u;fn a2(A:h,b5:j)->h{switch b5{case hK:{return clamp(A,c,d);}case hJ:{return fract(A);}default:{return abs(A- 2.*round(.5*A));}}}const ai=4u;fn f2(F:bu,xy:B,cU:bool)->array<h,ai>{var at:array<h,ai>;let hH=h(F.O);for(var i=e;i<ai;i+=f){at[i]=hH;}var cC=F.aj;while cC!=e{let an=aj[cC];let y=an.cK.y-xy.y;let S=clamp(y,c,d);let V=clamp(y+an.aD.y,c,d);let dy=S-V;if dy!=c{let fY=d/an.aD.y;let hG=(S-y)*fY;let hF=(V-y)*fY;let fX=an.cK.x-xy.x;let J=fX+hG*an.aD.x;let T=fX+hF*an.aD.x;let hE=min(J,T);let hD=max(J,T);for(var i=e;i<ai;i+=f){let fW=h(i);let cE=min(hE-fW,d)- 1.e-6;let fV=hD-fW;let b=min(fV,d);let t=max(b,c);let cm=max(cE,c);let a=(b+.5*(cm*cm-t*t)-cE)/(fV-cE);at[i]+=a*dy;}}let a9=sign(an.aD.x)*clamp(xy.y-an.a9+d,c,d);for(var i=e;i<ai;i+=f){at[i]+=a9;}cC=an.el;}if cU{for(var i=e;i<ai;i+=f){let a=at[i];at[i]=abs(a- 2.*round(.5*a));}}else{for(var i=e;i<ai;i+=f){at[i]=min(abs(at[i]),d);}}return at;}fn hL(seg:j,c3:h,xy:B)->array<h,ai>{var cR:array<h,ai>;for(var i=e;i<ai;i+=f){cR[i]=1e9;}var cC=seg;while cC!=e{let an=aj[cC];let aD=an.aD;let fU=xy+vec2(.5,.5)-an.cK;let bf=d/dot(aD,aD);for(var i=e;i<ai;i+=f){let fT=vec2(fU.x+h(i),fU.y);let A=clamp(dot(fT,aD)*bf,c,d);cR[i]=min(cR[i],length(aD*A-fT));}cC=an.el;}for(var i=e;i<ai;i+=f){cR[i]=clamp(c3+.5-cR[i],c,d);}return cR;}@compute @workgroup_size(4,16)fn main(@builtin(global_invocation_id)N:M,@builtin(local_invocation_id)k:M,@builtin(workgroup_id)ap:M){let aJ=ap.y*n.aK+ap.x;let xy=vec2(h(N.x*ai),h(N.y));var rgba:array<L,ai>;for(var i=e;i<ai;i+=f){rgba[i]=unpack4x8unorm(n.iG).wzyx;}var fO:array<array<j,ai>,eB>;var bi=e;var at:array<h,ai>;var C=aJ*eq;let gm=q[C];C+=f;while true{let a6=q[C];if a6==gU{break;}switch a6{case gT:{let cI=hS(C);let aj=cI.F>>f;let cU=(cI.F&f)!=e;let F=bu(cI.O,aj);at=f2(F,xy,cU);C+=3u;}case gS:{let a3=hR(C);at=hL(a3.F,a3.c3,xy);C+=3u;}case gR:{for(var i=e;i<ai;i+=f){at[i]=d;}C+=f;}case gQ:{let b_=hQ(C);let e3=unpack4x8unorm(b_.c2).wzyx;for(var i=e;i<ai;i+=f){let bB=e3*at[i];rgba[i]=rgba[i]*(d-bB.a)+bB;}C+=2u;}case gP:{let cS=hP(C);let cm=cS.ep*xy.x+cS.fo*xy.y+cS.dJ;for(var i=e;i<ai;i+=f){let hC=cm+cS.ep*h(i);let x=m(round(a2(hC,cS.a2)*h(f1- 1)));let dt=textureLoad(e_,vec2(x,m(cS.aW)),0);let bB=dt*at[i];rgba[i]=rgba[i]*(d-bB.a)+bB;}C+=3u;}case gO:{let bA=hO(C);let bc=bA.bc;let aV=bA.aV;let hB=bA.bG==hb;let hA=bA.bG==hc;let hz=bA.bG==ha;let fS=(bA.aE&g9)!=e;let fR=select(d/aV,c,hA);let hy=select(d,-d,fS||(d-bc)<c);let hx=sign(d-bc);for(var i=e;i<ai;i+=f){let ds=vec2(xy.x+h(i),xy.y);let fQ=bA.P.xy*ds.x+bA.P.zw*ds.y+bA.cL;let x=fQ.x;let y=fQ.y;let xx=x*x;let yy=y*y;var A=c;var dV=true;if hB{let a=aV-yy;A=sqrt(a)+x;dV=a>=c;}else if hz{A=(xx+yy)/x;dV=A>=c&&x!=c;}else if aV>d{A=sqrt(xx+yy)-x*fR;}else{let a=xx-yy;A=hy*sqrt(a)-x*fR;dV=a>=c&&A>=c;}if dV{A=a2(bc+hx*A,bA.a2);A=select(A,d-A,fS);let x=m(round(A*h(f1- 1)));let dt=textureLoad(e_,vec2(x,m(bA.aW)),0);let bB=dt*at[i];rgba[i]=rgba[i]*(d-bB.a)+bB;}}C+=3u;}case gN:{let a5=hN(C);let hw=a5.eo;let hv=a5.eo+a5.en-d;let jl=a5.eo+a5.en;for(var i=e;i<ai;i+=f){let ds=vec2(xy.x+h(i),xy.y);let fP=(a5.P.xy*ds.x+a5.P.zw*ds.y+a5.cL)/a5.en;let hu=vec2(a2(fP.x,a5.em.x),a2(fP.y,a5.em.y));let e2=hu*a5.en+a5.eo;if at[i]!=c{let dW=vec4i(vec4(max(floor(e2),hw),min(ceil(e2),hv)));let e1=fract(e2);let a=dX(textureLoad(dU,dW.xy,0));let b=dX(textureLoad(dU,dW.xw,0));let t=dX(textureLoad(dU,dW.zy,0));let cm=dX(textureLoad(dU,dW.zw,0));let dt=mix(mix(a,b,e1.y),mix(t,cm,e1.y),e1.x);let bB=dt*at[i];rgba[i]=rgba[i]*(d-bB.a)+bB;}}C+=2u;}case gM:{if bi<eB{for(var i=e;i<ai;i+=f){fO[bi][i]=pack4x8unorm(rgba[i]);rgba[i]=vec4(c);}}else{}bi+=f;C+=f;}case gL:{let aB=hM(C);bi-=f;for(var i=e;i<ai;i+=f){var fN:j;if bi<eB{fN=fO[bi][i];}else{}let bg=unpack4x8unorm(fN);var a1=rgba[i];var bo:L;if aB.c1{let ht=d/max(a1.a,1e-6);a1=vec4(a1.rgb*ht,a1.a);bo=aB.ci*a1.r+aB.ch*a1.g+aB.cg*a1.b+aB.b3*a1.a+aB.cf;bo=clamp(bo,vec4(c),vec4(d));bo=vec4(bo.rgb*bo.a,bo.a);}else{let new_rgb=aB.ci.rgb*a1.r+aB.ch.rgb*a1.g+aB.cg.rgb*a1.b+aB.b3.rgb*a1.a*a1.a+aB.cf.rgb*a1.a;bo=aB.b3.a*vec4(new_rgb,a1.a);bo=clamp(bo,vec4(c),vec4(min(d,bo.a)));}let e3=bo*at[i];rgba[i]=jf(bg,e3,aB.bk);}C+=23u;}case gK:{C=q[C+f];}default:{}}}let e0=vec2u(xy);for(var i=e;i<ai;i+=f){let cD=e0+vec2(i,e);if cD.x<n.g8&&cD.y<n.g7{textureStore(a0,vec2i(cD),rgba[i]);}}}fn dX(rgba:L)->L{return vec4(rgba.rgb*rgba.a,rgba.a);}`
