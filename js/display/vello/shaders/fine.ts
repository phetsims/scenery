/* eslint-disable */
import ptcl from './shared/ptcl.js';
import blend from './shared/blend.js';
import config from './shared/config.js';
import segment from './shared/segment.js';
import pre from './shared/pre.js';

export default `${pre}struct bn{K:i,ae:d}${segment}
${config}
@group(0)@binding(0)var<uniform>j:aM;@group(0)@binding(1)var<storage>S:array<bn>;@group(0)@binding(2)var<storage>ae:array<dI>;${blend}
${ptcl}
const f_=512;@group(0)@binding(3)var bi:texture_storage_2d<rgba8unorm,write>;@group(0)@binding(4)var<storage>m:aS;@group(0)@binding(5)var eO:texture_2d<c>;@group(0)@binding(6)var<storage>info:aS;@group(0)@binding(7)var dU:texture_2d<c>;fn hK(u:d)->fq{let B=m[u+1u];let K=i(m[u+2u]);return fq(B,K);}fn hJ(u:d)->fp{let B=m[u+1u];let c0=bitcast<c>(m[u+2u]);return fp(B,c0);}fn hI(u:d)->eh{let c_=m[u+1u];return eh(c_);}fn hH(u:d)->gT{let du=m[u+1u];let aR=du>>2u;let bO=du&3u;let M=m[u+2u];let ee=bitcast<c>(info[M]);let fm=bitcast<c>(info[M+1u]);let dJ=bitcast<c>(info[M+2u]);return gT(aR,bO,ee,fm,dJ);}fn hG(u:d)->gS{let du=m[u+1u];let aR=du>>2u;let bO=du&3u;let M=m[u+2u];let eV=bitcast<c>(info[M]);let eU=bitcast<c>(info[M+1u]);let eT=bitcast<c>(info[M+2u]);let eS=bitcast<c>(info[M+3u]);let G=vec4(eV,eU,eT,eS);let cH=vec2(bitcast<c>(info[M+4u]),bitcast<c>(info[M+5u]));let a2=bitcast<c>(info[M+6u]);let aQ=bitcast<c>(info[M+7u]);let fZ=info[M+8u];let aA=fZ>>3u;let bF=fZ&7u;return gS(aR,bO,G,cH,a2,aQ,bF,aA);}fn hF(u:d)->gR{let M=m[u+1u];let eV=bitcast<c>(info[M]);let eU=bitcast<c>(info[M+1u]);let eT=bitcast<c>(info[M+2u]);let eS=bitcast<c>(info[M+3u]);let G=vec4(eV,eU,eT,eS);let cH=vec2(bitcast<c>(info[M+4u]),bitcast<c>(info[M+5u]));let xy=info[M+6u];let fY=info[M+7u];let x=c(xy>>16u);let y=c(xy&65535u);let cg=c(fY>>16u);let hC=c(fY&65535u);return gR(G,cH,vec2(x,y),vec2(cg,hC));}fn hE(u:d)->eg{let bc=m[u+1u];let bE=vec4(bitcast<c>(m[u+2u]),bitcast<c>(m[u+3u]),bitcast<c>(m[u+4u]),bitcast<c>(m[u+5u]));let bD=vec4(bitcast<c>(m[u+6u]),bitcast<c>(m[u+7u]),bitcast<c>(m[u+8u]),bitcast<c>(m[u+9u]));let bC=vec4(bitcast<c>(m[u+10u]),bitcast<c>(m[u+11u]),bitcast<c>(m[u+12u]),bitcast<c>(m[u+13u]));let a1=vec4(bitcast<c>(m[u+14u]),bitcast<c>(m[u+15u]),bitcast<c>(m[u+16u]),bitcast<c>(m[u+17u]));let bo=vec4(bitcast<c>(m[u+18u]),bitcast<c>(m[u+19u]),bitcast<c>(m[u+20u]),bitcast<c>(m[u+21u]));let cZ=m[u+22u]==1u;return eg(bc,bE,bD,bC,a1,bo,cZ);}fn bO(s:c,b2:d)->c{let hB=0u;let hA=1u;let hz=2u;switch b2{case 0u:{return clamp(s,0.,1.);}case 1u:{return fract(s);}default:{return abs(s- 2.*round(.5*s));}}}const ad=4u;fn f0(B:bn,xy:t,cR:bool)->array<c,ad>{var an:array<c,ad>;let hy=c(B.K);for(var e=0u;e<ad;e+=1u){an[e]=hy;}var cx=B.ae;while cx!=0u{let aj=ae[cx];let y=aj.cG.y-xy.y;let N=clamp(y,0.,1.);let R=clamp(y+aj.az.y,0.,1.);let dy=N-R;if dy!=0.{let fX=1./aj.az.y;let hx=(N-y)*fX;let hw=(R-y)*fX;let fW=aj.cG.x-xy.x;let F=fW+hx*aj.az.x;let O=fW+hw*aj.az.x;let hv=min(F,O);let hu=max(F,O);for(var e=0u;e<ad;e+=1u){let fV=c(e);let cz=min(hv-fV,1.)- 1.e-6;let fU=hu-fV;let b=min(fU,1.);let p=max(b,0.);let ci=max(cz,0.);let a=(b+.5*(ci*ci-p*p)-cz)/(fU-cz);an[e]+=a*dy;}}let a0=sign(aj.az.x)*clamp(xy.y-aj.a0+1.,0.,1.);for(var e=0u;e<ad;e+=1u){an[e]+=a0;}cx=aj.ed;}if cR{for(var e=0u;e<ad;e+=1u){let a=an[e];an[e]=abs(a- 2.*round(.5*a));}}else{for(var e=0u;e<ad;e+=1u){an[e]=min(abs(an[e]),1.);}}return an;}fn hD(seg:d,c0:c,xy:t)->array<c,ad>{var cN:array<c,ad>;for(var e=0u;e<ad;e+=1u){cN[e]=1e9;}var cx=seg;while cx!=0u{let aj=ae[cx];let az=aj.az;let fT=xy+vec2(.5,.5)-aj.cG;let a5=1./dot(az,az);for(var e=0u;e<ad;e+=1u){let fS=vec2(fT.x+c(e),fT.y);let s=clamp(dot(fS,az)*a5,0.,1.);cN[e]=min(cN[e],length(az*s-fS));}cx=aj.ed;}for(var e=0u;e<ad;e+=1u){cN[e]=clamp(c0+.5-cN[e],0.,1.);}return cN;}@compute @workgroup_size(4,16)fn main(@builtin(global_invocation_id)J:I,@builtin(local_invocation_id)f:I,@builtin(workgroup_id)al:I){let aF=al.y*j.aH+al.x;let xy=vec2(c(J.x*ad),c(J.y));var rgba:array<Z,ad>;for(var e=0u;e<ad;e+=1u){rgba[e]=unpack4x8unorm(j.iz).wzyx;}var fN:array<array<d,ad>,ep>;var a7=0u;var an:array<c,ad>;var u=aF*ef;let gi=m[u];u+=1u;while true{let aY=m[u];if aY==gP{break;}switch aY{case 1u:{let cE=hK(u);let ae=cE.B>>1u;let cR=(cE.B&1u)!=0u;let B=bn(cE.K,ae);an=f0(B,xy,cR);u+=3u;}case 2u:{let aW=hJ(u);an=hD(aW.B,aW.c0,xy);u+=3u;}case 3u:{for(var e=0u;e<ad;e+=1u){an[e]=1.;}u+=1u;}case 5u:{let b7=hI(u);let eR=unpack4x8unorm(b7.c_).wzyx;for(var e=0u;e<ad;e+=1u){let by=eR*an[e];rgba[e]=rgba[e]*(1.-by.a)+by;}u+=2u;}case 6u:{let cO=hH(u);let ci=cO.ee*xy.x+cO.fm*xy.y+cO.dJ;for(var e=0u;e<ad;e+=1u){let ht=ci+cO.ee*c(e);let x=i(round(bO(ht,cO.bO)*c(f_- 1)));let dt=textureLoad(eO,vec2(x,i(cO.aR)),0);let by=dt*an[e];rgba[e]=rgba[e]*(1.-by.a)+by;}u+=3u;}case 7u:{let bx=hG(u);let a2=bx.a2;let aQ=bx.aQ;let hs=bx.bF==g5;let hr=bx.bF==g6;let hq=bx.bF==g4;let fR=(bx.aA&g3)!=0u;let fQ=select(1./aQ,0.,hr);let hp=select(1.,-1.,fR||(1.-a2)<0.);let ho=sign(1.-a2);for(var e=0u;e<ad;e+=1u){let ds=vec2(xy.x+c(e),xy.y);let fP=bx.G.xy*ds.x+bx.G.zw*ds.y+bx.cH;let x=fP.x;let y=fP.y;let xx=x*x;let yy=y*y;var s=0.;var dV=true;if hs{let a=aQ-yy;s=sqrt(a)+x;dV=a>=0.;}else if hq{s=(xx+yy)/x;dV=s>=0.&&x!=0.;}else if aQ>1.{s=sqrt(xx+yy)-x*fQ;}else{let a=xx-yy;s=hp*sqrt(a)-x*fQ;dV=a>=0.&&s>=0.;}if dV{s=bO(a2+ho*s,bx.bO);s=select(s,1.-s,fR);let x=i(round(s*c(f_- 1)));let dt=textureLoad(eO,vec2(x,i(bx.aR)),0);let by=dt*an[e];rgba[e]=rgba[e]*(1.-by.a)+by;}}u+=3u;}case 8u:{let b6=hF(u);let fO=b6.fl+b6.io;for(var e=0u;e<ad;e+=1u){let ds=vec2(xy.x+c(e),xy.y);let dX=b6.G.xy*ds.x+b6.G.zw*ds.y+b6.cH+b6.fl;if all(dX<fO)&&an[e]!=0.{let dW=vec4(max(floor(dX),b6.fl),min(ceil(dX),fO));let eQ=fract(dX);let a=dY(textureLoad(dU,c8(dW.xy),0));let b=dY(textureLoad(dU,c8(dW.xw),0));let p=dY(textureLoad(dU,c8(dW.zy),0));let ci=dY(textureLoad(dU,c8(dW.zw),0));let dt=mix(mix(a,b,eQ.y),mix(p,ci,eQ.y),eQ.x);let by=dt*an[e];rgba[e]=rgba[e]*(1.-by.a)+by;}}u+=2u;}case 9u:{if a7<ep{for(var e=0u;e<ad;e+=1u){fN[a7][e]=pack4x8unorm(rgba[e]);rgba[e]=vec4(0.);}}else{}a7+=1u;u+=1u;}case 10u:{let Q=hE(u);a7-=1u;for(var e=0u;e<ad;e+=1u){var fM:d;if a7<ep{fM=fN[a7][e];}else{}let bg=unpack4x8unorm(fM);var a4=rgba[e];var bh:Z;if Q.cZ{let hn=1./max(a4.a,1e-6);a4=vec4(a4.rgb*hn,a4.a);bh=a4.r*Q.bE+a4.g*Q.bD+a4.b*Q.bC+a4.a*Q.a1+1.*Q.bo;bh=clamp(bh,vec4(0.),vec4(1.));bh=vec4(bh.rgb*bh.a,bh.a);}else{bh=a4.r*Q.bE+a4.g*Q.bD+a4.b*Q.bC+a4.a*Q.a1+a4.a*Q.bo;bh=clamp(bh,vec4(0.),vec4(min(1.,bh.a)));}let eR=bh*an[e];rgba[e]=i8(bg,eR,Q.bc);}u+=23u;}case 11u:{u=m[u+1u];}default:{}}}let eP=vec2u(xy);for(var e=0u;e<ad;e+=1u){let cy=eP+vec2(e,0u);if cy.x<j.g2&&cy.y<j.g1{textureStore(bi,c8(cy),rgba[e]);}}}fn dY(rgba:Z)->Z{return vec4(rgba.rgb*rgba.a,rgba.a);}`
