/* eslint-disable */
import ptcl from './shared/ptcl.js';
import blend from './shared/blend.js';
import config from './shared/config.js';
import segment from './shared/segment.js';
import pre from './shared/pre.js';

export default `${pre}struct bt{O:m,aj:j}${segment}
${config}
@group(0)@binding(0)var<uniform>n:aR;@group(0)@binding(1)var<storage>X:array<bt>;@group(0)@binding(2)var<storage>aj:array<dI>;${blend}
${ptcl}
const f_=512;@group(0)@binding(3)var a0:texture_storage_2d<rgba8unorm,write>;@group(0)@binding(4)var<storage>q:aX;@group(0)@binding(5)var eY:texture_2d<h>;@group(0)@binding(6)var<storage>info:aX;@group(0)@binding(7)var dU:texture_2d<h>;fn hO(C:j)->fp{let F=q[C+f];let O=m(q[C+2u]);return fp(F,O);}fn hN(C:j)->fo{let F=q[C+f];let c3=bitcast<h>(q[C+2u]);return fo(F,c3);}fn hM(C:j)->eq{let c2=q[C+f];return eq(c2);}fn hL(C:j)->gX{let du=q[C+f];let aW=du>>2u;let bh=du&3u;let Q=q[C+2u];let en=bitcast<h>(info[Q]);let fl=bitcast<h>(info[Q+f]);let dJ=bitcast<h>(info[Q+2u]);return gX(aW,bh,en,fl,dJ);}fn hK(C:j)->gW{let du=q[C+f];let aW=du>>2u;let bh=du&3u;let Q=q[C+2u];let P=bitcast<L>(vec4(info[Q],info[Q+f],info[Q+2u],info[Q+3u]));let cL=bitcast<B>(vec2(info[Q+4u],info[Q+5u]));let a8=bitcast<h>(info[Q+6u]);let aV=bitcast<h>(info[Q+7u]);let fZ=info[Q+8u];let aE=fZ>>3u;let bF=fZ&7u;return gW(aW,bh,P,cL,a8,aV,bF,aE);}fn hJ(C:j)->gV{let Q=q[C+f];let P=bitcast<L>(vec4(info[Q],info[Q+f],info[Q+2u],info[Q+3u]));let cL=bitcast<B>(vec2(info[Q+4u],info[Q+5u]));let xy=info[Q+6u];let fY=info[Q+7u];let bh=info[Q+8u];let x=h(xy>>16u);let y=h(xy&65535u);let b0=h(fY>>16u);let fX=h(fY&65535u);let gI=vec2(bh>>2u,bh&0x3);return gV(P,cL,vec2(x,y),vec2(b0,fX),gI);}fn hI(C:j)->ep{let bj=q[C+f];let ch=bitcast<L>(vec4(q[C+2u],q[C+3u],q[C+4u],q[C+5u]));let cg=bitcast<L>(vec4(q[C+6u],q[C+7u],q[C+8u],q[C+9u]));let cf=bitcast<L>(vec4(q[C+10u],q[C+11u],q[C+12u],q[C+13u]));let b2=bitcast<L>(vec4(q[C+14u],q[C+15u],q[C+16u],q[C+17u]));let ce=bitcast<L>(vec4(q[C+18u],q[C+19u],q[C+20u],q[C+21u]));let c1=q[C+22u]==f;return ep(bj,ch,cg,cf,b2,ce,c1);}const hG=e;const hF=f;const hE=2u;fn bh(A:h,b4:j)->h{switch b4{case hG:{return clamp(A,c,d);}case hF:{return fract(A);}default:{return abs(A- 2.*round(.5*A));}}}const ai=4u;fn f0(F:bt,xy:B,cU:bool)->array<h,ai>{var at:array<h,ai>;let hD=h(F.O);for(var i=e;i<ai;i+=f){at[i]=hD;}var cB=F.aj;while cB!=e{let an=aj[cB];let y=an.cK.y-xy.y;let S=clamp(y,c,d);let V=clamp(y+an.aD.y,c,d);let dy=S-V;if dy!=c{let fW=d/an.aD.y;let hC=(S-y)*fW;let hB=(V-y)*fW;let fV=an.cK.x-xy.x;let J=fV+hC*an.aD.x;let T=fV+hB*an.aD.x;let hA=min(J,T);let hz=max(J,T);for(var i=e;i<ai;i+=f){let fU=h(i);let cE=min(hA-fU,d)- 1.e-6;let fT=hz-fU;let b=min(fT,d);let t=max(b,c);let cl=max(cE,c);let a=(b+.5*(cl*cl-t*t)-cE)/(fT-cE);at[i]+=a*dy;}}let a7=sign(an.aD.x)*clamp(xy.y-an.a7+d,c,d);for(var i=e;i<ai;i+=f){at[i]+=a7;}cB=an.em;}if cU{for(var i=e;i<ai;i+=f){let a=at[i];at[i]=abs(a- 2.*round(.5*a));}}else{for(var i=e;i<ai;i+=f){at[i]=min(abs(at[i]),d);}}return at;}fn hH(seg:j,c3:h,xy:B)->array<h,ai>{var cR:array<h,ai>;for(var i=e;i<ai;i+=f){cR[i]=1e9;}var cB=seg;while cB!=e{let an=aj[cB];let aD=an.aD;let fS=xy+vec2(.5,.5)-an.cK;let bd=d/dot(aD,aD);for(var i=e;i<ai;i+=f){let fR=vec2(fS.x+h(i),fS.y);let A=clamp(dot(fR,aD)*bd,c,d);cR[i]=min(cR[i],length(aD*A-fR));}cB=an.em;}for(var i=e;i<ai;i+=f){cR[i]=clamp(c3+.5-cR[i],c,d);}return cR;}@compute @workgroup_size(4,16)fn main(@builtin(global_invocation_id)N:M,@builtin(local_invocation_id)k:M,@builtin(workgroup_id)ap:M){let aJ=ap.y*n.aK+ap.x;let xy=vec2(h(N.x*ai),h(N.y));var rgba:array<L,ai>;for(var i=e;i<ai;i+=f){rgba[i]=unpack4x8unorm(n.iD).wzyx;}var fM:array<array<j,ai>,ez>;var bf=e;var at:array<h,ai>;var C=aJ*eo;let gk=q[C];C+=f;while true{let a4=q[C];if a4==gT{break;}switch a4{case gS:{let cI=hO(C);let aj=cI.F>>f;let cU=(cI.F&f)!=e;let F=bt(cI.O,aj);at=f0(F,xy,cU);C+=3u;}case gR:{let a2=hN(C);at=hH(a2.F,a2.c3,xy);C+=3u;}case gQ:{for(var i=e;i<ai;i+=f){at[i]=d;}C+=f;}case gP:{let bZ=hM(C);let e0=unpack4x8unorm(bZ.c2).wzyx;for(var i=e;i<ai;i+=f){let bA=e0*at[i];rgba[i]=rgba[i]*(d-bA.a)+bA;}C+=2u;}case gO:{let cS=hL(C);let cl=cS.en*xy.x+cS.fl*xy.y+cS.dJ;for(var i=e;i<ai;i+=f){let hy=cl+cS.en*h(i);let x=m(round(bh(hy,cS.bh)*h(f_- 1)));let dt=textureLoad(eY,vec2(x,m(cS.aW)),0);let bA=dt*at[i];rgba[i]=rgba[i]*(d-bA.a)+bA;}C+=3u;}case gN:{let bz=hK(C);let a8=bz.a8;let aV=bz.aV;let hx=bz.bF==ha;let hw=bz.bF==hb;let hv=bz.bF==g9;let fQ=(bz.aE&g8)!=e;let fP=select(d/aV,c,hw);let hu=select(d,-d,fQ||(d-a8)<c);let ht=sign(d-a8);for(var i=e;i<ai;i+=f){let ds=vec2(xy.x+h(i),xy.y);let fO=bz.P.xy*ds.x+bz.P.zw*ds.y+bz.cL;let x=fO.x;let y=fO.y;let xx=x*x;let yy=y*y;var A=c;var dV=true;if hx{let a=aV-yy;A=sqrt(a)+x;dV=a>=c;}else if hv{A=(xx+yy)/x;dV=A>=c&&x!=c;}else if aV>d{A=sqrt(xx+yy)-x*fP;}else{let a=xx-yy;A=hu*sqrt(a)-x*fP;dV=a>=c&&A>=c;}if dV{A=bh(a8+ht*A,bz.bh);A=select(A,d-A,fQ);let x=m(round(A*h(f_- 1)));let dt=textureLoad(eY,vec2(x,m(bz.aW)),0);let bA=dt*at[i];rgba[i]=rgba[i]*(d-bA.a)+bA;}}C+=3u;}case gM:{let cD=hJ(C);let fN=cD.fk+cD.is;for(var i=e;i<ai;i+=f){let ds=vec2(xy.x+h(i),xy.y);let dX=cD.P.xy*ds.x+cD.P.zw*ds.y+cD.cL+cD.fk;if all(dX<fN)&&at[i]!=c{let dW=vec4i(vec4(max(floor(dX),cD.fk),min(ceil(dX),fN)));let e_=fract(dX);let a=dY(textureLoad(dU,dW.xy,0));let b=dY(textureLoad(dU,dW.xw,0));let t=dY(textureLoad(dU,dW.zy,0));let cl=dY(textureLoad(dU,dW.zw,0));let dt=mix(mix(a,b,e_.y),mix(t,cl,e_.y),e_.x);let bA=dt*at[i];rgba[i]=rgba[i]*(d-bA.a)+bA;}}C+=2u;}case gL:{if bf<ez{for(var i=e;i<ai;i+=f){fM[bf][i]=pack4x8unorm(rgba[i]);rgba[i]=vec4(c);}}else{}bf+=f;C+=f;}case gK:{let aB=hI(C);bf-=f;for(var i=e;i<ai;i+=f){var fL:j;if bf<ez{fL=fM[bf][i];}else{}let bg=unpack4x8unorm(fL);var a1=rgba[i];var bn:L;if aB.c1{let hs=d/max(a1.a,1e-6);a1=vec4(a1.rgb*hs,a1.a);bn=aB.ch*a1.r+aB.cg*a1.g+aB.cf*a1.b+aB.b2*a1.a+aB.ce;bn=clamp(bn,vec4(c),vec4(d));bn=vec4(bn.rgb*bn.a,bn.a);}else{let new_rgb=aB.ch.rgb*a1.r+aB.cg.rgb*a1.g+aB.cf.rgb*a1.b+aB.b2.rgb*a1.a*a1.a+aB.ce.rgb*a1.a;bn=aB.b2.a*vec4(new_rgb,a1.a);bn=clamp(bn,vec4(c),vec4(min(d,bn.a)));}let e0=bn*at[i];rgba[i]=jc(bg,e0,aB.bj);}C+=23u;}case gJ:{C=q[C+f];}default:{}}}let eZ=vec2u(xy);for(var i=e;i<ai;i+=f){let cC=eZ+vec2(i,e);if cC.x<n.g7&&cC.y<n.g6{textureStore(a0,vec2i(cC),rgba[i]);}}}fn dY(rgba:L)->L{return vec4(rgba.rgb*rgba.a,rgba.a);}`
