/* eslint-disable */
import ptcl from './shared/ptcl.js';
import blend from './shared/blend.js';
import config from './shared/config.js';
import segment from './shared/segment.js';
import pre from './shared/pre.js';

export default `${pre}struct bs{P:m,aj:j}${segment}
${config}
@group(0)@binding(0)var<uniform>n:aR;@group(0)@binding(1)var<storage>W:array<bs>;@group(0)@binding(2)var<storage>aj:array<dL>;${blend}
${ptcl}
const f1=512;@group(0)@binding(3)var a0:texture_storage_2d<rgba8unorm,write>;@group(0)@binding(4)var<storage>q:aX;@group(0)@binding(5)var e_:texture_2d<h>;@group(0)@binding(6)var<storage>info:aX;@group(0)@binding(7)var dX:texture_2d<h>;fn hO(C:j)->fs{let F=q[C+f];let P=m(q[C+2u]);return fs(F,P);}fn hN(C:j)->fr{let F=q[C+f];let c3=bitcast<h>(q[C+2u]);return fr(F,c3);}fn hM(C:j)->et{let c2=q[C+f];return et(c2);}fn hL(C:j)->gX{let dx=q[C+f];let aW=dx>>2u;let bP=dx&3u;let R=q[C+2u];let eq=bitcast<h>(info[R]);let fp=bitcast<h>(info[R+f]);let dM=bitcast<h>(info[R+2u]);return gX(aW,bP,eq,fp,dM);}fn hK(C:j)->gW{let dx=q[C+f];let aW=dx>>2u;let bP=dx&3u;let R=q[C+2u];let O=bitcast<L>(vec4(info[R],info[R+f],info[R+2u],info[R+3u]));let cL=bitcast<v>(vec2(info[R+4u],info[R+5u]));let a8=bitcast<h>(info[R+6u]);let aV=bitcast<h>(info[R+7u]);let f0=info[R+8u];let aF=f0>>3u;let bG=f0&7u;return gW(aW,bP,O,cL,a8,aV,bG,aF);}fn hJ(C:j)->gV{let R=q[C+f];let O=bitcast<L>(vec4(info[R],info[R+f],info[R+2u],info[R+3u]));let cL=bitcast<v>(vec2(info[R+4u],info[R+5u]));let xy=info[R+6u];let f_=info[R+7u];let x=h(xy>>16u);let y=h(xy&65535u);let cg=h(f_>>16u);let hG=h(f_&65535u);return gV(O,cL,vec2(x,y),vec2(cg,hG));}fn hI(C:j)->es{let bi=q[C+f];let ck=bitcast<L>(vec4(q[C+2u],q[C+3u],q[C+4u],q[C+5u]));let cj=bitcast<L>(vec4(q[C+6u],q[C+7u],q[C+8u],q[C+9u]));let ci=bitcast<L>(vec4(q[C+10u],q[C+11u],q[C+12u],q[C+13u]));let b3=bitcast<L>(vec4(q[C+14u],q[C+15u],q[C+16u],q[C+17u]));let ch=bitcast<L>(vec4(q[C+18u],q[C+19u],q[C+20u],q[C+21u]));let c1=q[C+22u]==f;return es(bi,ck,cj,ci,b3,ch,c1);}const hF=e;const hE=f;const hD=2u;fn bP(B:h,b5:j)->h{switch b5{case hF:{return clamp(B,c,d);}case hE:{return fract(B);}default:{return abs(B- 2.*round(.5*B));}}}const ai=4u;fn f2(F:bs,xy:v,cU:bool)->array<h,ai>{var au:array<h,ai>;let hC=h(F.P);for(var i=e;i<ai;i+=f){au[i]=hC;}var cC=F.aj;while cC!=e{let ao=aj[cC];let y=ao.cK.y-xy.y;let S=clamp(y,c,d);let V=clamp(y+ao.aE.y,c,d);let dB=S-V;if dB!=c{let fZ=d/ao.aE.y;let hB=(S-y)*fZ;let hA=(V-y)*fZ;let fY=ao.cK.x-xy.x;let J=fY+hB*ao.aE.x;let T=fY+hA*ao.aE.x;let hz=min(J,T);let hy=max(J,T);for(var i=e;i<ai;i+=f){let fX=h(i);let cE=min(hz-fX,d)- 1.e-6;let fW=hy-fX;let b=min(fW,d);let u=max(b,c);let cm=max(cE,c);let a=(b+.5*(cm*cm-u*u)-cE)/(fW-cE);au[i]+=a*dB;}}let a7=sign(ao.aE.x)*clamp(xy.y-ao.a7+d,c,d);for(var i=e;i<ai;i+=f){au[i]+=a7;}cC=ao.ep;}if cU{for(var i=e;i<ai;i+=f){let a=au[i];au[i]=abs(a- 2.*round(.5*a));}}else{for(var i=e;i<ai;i+=f){au[i]=min(abs(au[i]),d);}}return au;}fn hH(seg:j,c3:h,xy:v)->array<h,ai>{var cR:array<h,ai>;for(var i=e;i<ai;i+=f){cR[i]=1e9;}var cC=seg;while cC!=e{let ao=aj[cC];let aE=ao.aE;let fV=xy+vec2(.5,.5)-ao.cK;let bd=d/dot(aE,aE);for(var i=e;i<ai;i+=f){let fU=vec2(fV.x+h(i),fV.y);let B=clamp(dot(fU,aE)*bd,c,d);cR[i]=min(cR[i],length(aE*B-fU));}cC=ao.ep;}for(var i=e;i<ai;i+=f){cR[i]=clamp(c3+.5-cR[i],c,d);}return cR;}@compute @workgroup_size(4,16)fn main(@builtin(global_invocation_id)N:M,@builtin(local_invocation_id)k:M,@builtin(workgroup_id)aq:M){let aK=aq.y*n.aM+aq.x;let xy=vec2(h(N.x*ai),h(N.y));var rgba:array<L,ai>;for(var i=e;i<ai;i+=f){rgba[i]=unpack4x8unorm(n.iD).wzyx;}var fP:array<array<j,ai>,eB>;var bf=e;var au:array<h,ai>;var C=aK*er;let gm=q[C];C+=f;while true{let a4=q[C];if a4==gT{break;}switch a4{case gS:{let cI=hO(C);let aj=cI.F>>f;let cU=(cI.F&f)!=e;let F=bs(cI.P,aj);au=f2(F,xy,cU);C+=3u;}case gR:{let a2=hN(C);au=hH(a2.F,a2.c3,xy);C+=3u;}case gQ:{for(var i=e;i<ai;i+=f){au[i]=d;}C+=f;}case gP:{let b1=hM(C);let e2=unpack4x8unorm(b1.c2).wzyx;for(var i=e;i<ai;i+=f){let bA=e2*au[i];rgba[i]=rgba[i]*(d-bA.a)+bA;}C+=2u;}case gO:{let cS=hL(C);let cm=cS.eq*xy.x+cS.fp*xy.y+cS.dM;for(var i=e;i<ai;i+=f){let hx=cm+cS.eq*h(i);let x=m(round(bP(hx,cS.bP)*h(f1- 1)));let dw=textureLoad(e_,vec2(x,m(cS.aW)),0);let bA=dw*au[i];rgba[i]=rgba[i]*(d-bA.a)+bA;}C+=3u;}case gN:{let bz=hK(C);let a8=bz.a8;let aV=bz.aV;let hw=bz.bG==g9;let hv=bz.bG==ha;let hu=bz.bG==g8;let fT=(bz.aF&g7)!=e;let fS=select(d/aV,c,hv);let ht=select(d,-d,fT||(d-a8)<c);let hs=sign(d-a8);for(var i=e;i<ai;i+=f){let dv=vec2(xy.x+h(i),xy.y);let fR=bz.O.xy*dv.x+bz.O.zw*dv.y+bz.cL;let x=fR.x;let y=fR.y;let xx=x*x;let yy=y*y;var B=c;var dY=true;if hw{let a=aV-yy;B=sqrt(a)+x;dY=a>=c;}else if hu{B=(xx+yy)/x;dY=B>=c&&x!=c;}else if aV>d{B=sqrt(xx+yy)-x*fS;}else{let a=xx-yy;B=ht*sqrt(a)-x*fS;dY=a>=c&&B>=c;}if dY{B=bP(a8+hs*B,bz.bP);B=select(B,d-B,fT);let x=m(round(B*h(f1- 1)));let dw=textureLoad(e_,vec2(x,m(bz.aW)),0);let bA=dw*au[i];rgba[i]=rgba[i]*(d-bA.a)+bA;}}C+=3u;}case gM:{let b9=hJ(C);let fQ=b9.fo+b9.is;for(var i=e;i<ai;i+=f){let dv=vec2(xy.x+h(i),xy.y);let d_=b9.O.xy*dv.x+b9.O.zw*dv.y+b9.cL+b9.fo;if all(d_<fQ)&&au[i]!=c{let dZ=vec4(max(floor(d_),b9.fo),min(ceil(d_),fQ));let e1=fract(d_);let a=d0(textureLoad(dX,db(dZ.xy),0));let b=d0(textureLoad(dX,db(dZ.xw),0));let u=d0(textureLoad(dX,db(dZ.zy),0));let cm=d0(textureLoad(dX,db(dZ.zw),0));let dw=mix(mix(a,b,e1.y),mix(u,cm,e1.y),e1.x);let bA=dw*au[i];rgba[i]=rgba[i]*(d-bA.a)+bA;}}C+=2u;}case gL:{if bf<eB{for(var i=e;i<ai;i+=f){fP[bf][i]=pack4x8unorm(rgba[i]);rgba[i]=vec4(c);}}else{}bf+=f;C+=f;}case gK:{let aC=hI(C);bf-=f;for(var i=e;i<ai;i+=f){var fO:j;if bf<eB{fO=fP[bf][i];}else{}let bg=unpack4x8unorm(fO);var a1=rgba[i];var bm:L;if aC.c1{let hr=d/max(a1.a,1e-6);a1=vec4(a1.rgb*hr,a1.a);bm=aC.ck*a1.r+aC.cj*a1.g+aC.ci*a1.b+aC.b3*a1.a+aC.ch;bm=clamp(bm,vec4(c),vec4(d));bm=vec4(bm.rgb*bm.a,bm.a);}else{let new_rgb=aC.ck.rgb*a1.r+aC.cj.rgb*a1.g+aC.ci.rgb*a1.b+aC.b3.rgb*a1.a*a1.a+aC.ch.rgb*a1.a;bm=aC.b3.a*vec4(new_rgb,a1.a);bm=clamp(bm,vec4(c),vec4(min(d,bm.a)));}let e2=bm*au[i];rgba[i]=jc(bg,e2,aC.bi);}C+=23u;}case gJ:{C=q[C+f];}default:{}}}let e0=vec2u(xy);for(var i=e;i<ai;i+=f){let cD=e0+vec2(i,e);if cD.x<n.g6&&cD.y<n.g5{textureStore(a0,db(cD),rgba[i]);}}}fn d0(rgba:L)->L{return vec4(rgba.rgb*rgba.a,rgba.a);}`
