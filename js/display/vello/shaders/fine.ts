/* eslint-disable */
import ptcl from './shared/ptcl.js';
import blend from './shared/blend.js';
import config from './shared/config.js';
import segment from './shared/segment.js';
import pre from './shared/pre.js';

export default `${pre}struct bs{O:m,aj:i}${segment}
${config}
@group(0)@binding(0)var<uniform>n:aQ;@group(0)@binding(1)var<storage>W:array<bs>;@group(0)@binding(2)var<storage>aj:array<dM>;${blend}
${ptcl}
const f3=512;@group(0)@binding(3)var bm:texture_storage_2d<rgba8unorm,write>;@group(0)@binding(4)var<storage>q:aW;@group(0)@binding(5)var eS:texture_2d<h>;@group(0)@binding(6)var<storage>info:aW;@group(0)@binding(7)var dY:texture_2d<h>;fn hO(C:i)->fu{let F=q[C+f];let O=m(q[C+2u]);return fu(F,O);}fn hN(C:i)->ft{let F=q[C+f];let c4=bitcast<h>(q[C+2u]);return ft(F,c4);}fn hM(C:i)->el{let c3=q[C+f];return el(c3);}fn hL(C:i)->gX{let dy=q[C+f];let aV=dy>>2u;let bS=dy&3u;let Q=q[C+2u];let ei=bitcast<h>(info[Q]);let fr=bitcast<h>(info[Q+f]);let dN=bitcast<h>(info[Q+2u]);return gX(aV,bS,ei,fr,dN);}fn hK(C:i)->gW{let dy=q[C+f];let aV=dy>>2u;let bS=dy&3u;let Q=q[C+2u];let eZ=bitcast<h>(info[Q]);let eY=bitcast<h>(info[Q+f]);let eX=bitcast<h>(info[Q+2u]);let eW=bitcast<h>(info[Q+3u]);let K=vec4(eZ,eY,eX,eW);let cL=vec2(bitcast<h>(info[Q+4u]),bitcast<h>(info[Q+5u]));let a6=bitcast<h>(info[Q+6u]);let aU=bitcast<h>(info[Q+7u]);let f2=info[Q+8u];let aE=f2>>3u;let bJ=f2&7u;return gW(aV,bS,K,cL,a6,aU,bJ,aE);}fn hJ(C:i)->gV{let Q=q[C+f];let eZ=bitcast<h>(info[Q]);let eY=bitcast<h>(info[Q+f]);let eX=bitcast<h>(info[Q+2u]);let eW=bitcast<h>(info[Q+3u]);let K=vec4(eZ,eY,eX,eW);let cL=vec2(bitcast<h>(info[Q+4u]),bitcast<h>(info[Q+5u]));let xy=info[Q+6u];let f1=info[Q+7u];let x=h(xy>>16u);let y=h(xy&65535u);let ck=h(f1>>16u);let hG=h(f1&65535u);return gV(K,cL,vec2(x,y),vec2(ck,hG));}fn hI(C:i)->ek{let bh=q[C+f];let bI=vec4(bitcast<h>(q[C+2u]),bitcast<h>(q[C+3u]),bitcast<h>(q[C+4u]),bitcast<h>(q[C+5u]));let bH=vec4(bitcast<h>(q[C+6u]),bitcast<h>(q[C+7u]),bitcast<h>(q[C+8u]),bitcast<h>(q[C+9u]));let bG=vec4(bitcast<h>(q[C+10u]),bitcast<h>(q[C+11u]),bitcast<h>(q[C+12u]),bitcast<h>(q[C+13u]));let a5=vec4(bitcast<h>(q[C+14u]),bitcast<h>(q[C+15u]),bitcast<h>(q[C+16u]),bitcast<h>(q[C+17u]));let bt=vec4(bitcast<h>(q[C+18u]),bitcast<h>(q[C+19u]),bitcast<h>(q[C+20u]),bitcast<h>(q[C+21u]));let c2=q[C+22u]==f;return ek(bh,bI,bH,bG,a5,bt,c2);}fn bS(A:h,b6:i)->h{let hF=e;let hE=f;let hD=2u;switch b6{case 0u:{return clamp(A,c,d);}case 1u:{return fract(A);}default:{return abs(A- 2.*round(.5*A));}}}const ai=4u;fn f4(F:bs,xy:B,cV:bool)->array<h,ai>{var at:array<h,ai>;let hC=h(F.O);for(var j=e;j<ai;j+=f){at[j]=hC;}var cB=F.aj;while cB!=e{let an=aj[cB];let y=an.cK.y-xy.y;let R=clamp(y,c,d);let V=clamp(y+an.aD.y,c,d);let dC=R-V;if dC!=c{let f0=d/an.aD.y;let hB=(R-y)*f0;let hA=(V-y)*f0;let f_=an.cK.x-xy.x;let J=f_+hB*an.aD.x;let S=f_+hA*an.aD.x;let hz=min(J,S);let hy=max(J,S);for(var j=e;j<ai;j+=f){let fZ=h(j);let cD=min(hz-fZ,d)- 1.e-6;let fY=hy-fZ;let b=min(fY,d);let u=max(b,c);let cm=max(cD,c);let a=(b+.5*(cm*cm-u*u)-cD)/(fY-cD);at[j]+=a*dC;}}let a4=sign(an.aD.x)*clamp(xy.y-an.a4+d,c,d);for(var j=e;j<ai;j+=f){at[j]+=a4;}cB=an.eh;}if cV{for(var j=e;j<ai;j+=f){let a=at[j];at[j]=abs(a- 2.*round(.5*a));}}else{for(var j=e;j<ai;j+=f){at[j]=min(abs(at[j]),d);}}return at;}fn hH(seg:i,c4:h,xy:B)->array<h,ai>{var cR:array<h,ai>;for(var j=e;j<ai;j+=f){cR[j]=1e9;}var cB=seg;while cB!=e{let an=aj[cB];let aD=an.aD;let fX=xy+vec2(.5,.5)-an.cK;let a9=d/dot(aD,aD);for(var j=e;j<ai;j+=f){let fW=vec2(fX.x+h(j),fX.y);let A=clamp(dot(fW,aD)*a9,c,d);cR[j]=min(cR[j],length(aD*A-fW));}cB=an.eh;}for(var j=e;j<ai;j+=f){cR[j]=clamp(c4+.5-cR[j],c,d);}return cR;}@compute @workgroup_size(4,16)fn main(@builtin(global_invocation_id)N:M,@builtin(local_invocation_id)k:M,@builtin(workgroup_id)ap:M){let aJ=ap.y*n.aL+ap.x;let xy=vec2(h(N.x*ai),h(N.y));var rgba:array<af,ai>;for(var j=e;j<ai;j+=f){rgba[j]=unpack4x8unorm(n.iD).wzyx;}var fR:array<array<i,ai>,et>;var bd=e;var at:array<h,ai>;var C=aJ*ej;let gm=q[C];C+=f;while true{let a1=q[C];if a1==gT{break;}switch a1{case 1u:{let cI=hO(C);let aj=cI.F>>f;let cV=(cI.F&f)!=e;let F=bs(cI.O,aj);at=f4(F,xy,cV);C+=3u;}case 2u:{let a_=hN(C);at=hH(a_.F,a_.c4,xy);C+=3u;}case 3u:{for(var j=e;j<ai;j+=f){at[j]=d;}C+=f;}case 5u:{let cb=hM(C);let eV=unpack4x8unorm(cb.c3).wzyx;for(var j=e;j<ai;j+=f){let bC=eV*at[j];rgba[j]=rgba[j]*(d-bC.a)+bC;}C+=2u;}case 6u:{let cS=hL(C);let cm=cS.ei*xy.x+cS.fr*xy.y+cS.dN;for(var j=e;j<ai;j+=f){let hx=cm+cS.ei*h(j);let x=m(round(bS(hx,cS.bS)*h(f3- 1)));let dx=textureLoad(eS,vec2(x,m(cS.aV)),0);let bC=dx*at[j];rgba[j]=rgba[j]*(d-bC.a)+bC;}C+=3u;}case 7u:{let bB=hK(C);let a6=bB.a6;let aU=bB.aU;let hw=bB.bJ==g9;let hv=bB.bJ==ha;let hu=bB.bJ==g8;let fV=(bB.aE&g7)!=e;let fU=select(d/aU,c,hv);let ht=select(d,-d,fV||(d-a6)<c);let hs=sign(d-a6);for(var j=e;j<ai;j+=f){let dw=vec2(xy.x+h(j),xy.y);let fT=bB.K.xy*dw.x+bB.K.zw*dw.y+bB.cL;let x=fT.x;let y=fT.y;let xx=x*x;let yy=y*y;var A=c;var dZ=true;if hw{let a=aU-yy;A=sqrt(a)+x;dZ=a>=c;}else if hu{A=(xx+yy)/x;dZ=A>=c&&x!=c;}else if aU>d{A=sqrt(xx+yy)-x*fU;}else{let a=xx-yy;A=ht*sqrt(a)-x*fU;dZ=a>=c&&A>=c;}if dZ{A=bS(a6+hs*A,bB.bS);A=select(A,d-A,fV);let x=m(round(A*h(f3- 1)));let dx=textureLoad(eS,vec2(x,m(bB.aV)),0);let bC=dx*at[j];rgba[j]=rgba[j]*(d-bC.a)+bC;}}C+=3u;}case 8u:{let ca=hJ(C);let fS=ca.fq+ca.is;for(var j=e;j<ai;j+=f){let dw=vec2(xy.x+h(j),xy.y);let d0=ca.K.xy*dw.x+ca.K.zw*dw.y+ca.cL+ca.fq;if all(d0<fS)&&at[j]!=c{let d_=vec4(max(floor(d0),ca.fq),min(ceil(d0),fS));let eU=fract(d0);let a=d1(textureLoad(dY,dc(d_.xy),0));let b=d1(textureLoad(dY,dc(d_.xw),0));let u=d1(textureLoad(dY,dc(d_.zy),0));let cm=d1(textureLoad(dY,dc(d_.zw),0));let dx=mix(mix(a,b,eU.y),mix(u,cm,eU.y),eU.x);let bC=dx*at[j];rgba[j]=rgba[j]*(d-bC.a)+bC;}}C+=2u;}case 9u:{if bd<et{for(var j=e;j<ai;j+=f){fR[bd][j]=pack4x8unorm(rgba[j]);rgba[j]=vec4(c);}}else{}bd+=f;C+=f;}case 10u:{let U=hI(C);bd-=f;for(var j=e;j<ai;j+=f){var fQ:i;if bd<et{fQ=fR[bd][j];}else{}let bg=unpack4x8unorm(fQ);var a8=rgba[j];var bl:af;if U.c2{let hr=d/max(a8.a,1e-6);a8=vec4(a8.rgb*hr,a8.a);bl=a8.r*U.bI+a8.g*U.bH+a8.b*U.bG+a8.a*U.a5+d*U.bt;bl=clamp(bl,vec4(c),vec4(d));bl=vec4(bl.rgb*bl.a,bl.a);}else{bl=a8.r*U.bI+a8.g*U.bH+a8.b*U.bG+a8.a*U.a5+a8.a*U.bt;bl=clamp(bl,vec4(c),vec4(min(d,bl.a)));}let eV=bl*at[j];rgba[j]=jc(bg,eV,U.bh);}C+=23u;}case 11u:{C=q[C+f];}default:{}}}let eT=vec2u(xy);for(var j=e;j<ai;j+=f){let cC=eT+vec2(j,e);if cC.x<n.g6&&cC.y<n.g5{textureStore(bm,dc(cC),rgba[j]);}}}fn d1(rgba:af)->af{return vec4(rgba.rgb*rgba.a,rgba.a);}`
