/* eslint-disable */
import ptcl from './shared/ptcl.js';
import blend from './shared/blend.js';
import config from './shared/config.js';
import segment from './shared/segment.js';
import pre from './shared/pre.js';

export default `${pre}struct bt{O:m,ak:i}${segment}
${config}
@group(0)@binding(0)var<uniform>n:aR;@group(0)@binding(1)var<storage>W:array<bt>;@group(0)@binding(2)var<storage>ak:array<dM>;${blend}
${ptcl}
const f3=512;@group(0)@binding(3)var a0:texture_storage_2d<rgba8unorm,write>;@group(0)@binding(4)var<storage>q:aX;@group(0)@binding(5)var eS:texture_2d<h>;@group(0)@binding(6)var<storage>info:aX;@group(0)@binding(7)var dY:texture_2d<h>;fn hO(C:i)->fu{let F=q[C+f];let O=m(q[C+2u]);return fu(F,O);}fn hN(C:i)->ft{let F=q[C+f];let c4=bitcast<h>(q[C+2u]);return ft(F,c4);}fn hM(C:i)->el{let c3=q[C+f];return el(c3);}fn hL(C:i)->gX{let dy=q[C+f];let aW=dy>>2u;let bU=dy&3u;let Q=q[C+2u];let ei=bitcast<h>(info[Q]);let fr=bitcast<h>(info[Q+f]);let dN=bitcast<h>(info[Q+2u]);return gX(aW,bU,ei,fr,dN);}fn hK(C:i)->gW{let dy=q[C+f];let aW=dy>>2u;let bU=dy&3u;let Q=q[C+2u];let eZ=bitcast<h>(info[Q]);let eY=bitcast<h>(info[Q+f]);let eX=bitcast<h>(info[Q+2u]);let eW=bitcast<h>(info[Q+3u]);let K=vec4(eZ,eY,eX,eW);let cM=vec2(bitcast<h>(info[Q+4u]),bitcast<h>(info[Q+5u]));let a8=bitcast<h>(info[Q+6u]);let aV=bitcast<h>(info[Q+7u]);let f2=info[Q+8u];let aF=f2>>3u;let bL=f2&7u;return gW(aW,bU,K,cM,a8,aV,bL,aF);}fn hJ(C:i)->gV{let Q=q[C+f];let eZ=bitcast<h>(info[Q]);let eY=bitcast<h>(info[Q+f]);let eX=bitcast<h>(info[Q+2u]);let eW=bitcast<h>(info[Q+3u]);let K=vec4(eZ,eY,eX,eW);let cM=vec2(bitcast<h>(info[Q+4u]),bitcast<h>(info[Q+5u]));let xy=info[Q+6u];let f1=info[Q+7u];let x=h(xy>>16u);let y=h(xy&65535u);let cm=h(f1>>16u);let hG=h(f1&65535u);return gV(K,cM,vec2(x,y),vec2(cm,hG));}fn hI(C:i)->ek{let bj=q[C+f];let bK=vec4(bitcast<h>(q[C+2u]),bitcast<h>(q[C+3u]),bitcast<h>(q[C+4u]),bitcast<h>(q[C+5u]));let bJ=vec4(bitcast<h>(q[C+6u]),bitcast<h>(q[C+7u]),bitcast<h>(q[C+8u]),bitcast<h>(q[C+9u]));let bI=vec4(bitcast<h>(q[C+10u]),bitcast<h>(q[C+11u]),bitcast<h>(q[C+12u]),bitcast<h>(q[C+13u]));let bu=vec4(bitcast<h>(q[C+14u]),bitcast<h>(q[C+15u]),bitcast<h>(q[C+16u]),bitcast<h>(q[C+17u]));let bH=vec4(bitcast<h>(q[C+18u]),bitcast<h>(q[C+19u]),bitcast<h>(q[C+20u]),bitcast<h>(q[C+21u]));let c2=q[C+22u]==f;return ek(bj,bK,bJ,bI,bu,bH,c2);}fn bU(A:h,b9:i)->h{let hF=e;let hE=f;let hD=2u;switch b9{case 0u:{return clamp(A,c,d);}case 1u:{return fract(A);}default:{return abs(A- 2.*round(.5*A));}}}const aj=4u;fn f4(F:bt,xy:B,cV:bool)->array<h,aj>{var av:array<h,aj>;let hC=h(F.O);for(var j=e;j<aj;j+=f){av[j]=hC;}var cD=F.ak;while cD!=e{let ap=ak[cD];let y=ap.cL.y-xy.y;let R=clamp(y,c,d);let V=clamp(y+ap.aE.y,c,d);let dC=R-V;if dC!=c{let f0=d/ap.aE.y;let hB=(R-y)*f0;let hA=(V-y)*f0;let f_=ap.cL.x-xy.x;let J=f_+hB*ap.aE.x;let T=f_+hA*ap.aE.x;let hz=min(J,T);let hy=max(J,T);for(var j=e;j<aj;j+=f){let fZ=h(j);let cF=min(hz-fZ,d)- 1.e-6;let fY=hy-fZ;let b=min(fY,d);let u=max(b,c);let co=max(cF,c);let a=(b+.5*(co*co-u*u)-cF)/(fY-cF);av[j]+=a*dC;}}let a7=sign(ap.aE.x)*clamp(xy.y-ap.a7+d,c,d);for(var j=e;j<aj;j+=f){av[j]+=a7;}cD=ap.eh;}if cV{for(var j=e;j<aj;j+=f){let a=av[j];av[j]=abs(a- 2.*round(.5*a));}}else{for(var j=e;j<aj;j+=f){av[j]=min(abs(av[j]),d);}}return av;}fn hH(seg:i,c4:h,xy:B)->array<h,aj>{var cS:array<h,aj>;for(var j=e;j<aj;j+=f){cS[j]=1e9;}var cD=seg;while cD!=e{let ap=ak[cD];let aE=ap.aE;let fX=xy+vec2(.5,.5)-ap.cL;let bd=d/dot(aE,aE);for(var j=e;j<aj;j+=f){let fW=vec2(fX.x+h(j),fX.y);let A=clamp(dot(fW,aE)*bd,c,d);cS[j]=min(cS[j],length(aE*A-fW));}cD=ap.eh;}for(var j=e;j<aj;j+=f){cS[j]=clamp(c4+.5-cS[j],c,d);}return cS;}@compute @workgroup_size(4,16)fn main(@builtin(global_invocation_id)N:M,@builtin(local_invocation_id)k:M,@builtin(workgroup_id)at:M){let aK=at.y*n.aM+at.x;let xy=vec2(h(N.x*aj),h(N.y));var rgba:array<af,aj>;for(var j=e;j<aj;j+=f){rgba[j]=unpack4x8unorm(n.iD).wzyx;}var fR:array<array<i,aj>,et>;var bf=e;var av:array<h,aj>;var C=aK*ej;let gm=q[C];C+=f;while true{let a4=q[C];if a4==gT{break;}switch a4{case 1u:{let cJ=hO(C);let ak=cJ.F>>f;let cV=(cJ.F&f)!=e;let F=bt(cJ.O,ak);av=f4(F,xy,cV);C+=3u;}case 2u:{let a2=hN(C);av=hH(a2.F,a2.c4,xy);C+=3u;}case 3u:{for(var j=e;j<aj;j+=f){av[j]=d;}C+=f;}case 5u:{let b6=hM(C);let eV=unpack4x8unorm(b6.c3).wzyx;for(var j=e;j<aj;j+=f){let bC=eV*av[j];rgba[j]=rgba[j]*(d-bC.a)+bC;}C+=2u;}case 6u:{let cT=hL(C);let co=cT.ei*xy.x+cT.fr*xy.y+cT.dN;for(var j=e;j<aj;j+=f){let hx=co+cT.ei*h(j);let x=m(round(bU(hx,cT.bU)*h(f3- 1)));let dx=textureLoad(eS,vec2(x,m(cT.aW)),0);let bC=dx*av[j];rgba[j]=rgba[j]*(d-bC.a)+bC;}C+=3u;}case 7u:{let bB=hK(C);let a8=bB.a8;let aV=bB.aV;let hw=bB.bL==g9;let hv=bB.bL==ha;let hu=bB.bL==g8;let fV=(bB.aF&g7)!=e;let fU=select(d/aV,c,hv);let ht=select(d,-d,fV||(d-a8)<c);let hs=sign(d-a8);for(var j=e;j<aj;j+=f){let dw=vec2(xy.x+h(j),xy.y);let fT=bB.K.xy*dw.x+bB.K.zw*dw.y+bB.cM;let x=fT.x;let y=fT.y;let xx=x*x;let yy=y*y;var A=c;var dZ=true;if hw{let a=aV-yy;A=sqrt(a)+x;dZ=a>=c;}else if hu{A=(xx+yy)/x;dZ=A>=c&&x!=c;}else if aV>d{A=sqrt(xx+yy)-x*fU;}else{let a=xx-yy;A=ht*sqrt(a)-x*fU;dZ=a>=c&&A>=c;}if dZ{A=bU(a8+hs*A,bB.bU);A=select(A,d-A,fV);let x=m(round(A*h(f3- 1)));let dx=textureLoad(eS,vec2(x,m(bB.aW)),0);let bC=dx*av[j];rgba[j]=rgba[j]*(d-bC.a)+bC;}}C+=3u;}case 8u:{let cd=hJ(C);let fS=cd.fq+cd.is;for(var j=e;j<aj;j+=f){let dw=vec2(xy.x+h(j),xy.y);let d0=cd.K.xy*dw.x+cd.K.zw*dw.y+cd.cM+cd.fq;if all(d0<fS)&&av[j]!=c{let d_=vec4(max(floor(d0),cd.fq),min(ceil(d0),fS));let eU=fract(d0);let a=d1(textureLoad(dY,dc(d_.xy),0));let b=d1(textureLoad(dY,dc(d_.xw),0));let u=d1(textureLoad(dY,dc(d_.zy),0));let co=d1(textureLoad(dY,dc(d_.zw),0));let dx=mix(mix(a,b,eU.y),mix(u,co,eU.y),eU.x);let bC=dx*av[j];rgba[j]=rgba[j]*(d-bC.a)+bC;}}C+=2u;}case 9u:{if bf<et{for(var j=e;j<aj;j+=f){fR[bf][j]=pack4x8unorm(rgba[j]);rgba[j]=vec4(c);}}else{}bf+=f;C+=f;}case 10u:{let S=hI(C);bf-=f;for(var j=e;j<aj;j+=f){var fQ:i;if bf<et{fQ=fR[bf][j];}else{}let bg=unpack4x8unorm(fQ);var a1=rgba[j];var bn:af;if S.c2{let hr=d/max(a1.a,1e-6);a1=vec4(a1.rgb*hr,a1.a);bn=S.bK*a1.r+S.bJ*a1.g+S.bI*a1.b+S.bu*a1.a+S.bH;bn=clamp(bn,vec4(c),vec4(d));bn=vec4(bn.rgb*bn.a,bn.a);}else{let new_rgb=S.bK.rgb*a1.r+S.bJ.rgb*a1.g+S.bI.rgb*a1.b+S.bu.rgb*a1.a*a1.a+S.bH.rgb*a1.a;bn=S.bu.a*vec4(new_rgb,a1.a);bn=clamp(bn,vec4(c),vec4(min(d,bn.a)));}let eV=bn*av[j];rgba[j]=jc(bg,eV,S.bj);}C+=23u;}case 11u:{C=q[C+f];}default:{}}}let eT=vec2u(xy);for(var j=e;j<aj;j+=f){let cE=eT+vec2(j,e);if cE.x<n.g6&&cE.y<n.g5{textureStore(a0,dc(cE),rgba[j]);}}}fn d1(rgba:af)->af{return vec4(rgba.rgb*rgba.a,rgba.a);}`
