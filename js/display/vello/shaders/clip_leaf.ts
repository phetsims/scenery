/* eslint-disable */
import drawtag from './shared/drawtag.js';
import clip from './shared/clip.js';
import bbox from './shared/bbox.js';
import config from './shared/config.js';

export default `${config}
${bbox}
${clip}
${drawtag}
@group(0)@binding(0)var<uniform>f:aF;@group(0)@binding(1)var<storage>cK:array<ef>;@group(0)@binding(2)var<storage>bD:array<cY>;@group(0)@binding(3)var<storage>aD:array<aP>;@group(0)@binding(4)var<storage>hX:array<fj>;@group(0)@binding(5)var<storage,read_write>bS:array<aE>;@group(0)@binding(6)var<storage,read_write>hW:array<vec4f>;const h=256u;var<workgroup>aC:array<aP,510>;var<workgroup>f8:array<u32,h>;var<workgroup>dr:array<vec4f,h>;var<workgroup>dX:array<vec4f,h>;var<workgroup>dW:array<i32,h>;fn hZ(Y:ptr<function,aP>,hV:u32)->i32{var i=hV;var bq=0u;while bq<firstTrailingBit(h){let Z=2u*h-(2u<<(firstTrailingBit(h)-bq));if((i>>bq)&1u)!=0u{let ds=dF(aC[Z+(i>>bq)- 1u],*Y);if ds.b>0u{break;}*Y=ds;i-=1u<<bq;}bq+=1u;}if i>0u{while bq>0u{bq-=1u;let Z=2u*h-(2u<<(firstTrailingBit(h)-bq));let ds=dF(aC[Z+(i>>bq)- 1u],*Y);if ds.b==0u{*Y=ds;i-=1u<<bq;}}}if i>0u{return i32(i)- 1;}else{return i32(~0u-(*Y).a);}}fn hY(i:u32)->i32{if i<f.ed{return cK[i].R;}else{return-2147483648;}}@compute @workgroup_size(256)fn main(@builtin(global_invocation_id)E:vec3u,@builtin(local_invocation_id)d:vec3u,@builtin(workgroup_id)ae:vec3u,){var Y:aP;if d.x<ae.x{Y=aD[d.x];}aC[d.x]=Y;for(var c=0u;c<firstTrailingBit(h);c+=1u){workgroupBarrier();if d.x+(1u<<c)<h{let ai=aC[d.x+(1u<<c)];Y=dF(Y,ai);}workgroupBarrier();aC[d.x]=Y;}workgroupBarrier();let e4=aC[0].b;let e3=h- 1u-d.x;var i=0u;for(var c=0u;c<firstTrailingBit(h);c+=1u){let bt=i+((h/2u)>>c);if e3<aC[bt].b{i=bt;}}let b=aC[i].b;var e=vec4(-1e9,-1e9,1e9,1e9);if e3<b{let gf=hX[i*h+b-e3- 1u];f8[d.x]=gf.dE;e=gf.e;}for(var c=0u;c<firstTrailingBit(h);c+=1u){dr[d.x]=e;workgroupBarrier();if d.x>=(1u<<c){e=dG(dr[d.x-(1u<<c)],e);}workgroupBarrier();}dr[d.x]=e;let cL=hY(E.x);let b4=cL>=0;Y=aP(1u-u32(b4),u32(b4));aC[d.x]=Y;if b4{let aI=bD[cL];e=vec4(f32(aI.B),f32(aI.I),f32(aI.J),f32(aI.M));}else{e=vec4(-1e9,-1e9,1e9,1e9);}var f9=0u;for(var c=0u;c<firstTrailingBit(h)- 1u;c+=1u){let ge=2u*h-(1u<<(firstTrailingBit(h)-c));workgroupBarrier();if d.x<1u<<(firstTrailingBit(h)- 1u-c){let gd=f9+d.x*2u;aC[ge+d.x]=dF(aC[gd],aC[gd+1u]);}f9=ge;}workgroupBarrier();Y=aP();var aH=hZ(&Y,d.x);dW[d.x]=aH;workgroupBarrier();let dY=select(aH- 1,dW[aH],aH>=0);var dq:i32;if aH>=0{dq=i32(ae.x*h)+aH;}else if aH+i32(e4)>=0{dq=i32(f8[i32(h)+aH]);}else{dq=-1;}for(var c=0u;c<firstTrailingBit(h);c+=1u){if c!=0u{dW[d.x]=aH;}dX[d.x]=e;workgroupBarrier();if aH>=0{e=dG(dX[aH],e);aH=dW[aH];}workgroupBarrier();}if aH+i32(e4)>=0{e=dG(dr[i32(h)+aH],e);}dX[d.x]=e;workgroupBarrier();if!b4&&E.x<f.ed{let gc=cK[dq];let R=gc.R;let dE=gc.i;let i=~cL;bS[i].R=u32(R);bS[i].by=bS[dE].by;if dY>=0{e=dX[dY];}else if dY+i32(e4)>=0{e=dr[i32(h)+dY];}else{e=vec4(-1e9,-1e9,1e9,1e9);}}if E.x<f.ed{hW[E.x]=e;}}`
